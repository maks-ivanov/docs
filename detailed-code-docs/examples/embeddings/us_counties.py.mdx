---
title: "us_counties.py"
---

## High-level description

The `us_counties.py` script is an interactive notebook designed to embed and visualize demographic data from 3,220 US counties using the PyMDE library. It demonstrates how to create a neighbor-preserving embedding of the counties based on demographic data and visualizes the results using an interactive scatter plot, colored by the fraction of voters who voted for a democratic candidate in the 2016 presidential election.

## Code Structure

The script is structured as a series of cells, each defined by the `@app.cell` decorator from the `marimo` library. These cells perform specific tasks such as importing libraries, loading datasets, creating embeddings, and visualizing data. The cells are executed in sequence to build the interactive notebook.

## Symbols

### `app`
#### Description
`app` is an instance of `marimo.App`, which is used to define and run the interactive notebook. It manages the execution of the cells and the rendering of the notebook interface.

### `@app.cell`
#### Description
The `@app.cell` decorator is used to define a cell in the notebook. Each cell can contain code that performs a specific task, such as importing a library, processing data, or rendering a visualization.

### `mo.md`
#### Description
`mo.md` is a method used to render Markdown content in the notebook. It is used to provide explanations and context for the data and visualizations presented in the notebook.

### `mo.ui.altair_chart`
#### Description
`mo.ui.altair_chart` is a method used to create interactive Altair charts within the notebook. It is used to visualize the embedding of US counties as a scatter plot.

### `pymde`
#### Description
`pymde` is a library used for creating minimum-distortion embeddings. It is imported and used to load the dataset of US counties and to create the neighbor-preserving embedding.

### `dataset`
#### Description
`dataset` is a variable that holds the data of US counties, including demographic information. It is loaded using the `pymde.datasets.counties()` function.

### `mde`
#### Description
`mde` is an instance of a PyMDE embedding model created using the `pymde.preserve_neighbors` function. It is used to compute the embedding of the counties based on their demographic data.

### `embedding`
#### Description
`embedding` is the result of the embedding process, representing the counties in a lower-dimensional space. It is computed using the `mde.embed()` method.

### `rotated_embedding`
#### Description
`rotated_embedding` is the embedding after being rotated to better resemble a map of the US. The rotation is performed using the `pymde.rotate` function.

### `embedding_df`
#### Description
`embedding_df` is a DataFrame that combines the rotated embedding coordinates with the original county data and the fraction of democratic voters. It is used for visualization in the Altair chart.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `marimo` | Used to create and manage the interactive notebook interface. |
| `pymde` | Used for creating minimum-distortion embeddings of the county data. |
| `pandas` | Used for data manipulation and creating DataFrames. |
| `altair` | Used for creating interactive visualizations. |
| `matplotlib.pyplot` | Used for plotting data, though not directly utilized in the final visualization. |

## Error Handling

The script does not explicitly handle errors beyond the basic exception handling provided by the Python runtime. It assumes that the data and libraries are available and correctly configured.

## Logging

The script does not implement any logging mechanisms. It relies on the interactive nature of the notebook to provide feedback to the user.

## API/Interface Reference

The script does not expose an API. It is designed to be run as an interactive notebook, with the user interacting directly with the visualizations and data presented in the notebook interface.