---
title: "substrate-run.py"
---

## High-level description

The `substrate-run.py` script is a Marimo application that interacts with the Substrate API to generate and process media content. It allows users to input an API key, generate an image based on a prompt, upscale the image, and create a video using stable video diffusion techniques. The application is structured using Marimo's cell-based architecture, which organizes code into discrete, reusable components.

## Code Structure

The script is structured using Marimo's `@app.cell` decorator, which defines individual cells that encapsulate specific functionality. These cells are executed in sequence, and they interact with each other by passing data through their inputs and outputs. The main components include:

- Initialization of the Marimo application.
- User input for the Substrate API key.
- Image generation, upscaling, and video creation using Substrate's services.
- Displaying the generated video.
- Stopping the application if the API key is not provided.

## Symbols

### `app`
#### Description
The `app` is an instance of `marimo.App`, which serves as the main application object for the Marimo framework. It is configured with a medium width.

### `@app.cell`
#### Description
The `@app.cell` decorator is used to define a cell in the Marimo application. Each cell encapsulates a specific piece of functionality and can have dependencies on other cells.

### `__()`
#### Description
This is a placeholder function used multiple times with the `@app.cell` decorator to define different cells in the application. Each instance of `__()` serves a different purpose based on its context.

#### Inputs and Outputs
The inputs and outputs vary for each instance of `__()`, depending on the specific functionality it encapsulates.

#### Internal Logic
- **First Cell**: Imports the `marimo` module and returns it.
- **Second Cell**: Prompts the user for a Substrate API key using a password input field and returns the key.
- **Third Cell**: Uses the Substrate API to generate an image, upscale it, and create a video. It returns various objects related to these operations.
- **Fourth Cell**: Retrieves and displays the generated video using the Marimo image display function.
- **Fifth Cell**: Checks if the API key is provided and stops the application if not. It also initializes the Substrate client.

## References

- **`marimo`**: The main library used to create the application and handle UI components.
- **`substrate`**: A library used to interact with the Substrate API for media generation and processing.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `marimo`   | Used to create the application and manage UI components. |
| `substrate`| Provides functionality for generating and processing media content. |

## Error Handling

The script includes a basic error handling mechanism where the application is stopped if the API key is not provided. This is done using the `mo.stop()` function.

## Logging

The script does not implement any explicit logging mechanisms. However, it uses Marimo's UI components to provide feedback to the user, such as displaying the generated video.

## TODOs

There are no TODOs or notes left in the code.