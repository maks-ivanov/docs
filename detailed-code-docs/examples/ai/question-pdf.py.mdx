---
title: "question-pdf.py"
---

## High-level description

The `question-pdf.py` script is a web application built using the `marimo` framework that allows users to upload a PDF document and ask questions about its content. The application processes the PDF by splitting it into text chunks, embedding these chunks using OpenAI's text embedding model, and then performing a similarity search to find relevant sections of the document in response to user queries. The relevant text is then used to generate a response using a GPT model.

## Code Structure

The script is structured as a series of `@app.cell` decorated functions, which are executed as part of the `marimo` application. Each function represents a cell in the application, handling different aspects of the app's functionality, such as UI elements, PDF processing, and question answering.

## Symbols

### `@app.cell` Decorated Functions
#### Description
Each function decorated with `@app.cell` represents a component of the `marimo` application. These functions define the UI and logic for uploading PDFs, entering OpenAI API keys, processing the PDF, and querying the document.

#### Inputs and Outputs
The inputs and outputs vary for each function, typically involving UI elements and data processing components.

#### Internal Logic
- **UI Setup**: Functions set up UI components like text inputs, file upload areas, and markdown displays.
- **PDF Processing**: Functions handle the reading and text extraction from the uploaded PDF, splitting the text into chunks, and creating embeddings.
- **Question Answering**: Functions manage the querying of the processed PDF data using OpenAI's models to generate responses to user questions.

### `parse_pdf`
#### Description
This function processes the uploaded PDF, extracting text, splitting it into chunks, and creating embeddings for these chunks.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pdf | UI element | The uploaded PDF file. |
| io | Module | Used for handling byte streams. |
| PdfReader | Class | Used to read the PDF file. |
| CharacterTextSplitter | Class | Used to split the text into chunks. |
| OpenAIEmbeddings | Class | Used to create embeddings for the text chunks. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knowledge_base | FAISS object | A vector store containing the text embeddings. |

#### Internal Logic
- Checks if a PDF is uploaded.
- Reads the PDF and extracts text from each page.
- Splits the text into chunks using `CharacterTextSplitter`.
- Creates embeddings for each chunk using `OpenAIEmbeddings`.
- Stores the embeddings in a FAISS vector store.

### `query_pdf`
#### Description
This function handles querying the processed PDF data to find relevant text chunks and generate a response using a GPT model.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user_question | UI element | The user's question about the PDF. |
| knowledge_base | FAISS object | The vector store containing text embeddings. |
| OpenAI | Class | Used to interact with OpenAI's GPT model. |
| load_qa_chain | Function | Loads a question-answering chain. |
| get_openai_callback | Function | Provides a callback for OpenAI API interactions. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| res | String | The response generated by the GPT model. |

#### Internal Logic
- Checks if a question is provided and if the knowledge base is available.
- Performs a similarity search on the knowledge base to find relevant text chunks.
- Uses OpenAI's GPT model to generate a response based on the relevant text.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| marimo | Framework for building the web application. |
| openai | Library for interacting with OpenAI's API. |
| PyPDF2 | Library for reading PDF files. |
| langchain | Library for text processing and embeddings. |

## Error Handling

The script includes basic error handling for missing PDF uploads and missing user input, primarily through conditional checks and print statements.

## Logging

The script uses print statements to log certain actions, such as missing PDF uploads.

## API/Interface Reference

The script does not explicitly define an API but provides a user interface through the `marimo` framework for interacting with the application.

## TODOs

No TODOs or notes are present in the code.