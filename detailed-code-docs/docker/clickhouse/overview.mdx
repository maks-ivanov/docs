---
title: "Overview"
---

## High-level description
This code defines a Python script that embeds text using an external embedding server. It provides functions to send text to the server, receive embeddings, and process input from stdin.

## Table of contents
- `completion_with_backoff` function
- `embed` function
- Main loop for processing input

## Code Structure
The script defines two main functions: `completion_with_backoff` and `embed`. The `embed` function uses `completion_with_backoff` to get embeddings from the server. The main loop reads input from stdin and calls `embed` for each line.

## Symbols

### `completion_with_backoff`
#### Description
Sends a request to the embedding server and returns the embedding.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| model_input | str | The text to be embedded |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| embedding | list | The embedding vector |

#### Internal Logic
1. Constructs the request parameters and headers
2. Sends a POST request to the embedding server
3. Raises an exception if the request fails
4. Extracts and returns the embedding from the response

### `embed`
#### Description
Wraps the `completion_with_backoff` function to handle empty inputs and errors.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| text | str | The text to be embedded |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | str | The embedding or an error message |

#### Internal Logic
1. Returns "NULL" for empty input
2. Calls `completion_with_backoff` with the input text
3. Returns the embedding or "ERROR" if an exception occurs

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| sys | Reading from stdin |
| requests | Making HTTP requests to the embedding server |
| os | Accessing environment variables |

## Error Handling
The script uses try-except blocks to catch and handle exceptions, returning "ERROR" for any failures during the embedding process.

## Future Improvements
- Implement retry logic with exponential backoff for failed requests
- Add support for batch processing of multiple inputs
- Implement caching to avoid re-embedding identical inputs