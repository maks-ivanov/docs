---
title: "clickhouse-deplolyment.yaml"
---

## High-level description
This YAML file defines a ClickHouseInstallation custom resource for deploying a ClickHouse database instance in a Kubernetes environment. It specifies the configuration, cluster layout, pod template, and persistent volume claims for the ClickHouse deployment.

## Table of contents
- ClickHouseInstallation metadata
- Specification
  - Configuration
  - Clusters
  - Templates
    - Pod Template
    - Volume Claim Templates

## Code Structure
The YAML file defines a single ClickHouseInstallation resource with nested structures for configuration, cluster layout, pod template, and volume claim templates. The pod template references the volume claim templates for persistent storage.

## Symbols

### ClickHouseInstallation
#### Description
Defines a ClickHouse database installation in Kubernetes using the Altinity ClickHouse Operator.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.config.analytics.clickhousePassword | string | Password for the default ClickHouse user |
| .Values.config.trieve.embeddingServerOriginBGEM3 | string | URL of the embedding server |

#### Internal Logic
1. Sets up a single ClickHouse cluster with one shard and one replica
2. Configures the default user's password and network access
3. Defines a pod template with a custom ClickHouse image and environment variables
4. Specifies volume claim templates for data and log storage

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| clickhouse.altinity.com/v1 | Kubernetes API version for ClickHouseInstallation custom resource |

### Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| users.default/password | string | N/A | Password for the default ClickHouse user |
| users.default/networks/ip | list | ["0.0.0.0/0"] | Allowed IP networks for the default user |
| clusters[0].name | string | "cluster1" | Name of the ClickHouse cluster |
| clusters[0].layout.shardsCount | integer | 1 | Number of shards in the cluster |
| clusters[0].layout.replicasCount | integer | 1 | Number of replicas per shard |

## Future Improvements
1. Consider adding readiness and liveness probes to the ClickHouse container for better health monitoring.
2. Implement resource requests and limits for the ClickHouse container to ensure proper resource allocation.
3. Evaluate the need for additional ClickHouse users with different access levels for improved security.
4. Consider using Kubernetes Secrets for storing sensitive information like passwords instead of plain text in the YAML file.
5. Explore options for scaling the ClickHouse cluster by adjusting the shardsCount and replicasCount values based on performance requirements.