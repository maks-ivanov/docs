---
title: "podmonitor.yaml"
---

## High-level description
This Helm template defines a PodMonitor resource for Redis, which is used to configure Prometheus monitoring for Redis pods. It's conditionally created based on metrics and podMonitor settings in the Helm values.

## Table of contents
- PodMonitor resource definition
- Metadata configuration
- Spec configuration
  - Pod metrics endpoints
  - Additional endpoints
  - Namespace and pod selection

## Code Structure
The template uses various Helm functions and includes to render a Kubernetes PodMonitor resource. It heavily relies on values defined in the Helm chart's values.yaml file to customize the PodMonitor configuration.

## Symbols

### PodMonitor Resource
#### Description
Defines a PodMonitor resource for Prometheus operator to scrape metrics from Redis pods.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values | object | Helm values for the chart |

#### Internal Logic
1. Checks if metrics and podMonitor are enabled
2. Defines metadata (name, namespace, labels, annotations)
3. Configures pod metrics endpoints
4. Sets up additional endpoints if specified
5. Configures namespace and pod selection

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| monitoring.coreos.com/v1 | API version for PodMonitor resource |

### Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| metrics.enabled | boolean | - | Enables metrics collection |
| metrics.podMonitor.enabled | boolean | - | Enables PodMonitor creation |
| metrics.podMonitor.namespace | string | - | Namespace for PodMonitor |
| metrics.podMonitor.interval | string | - | Scrape interval |
| metrics.podMonitor.scrapeTimeout | string | - | Scrape timeout |
| metrics.podMonitor.honorLabels | boolean | - | Honor labels setting |
| metrics.podMonitor.relabellings | array | - | Relabeling configurations |
| metrics.podMonitor.metricRelabelings | array | - | Metric relabeling configurations |
| metrics.podMonitor.additionalEndpoints | array | - | Additional endpoints to scrape |
| metrics.podMonitor.podTargetLabels | array | - | Pod labels to be used as metrics labels |
| metrics.podMonitor.sampleLimit | number | - | Sample limit for scraping |
| metrics.podMonitor.targetLimit | number | - | Target limit for scraping |

## Future Improvements
1. Consider adding support for TLS configuration in the PodMonitor spec.
2. Implement conditional logic for different Prometheus operator versions, as the API might change.
3. Add validation for the additionalEndpoints to ensure required fields are provided.