---
title: "psp.yaml"
---

## High-level description
This YAML file defines a PodSecurityPolicy for the Redis master in a Helm chart. It sets up security constraints for the Redis master pod, including restrictions on privileges, file system access, and user/group permissions.

## Table of contents
- PodSecurityPolicy definition
- Metadata
- Spec (security constraints)

## Code Structure
The file consists of a single Kubernetes resource definition (PodSecurityPolicy) with metadata and spec sections. The content is conditionally rendered based on Helm template logic.

## Symbols

### PodSecurityPolicy
#### Description
Defines a PodSecurityPolicy resource for the Redis master pod, specifying security constraints.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.podSecurityPolicy.create | boolean | Determines if the PodSecurityPolicy should be created |
| .Values.commonLabels | map | Custom labels to be applied |
| .Values.commonAnnotations | map | Custom annotations to be applied |
| .Values.master.podSecurityContext.fsGroup | integer | File system group ID for the pod |
| .Values.master.containerSecurityContext.runAsUser | integer | User ID to run the container |

#### Internal Logic
1. Checks if PodSecurityPolicy is supported and should be created
2. Generates the resource name and namespace using Helm templating functions
3. Applies labels and annotations
4. Defines security constraints in the spec section

## Side Effects
Creates a PodSecurityPolicy resource in the Kubernetes cluster when applied.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.capabilities.psp.supported | Checks if PodSecurityPolicy is supported |
| common.names.fullname | Generates the full name for the resource |
| common.names.namespace | Retrieves the namespace |
| common.labels.standard | Applies standard labels |
| common.tplvalues.render | Renders template values |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| podSecurityPolicy.create | boolean | - | Whether to create the PodSecurityPolicy |
| master.podSecurityContext.fsGroup | integer | - | File system group ID for the pod |
| master.containerSecurityContext.runAsUser | integer | - | User ID to run the container |

## Future Improvements
- Consider updating the API version from `policy/v1beta1` to `policy/v1` if using a newer Kubernetes version that supports it.
- Evaluate the need for more granular control over capabilities and security contexts.
- Consider adding support for custom seccomp profiles or AppArmor settings.