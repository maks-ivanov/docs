---
title: "service.yaml"
---

## High-level description
This YAML file defines a Kubernetes Service for Redis Sentinel in a Helm chart. It creates a service to expose Redis and Sentinel ports, with support for various service types and configurations.

## Table of contents
- Service metadata
- Service specification
- Port configurations
- Selector

## Code Structure
The main structure is a Kubernetes Service resource, with conditional logic to determine port configurations and service properties based on Helm values.

## Symbols

### Service Definition
#### Description
Defines a Kubernetes Service for Redis Sentinel, exposing both Redis and Sentinel ports.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values | Object | Helm values for configuring the service |
| .Release | Object | Helm release information |

#### Internal Logic
1. Checks conditions for creating the service (upgrade or non-NodePort type)
2. Retrieves port information from a ConfigMap if available
3. Defines service metadata, including name, namespace, labels, and annotations
4. Specifies service type and related configurations (e.g., externalTrafficPolicy, loadBalancer settings)
5. Configures ports for Redis and Sentinel
6. Sets up selector for pod targeting

## Side Effects
Creates or updates a Kubernetes Service resource when the Helm chart is installed or upgraded.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common | Provides helper templates for naming, labels, and annotations |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| .Values.sentinel.service.type | String | - | Service type (e.g., ClusterIP, NodePort, LoadBalancer) |
| .Values.sentinel.service.ports.redis | Integer | - | Port for Redis service |
| .Values.sentinel.service.ports.sentinel | Integer | - | Port for Sentinel service |
| .Values.sentinel.service.nodePorts | Object | - | NodePort configurations for Redis and Sentinel |

## Future Improvements
- Consider separating the Redis and Sentinel services for better isolation and management
- Implement support for custom labels and annotations at the port level
- Add support for IPv6 configurations
- Consider adding health check configurations to the service definition