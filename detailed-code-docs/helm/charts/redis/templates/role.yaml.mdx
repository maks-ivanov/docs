---
title: "role.yaml"
---

## High-level description
This YAML file defines a Kubernetes Role resource for Redis, which is used to grant specific permissions within a namespace. The role is conditionally created based on RBAC settings and includes rules for pod security policies and custom rules.

## Table of contents
- Role metadata definition
- Role rules definition
- Conditional creation based on RBAC settings
- Pod Security Policy rules
- Custom RBAC rules

## Code Structure
The file uses Helm templating to dynamically generate the Role resource. It relies on various helper templates and values from the chart's configuration to populate the fields.

## Symbols

### Role Resource
#### Description
Defines a Kubernetes Role resource with metadata and rules.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.rbac.create | boolean | Determines if the Role should be created |
| .Values.commonLabels | map | Custom labels to be applied to the resource |
| .Values.commonAnnotations | map | Custom annotations to be applied to the resource |
| .Values.podSecurityPolicy.enabled | boolean | Determines if Pod Security Policy rules should be included |
| .Values.rbac.rules | list | Custom RBAC rules to be included in the Role |

#### Internal Logic
1. Checks if RBAC creation is enabled
2. Sets the API version using a helper template
3. Defines metadata including name, namespace, labels, and annotations
4. Conditionally includes Pod Security Policy rules
5. Includes custom RBAC rules if provided

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.capabilities.rbac.apiVersion | Determines the appropriate RBAC API version |
| common.names.fullname | Generates the full name for the resource |
| common.names.namespace | Retrieves the namespace |
| common.labels.standard | Generates standard labels |
| common.tplvalues.render | Renders template values |
| common.capabilities.psp.supported | Checks if Pod Security Policies are supported |
| podSecurityPolicy.apiGroup | Retrieves the Pod Security Policy API group |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| rbac.create | boolean | - | Determines if the Role should be created |
| podSecurityPolicy.enabled | boolean | - | Enables Pod Security Policy rules |
| rbac.rules | list | - | Custom RBAC rules to be included |

## Future Improvements
- Consider adding support for ClusterRole creation alongside Role
- Implement more granular control over Pod Security Policy rules
- Add validation for custom RBAC rules to ensure they follow Kubernetes best practices