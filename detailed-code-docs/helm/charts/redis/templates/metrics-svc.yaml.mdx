---
title: "metrics-svc.yaml"
---

## High-level description
This YAML file defines a Kubernetes Service resource for Redis metrics. It's designed to expose metrics from a Redis deployment when metrics collection is enabled, providing a way to monitor Redis performance and health.

## Table of contents
- Service metadata
- Service specification
- Port configuration
- Selector

## Code Structure
The file uses Helm templating to dynamically generate a Kubernetes Service manifest. It heavily relies on conditional statements and helper templates to customize the Service based on the provided values.

## Symbols

### Service Definition
#### Description
Defines a Kubernetes Service resource for Redis metrics, conditionally created when metrics are enabled.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.metrics.enabled | boolean | Determines if the metrics service should be created |
| .Values.metrics.service | object | Contains configuration for the metrics service |
| .Values.commonLabels | object | Common labels to be applied to the service |
| .Values.commonAnnotations | object | Common annotations to be applied to the service |

#### Internal Logic
1. Checks if metrics are enabled
2. Sets metadata (name, namespace, labels, annotations)
3. Configures service type and IP settings
4. Defines ports for metrics
5. Sets selector for pod targeting

## Side Effects
Creates a Kubernetes Service resource when applied to a cluster, enabling external access to Redis metrics.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.names.fullname | Generates the full name for the service |
| common.names.namespace | Provides the namespace for the service |
| common.labels.standard | Generates standard labels |
| common.tplvalues.merge | Merges multiple sets of annotations |
| common.tplvalues.render | Renders template values |
| common.labels.matchLabels | Generates matching labels for selector |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| metrics.enabled | boolean | - | Enables or disables the metrics service |
| metrics.service.type | string | - | Defines the Kubernetes service type |
| metrics.service.clusterIP | string | - | Sets a specific cluster IP for the service |
| metrics.service.externalTrafficPolicy | string | - | Configures external traffic policy for LoadBalancer type |
| metrics.service.loadBalancerIP | string | - | Sets a specific load balancer IP |
| metrics.service.loadBalancerClass | string | - | Specifies the load balancer class |
| metrics.service.loadBalancerSourceRanges | list | - | Defines source IP ranges for load balancer |
| metrics.service.port | number | - | Specifies the port for the metrics service |
| metrics.service.extraPorts | list | - | Allows adding extra ports to the service |

## Future Improvements
- Consider adding support for different metrics exporters or collectors.
- Implement optional TLS configuration for secure metrics collection.
- Add support for service account configuration if needed for authentication.