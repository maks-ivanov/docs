---
title: "tls-secret.yaml"
---

## High-level description
This Helm template generates a Kubernetes TLS Secret for Redis, containing self-signed certificates for secure communication. It creates a CA, generates a signed certificate with multiple Subject Alternative Names (SANs), and stores the certificate, private key, and CA certificate in the Secret.

## Table of contents
- Secret creation condition
- Variable definitions
- CA and certificate generation
- Secret resource definition
- Secret data

## Code Structure
The template uses various Helm functions and helpers to generate the necessary components for the TLS Secret. It relies on common templates and functions for naming conventions and label generation.

## Symbols

### Redis TLS Secret Generation
#### Description
This template generates a Kubernetes Secret of type `kubernetes.io/tls` containing TLS certificates for Redis.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.clusterDomain | String | Kubernetes cluster domain |
| .Values.commonLabels | Map | Common labels to be applied to the Secret |
| .Values.commonAnnotations | Map | Common annotations to be applied to the Secret |

#### Internal Logic
1. Check if TLS Secret should be created using the `redis.createTlsSecret` helper function.
2. Generate variable names and values for use in the template.
3. Create a self-signed CA valid for 365 days.
4. Generate a list of Subject Alternative Names (SANs) for the certificate.
5. Create a signed certificate valid for 365 days using the generated CA and SANs.
6. Define the Kubernetes Secret resource with appropriate metadata.
7. Populate the Secret data with the generated certificates and keys.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.names.fullname | Generate consistent names for resources |
| common.names.namespace | Get the namespace for the release |
| common.labels.standard | Generate standard labels for resources |
| common.tplvalues.render | Render template values |
| common.secrets.lookup | Lookup secret values or use defaults |

## Error Handling
The template uses the `include "redis.createTlsSecret"` function to determine whether to create the TLS Secret. This helps prevent errors by only generating the Secret when necessary.

## Future Improvements
- Allow customization of certificate validity period (currently hardcoded to 365 days).
- Provide options for using external CAs or certificates instead of self-signed ones.
- Add support for certificate rotation or automatic renewal.