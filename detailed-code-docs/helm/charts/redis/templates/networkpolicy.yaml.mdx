---
title: "networkpolicy.yaml"
---

## High-level description
This Kubernetes NetworkPolicy YAML template defines network access rules for a Redis deployment. It controls ingress and egress traffic to Redis pods based on various configuration options, including architecture type, metrics, and custom policies.

## Table of contents
- NetworkPolicy definition
- Metadata
- Spec
  - Pod selector
  - Policy types
  - Egress rules
  - Ingress rules

## Code Structure
The main structure is a Kubernetes NetworkPolicy resource. It uses conditional statements and template functions to dynamically generate the policy based on the provided values.

## Symbols

### NetworkPolicy
#### Description
Defines a Kubernetes NetworkPolicy resource to control network traffic for Redis pods.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values | Object | Values provided to the Helm chart |

#### Internal Logic
1. Checks if network policy is enabled
2. Sets metadata (name, namespace, labels, annotations)
3. Defines pod selector
4. Specifies policy types (Ingress and optionally Egress)
5. Configures egress rules for replication architecture
6. Defines ingress rules for Redis and optionally Sentinel ports
7. Adds metrics-related ingress rules if enabled
8. Includes any extra ingress or egress rules specified in values

## Side Effects
This NetworkPolicy affects the network traffic to and from the Redis pods in the cluster.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.labels.standard | Generates standard labels |
| common.names.fullname | Generates the full name for resources |
| common.names.namespace | Retrieves the namespace |
| common.labels.matchLabels | Generates match labels for selectors |
| common.tplvalues.render | Renders template values |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| .Values.networkPolicy.enabled | boolean | - | Enables or disables the NetworkPolicy |
| .Values.architecture | string | - | Redis architecture (standalone or replication) |
| .Values.networkPolicy.allowExternal | boolean | - | Allows external connections to Redis |
| .Values.networkPolicy.extraEgress | list | - | Additional egress rules |
| .Values.networkPolicy.extraIngress | list | - | Additional ingress rules |
| .Values.metrics.enabled | boolean | - | Enables metrics exporter |
| .Values.networkPolicy.metrics.allowExternal | boolean | - | Allows external connections to metrics endpoint |

## Future Improvements
1. Consider adding support for more granular control over egress rules, especially for standalone architecture.
2. Implement optional rate limiting or connection throttling within the NetworkPolicy.
3. Add support for IPv6 policies if not already present.