---
title: "svc.yaml"
---

## High-level description
This YAML file defines a Kubernetes Service resource for PostgreSQL read replicas in a Helm chart. It creates a service to expose read-only PostgreSQL instances when the architecture is set to "replication".

## Table of contents
- Service metadata
- Service specification
- Port configuration
- Selector

## Code Structure
The file uses Helm templating to dynamically generate a Kubernetes Service manifest based on various configuration values.

## Symbols

### Service Definition
#### Description
Defines a Kubernetes Service resource for PostgreSQL read replicas.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.architecture | string | The architecture type of the PostgreSQL deployment |
| .Values.readReplicas.service | object | Configuration options for the read replica service |
| .Values.commonLabels | object | Common labels to be applied to the service |
| .Values.commonAnnotations | object | Common annotations to be applied to the service |

#### Internal Logic
1. Checks if the architecture is set to "replication"
2. Sets metadata (name, namespace, labels, annotations)
3. Configures service spec based on input values
4. Defines ports and selectors

## Side Effects
Creates a Kubernetes Service resource when deployed.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common | Provides helper templates for labels, annotations, and value merging |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| .Values.architecture | string | N/A | Determines if the service should be created |
| .Values.readReplicas.service.type | string | N/A | Type of the Kubernetes service |
| .Values.readReplicas.service.externalTrafficPolicy | string | N/A | External traffic policy for LoadBalancer or NodePort types |
| .Values.readReplicas.service.loadBalancerSourceRanges | list | N/A | Source IP ranges for LoadBalancer type |
| .Values.readReplicas.service.loadBalancerIP | string | N/A | Specific IP for LoadBalancer type |
| .Values.readReplicas.service.clusterIP | string | N/A | Specific cluster IP for ClusterIP type |
| .Values.readReplicas.service.sessionAffinity | string | N/A | Session affinity configuration |
| .Values.readReplicas.service.nodePorts.postgresql | number | N/A | Node port for PostgreSQL when using NodePort type |

## Future Improvements
- Consider adding support for IPv6 configurations
- Implement options for custom health checks or readiness probes
- Add support for service topology routing if needed for advanced use cases