---
title: "Overview"
---

## High-level description
This directory contains Helm chart templates for deploying and managing a PostgreSQL database in a Kubernetes environment. It provides a comprehensive set of resources for deploying both primary and read replica instances, managing backups, configuring security policies, and setting up monitoring.

## What does it do?
This Helm chart automates the deployment and management of a PostgreSQL database cluster in Kubernetes. It offers the following key functionalities:

1. Deploys a primary PostgreSQL instance as a StatefulSet with configurable resources, storage, and network policies.
2. Optionally deploys read replicas for improved read performance and high availability.
3. Sets up services for both internal and external access to the database.
4. Configures backup jobs using `pg_dumpall` with customizable schedules and storage options.
5. Implements security measures through Pod Security Policies, Role-Based Access Control (RBAC), and network policies.
6. Integrates with Prometheus for monitoring by setting up ServiceMonitors and custom metrics.
7. Provides flexibility for custom configurations and additional resource deployment.

## Entry points
The main entry points for this Helm chart are:

1. `templates/primary/statefulset.yaml`: Defines the primary PostgreSQL instance deployment.
2. `templates/read/statefulset.yaml`: Configures read replicas when enabled.
3. `templates/secrets.yaml`: Manages database credentials and connection information.
4. `templates/backup/cronjob.yaml`: Sets up scheduled backups of the database.

These files orchestrate the core functionality of the PostgreSQL deployment, while other templates provide supporting resources and configurations.

## Key Files
1. `primary/` directory:
   - `statefulset.yaml`: Defines the primary PostgreSQL instance.
   - `svc.yaml` and `svc-headless.yaml`: Create services for accessing the primary instance.
   - `configmap.yaml`: Stores PostgreSQL configuration files.
   - `networkpolicy.yaml`: Controls network access to the primary instance.

2. `read/` directory:
   - `statefulset.yaml`: Defines PostgreSQL read replicas.
   - `svc.yaml` and `svc-headless.yaml`: Create services for accessing read replicas.
   - `networkpolicy.yaml`: Controls network access to read replicas.

3. `backup/` directory:
   - `cronjob.yaml`: Schedules and executes database backups.
   - `pvc.yaml`: Defines persistent storage for backups.
   - `networkpolicy.yaml`: Controls network access for backup jobs.

4. Security and RBAC:
   - `psp.yaml`: Defines Pod Security Policy.
   - `role.yaml` and `rolebinding.yaml`: Set up RBAC for the PostgreSQL deployment.
   - `serviceaccount.yaml`: Creates a service account for PostgreSQL pods.

5. Monitoring:
   - `prometheusrule.yaml`: Defines Prometheus alerting rules.
   - `servicemonitor.yaml`: Sets up Prometheus ServiceMonitor for metrics collection.

6. Additional resources:
   - `extra-list.yaml`: Allows deployment of additional custom resources.
   - `tls-secrets.yaml`: Manages TLS certificates for secure connections.

These files work together to provide a complete, secure, and monitored PostgreSQL deployment solution in Kubernetes, with options for high availability, backups, and custom configurations.

## Dependencies
The chart relies on several external libraries and tools:

1. Kubernetes: The underlying container orchestration platform.
2. Helm: The package manager used for deploying the chart.
3. PostgreSQL: The core database engine.
4. Prometheus Operator: For advanced monitoring capabilities (optional).
5. cert-manager: For TLS certificate management (optional).

## Configuration
The chart is highly configurable through its `values.yaml` file. Key configuration options include:

1. PostgreSQL version and image settings
2. Resource allocation (CPU, memory, storage)
3. Authentication and database initialization settings
4. Replication configuration
5. Backup schedules and retention policies
6. Network policies and security settings
7. Monitoring and metrics collection options

Users can customize these settings to tailor the PostgreSQL deployment to their specific requirements and environment.