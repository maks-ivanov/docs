---
title: "prometheusrule.yaml"
---

## High-level description
This YAML template defines a PrometheusRule resource for monitoring PostgreSQL metrics in a Kubernetes environment. It is conditionally created based on metrics and PrometheusRule configuration values, allowing for custom monitoring rules to be applied.

## Table of contents
- Conditional creation check
- PrometheusRule resource definition
- Metadata configuration
- Spec configuration with rules

## Code Structure
The template uses conditional logic to determine whether to create the PrometheusRule resource. It then defines the resource structure, including metadata and spec sections, using various helper functions and value references.

## Symbols

### PrometheusRule Resource
#### Description
Defines a Kubernetes custom resource of type PrometheusRule, which is used by Prometheus Operator to create alerting and recording rules for PostgreSQL metrics.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.metrics.enabled | boolean | Determines if metrics are enabled |
| .Values.metrics.prometheusRule.enabled | boolean | Determines if PrometheusRule should be created |
| .Values.metrics.prometheusRule.namespace | string | Namespace for the PrometheusRule |
| .Values.metrics.prometheusRule.labels | map | Custom labels for the PrometheusRule |
| .Values.commonLabels | map | Common labels to be applied |
| .Values.commonAnnotations | map | Common annotations to be applied |
| .Values.metrics.prometheusRule.rules | list | List of Prometheus rules to be applied |

#### Internal Logic
1. Checks if metrics and PrometheusRule are enabled
2. Defines the PrometheusRule resource with apiVersion and kind
3. Sets metadata including name, namespace, labels, and annotations
4. Configures the spec section with groups and rules

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.names.fullname | Generates a full name for the resource |
| common.tplvalues.merge | Merges multiple sets of labels |
| common.labels.standard | Generates standard labels |
| common.tplvalues.render | Renders template values |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| metrics.enabled | boolean | - | Enables or disables metrics collection |
| metrics.prometheusRule.enabled | boolean | - | Enables or disables PrometheusRule creation |
| metrics.prometheusRule.namespace | string | .Release.Namespace | Namespace for the PrometheusRule |
| metrics.prometheusRule.rules | list | - | List of Prometheus rules to apply |

## Future Improvements
- Consider adding validation for the rules structure to ensure they conform to Prometheus rule format
- Implement support for multiple rule groups if needed
- Add options for rule-specific labels or annotations