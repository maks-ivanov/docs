---
title: "serviceaccount.yaml"
---

## High-level description
This YAML template defines a Kubernetes ServiceAccount resource for PostgreSQL. It is conditionally created based on the Helm chart values and includes customizable labels, annotations, and token automounting settings.

## Table of contents
- ServiceAccount resource definition
- Metadata configuration
- Labels and annotations
- Token automounting configuration

## Code Structure
The template uses Helm templating syntax to dynamically generate a Kubernetes ServiceAccount resource. It leverages helper functions from a common library for rendering labels and merging annotations.

## Symbols

### ServiceAccount Resource
#### Description
Defines a Kubernetes ServiceAccount resource for PostgreSQL, which is used to provide an identity for processes that run in a Pod.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.serviceAccount.create | boolean | Determines whether to create the ServiceAccount |
| .Values.serviceAccount.annotations | map | Custom annotations for the ServiceAccount |
| .Values.commonAnnotations | map | Common annotations to be applied |
| .Values.commonLabels | map | Common labels to be applied |
| .Values.serviceAccount.automountServiceAccountToken | boolean | Controls automounting of the service account token |

#### Outputs
A Kubernetes ServiceAccount resource YAML definition.

#### Internal Logic
1. Checks if ServiceAccount creation is enabled
2. Sets the API version and kind for the ServiceAccount
3. Configures metadata including name, namespace, labels, and annotations
4. Sets the automountServiceAccountToken flag

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.labels.standard | Generates standard labels |
| common.tplvalues.merge | Merges multiple annotation sources |
| common.tplvalues.render | Renders template values |
| postgresql.v1.serviceAccountName | Generates the ServiceAccount name |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| serviceAccount.create | boolean | - | Whether to create the ServiceAccount |
| serviceAccount.annotations | map | - | Custom annotations for the ServiceAccount |
| serviceAccount.automountServiceAccountToken | boolean | - | Controls automounting of the service account token |

## Future Improvements
- Consider adding support for imagePullSecrets if needed for private registries
- Implement conditional creation of additional RBAC resources (Role, RoleBinding) if required
- Add support for customizing the ServiceAccount name directly through values