---
title: "tls-secrets.yaml"
---

## High-level description
This Helm template generates a Kubernetes TLS Secret for PostgreSQL. It creates a self-signed CA certificate and a server certificate with appropriate Subject Alternative Names (SANs) for various PostgreSQL service endpoints.

## Table of contents
- Certificate and secret name generation
- Certificate Authority (CA) and server certificate creation
- Kubernetes Secret resource definition
- TLS data inclusion

## Code Structure
The template uses various Helm functions and helpers to generate certificates and construct the Kubernetes Secret. It relies on several include functions to populate values and labels.

## Symbols

### Certificate and Secret Generation
#### Description
This section generates the necessary certificates and defines the secret name.

#### Internal Logic
- Generates a CA certificate valid for 365 days
- Creates a list of alternative names for the server certificate
- Generates a signed server certificate valid for 365 days

### Kubernetes Secret Resource
#### Description
Defines a Kubernetes Secret of type `kubernetes.io/tls` to store the generated certificates.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Release.Namespace | string | The namespace where the secret will be created |
| .Values.commonLabels | map | Custom labels to be applied to the secret |
| .Values.commonAnnotations | map | Custom annotations to be applied to the secret |

#### Internal Logic
- Sets the secret name, namespace, labels, and annotations
- Includes the TLS certificate, private key, and CA certificate in the secret data

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.names.fullname | Generates a full name for resources |
| common.labels.standard | Applies standard labels to resources |
| common.tplvalues.render | Renders template values |
| common.secrets.lookup | Looks up secret values or uses defaults |

## Future Improvements
- Consider adding support for user-provided certificates instead of always generating self-signed ones
- Implement certificate rotation mechanism for long-running clusters
- Add option to customize the validity period of the generated certificates