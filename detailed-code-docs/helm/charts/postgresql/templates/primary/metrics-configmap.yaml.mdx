---
title: "metrics-configmap.yaml"
---

## High-level description
This Helm template generates a Kubernetes ConfigMap for custom PostgreSQL metrics when metrics are enabled and custom metrics are defined in the Helm values.

## Table of contents
- ConfigMap definition
- Metadata
- Data

## Code Structure
The template creates a single Kubernetes ConfigMap resource with metadata and data sections. The creation is conditional based on Helm values.

## Symbols

### ConfigMap
#### Description
Defines a Kubernetes ConfigMap resource to store custom metrics configuration for PostgreSQL.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.metrics.enabled | boolean | Flag to enable metrics |
| .Values.metrics.customMetrics | object | Custom metrics configuration |
| .Release.Namespace | string | Kubernetes namespace |
| .Values.commonLabels | object | Common labels to apply |
| .Values.commonAnnotations | object | Common annotations to apply |

#### Internal Logic
1. Checks if metrics are enabled and custom metrics are defined
2. Creates the ConfigMap with a dynamic name
3. Applies standard labels and optional annotations
4. Adds custom metrics configuration as data

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.labels.standard | Generates standard Kubernetes labels |
| common.tplvalues.render | Renders template values |
| postgresql.v1.primary.fullname | Generates the full name for the PostgreSQL primary instance |

### Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| metrics.enabled | boolean | - | Enables or disables metrics collection |
| metrics.customMetrics | object | - | Custom metrics configuration |

## Future Improvements
- Consider adding validation for the custom metrics configuration format
- Implement versioning for the custom metrics configuration to track changes