---
title: "configmap.yaml"
---

## High-level description
This Kubernetes ConfigMap template is designed for PostgreSQL primary instances. It creates a ConfigMap containing PostgreSQL configuration files (`postgresql.conf` and `pg_hba.conf`) based on user-defined values.

## Table of contents
- ConfigMap metadata
- ConfigMap data
  - postgresql.conf
  - pg_hba.conf

## Code Structure
The template uses conditional statements and includes to generate the ConfigMap. It relies on helper templates and values defined elsewhere in the Helm chart.

## Symbols

### ConfigMap
#### Description
Defines a Kubernetes ConfigMap resource for storing PostgreSQL configuration files.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.commonLabels | map | Custom labels to be applied to the ConfigMap |
| .Values.commonAnnotations | map | Custom annotations to be applied to the ConfigMap |
| .Values.primary.configuration | string | Content for postgresql.conf |
| .Values.primary.pgHbaConfiguration | string | Content for pg_hba.conf |

#### Internal Logic
1. Checks if the ConfigMap should be created using the `postgresql.v1.primary.createConfigmap` helper.
2. Sets metadata including name, namespace, labels, and annotations.
3. Conditionally includes `postgresql.conf` and `pg_hba.conf` in the ConfigMap data based on provided values.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common | Provides helper templates for labels, annotations, and value rendering |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| .Values.primary.configuration | string | - | Content for postgresql.conf |
| .Values.primary.pgHbaConfiguration | string | - | Content for pg_hba.conf |

## Future Improvements
1. Consider adding support for additional PostgreSQL configuration files (e.g., `recovery.conf` for replication setup).
2. Implement validation for the configuration content to ensure it adheres to PostgreSQL syntax and best practices.
3. Add the ability to merge user-provided configurations with default configurations, allowing for easier customization without overwriting all defaults.