---
title: "svc.yaml"
---

## High-level description
This YAML file defines a Kubernetes Service resource for the primary PostgreSQL instance in a Helm chart. It configures various aspects of the service, including its type, traffic policies, and port mappings, with extensive use of Helm templating for flexibility.

## Table of contents
- Service metadata
- Service specification
- Port configuration
- Selector

## Code Structure
The file is structured as a single Kubernetes Service resource, with various sections utilizing Helm templating to dynamically set values based on the chart's configuration.

## Symbols

### Service Resource
#### Description
Defines a Kubernetes Service for the primary PostgreSQL instance, with configurable properties through Helm values.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values | Object | Helm values object containing configuration options |
| .Release | Object | Helm release object with release-specific information |

#### Internal Logic
1. Sets metadata (name, namespace, labels, annotations)
2. Configures service type and related properties
3. Defines port mappings
4. Sets selector for pod targeting

## Side Effects
- Creates or updates a Kubernetes Service resource in the specified namespace

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common | Provides helper templates for labels, annotations, and value rendering |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| .Values.primary.service.type | String | N/A | Defines the Kubernetes Service type |
| .Values.primary.service.externalTrafficPolicy | String | N/A | Sets the external traffic policy for LoadBalancer or NodePort types |
| .Values.primary.service.loadBalancerSourceRanges | List | N/A | Specifies allowed source IP ranges for LoadBalancer type |
| .Values.primary.service.loadBalancerIP | String | N/A | Sets a specific LoadBalancer IP if supported by the cloud provider |
| .Values.primary.service.clusterIP | String | N/A | Specifies a fixed clusterIP for ClusterIP type services |
| .Values.primary.service.sessionAffinity | String | N/A | Configures session affinity for the service |
| .Values.primary.service.nodePorts.postgresql | Integer | N/A | Specifies a static nodePort for NodePort or LoadBalancer types |
| .Values.primary.service.extraPorts | List | N/A | Allows defining additional service ports |

## Future Improvements
- Consider adding support for IPv6 configurations
- Implement optional health check configurations for the service
- Add support for custom labels and annotations at the port level