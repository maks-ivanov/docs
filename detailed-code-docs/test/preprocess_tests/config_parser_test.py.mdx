---
title: "config_parser_test.py"
---

## High-level description

The `config_parser_test.py` file is a unit test suite designed to validate the configuration parsing functionality for the `cassiopeia_preprocess` pipeline. It uses the `unittest` framework to ensure that configuration files are correctly parsed, that errors are raised for invalid configurations, and that the pipeline setup is correctly initialized based on the configuration parameters.

## Code Structure

The main class in this file is `TestCollapseUMIs`, which inherits from `unittest.TestCase`. This class contains several test methods that validate different aspects of the configuration parsing and pipeline setup. The tests rely on the `setup_utilities` module to parse configuration strings and create pipeline procedures.

## Symbols

### `TestCollapseUMIs`
#### Description
This class contains unit tests for verifying the configuration parsing and pipeline setup for the `cassiopeia_preprocess` pipeline. It checks that configurations are read correctly, that errors are raised for missing parameters, and that the pipeline is set up as expected.

#### Methods

- **`setUp`**: Initializes configuration strings and dictionaries used in the tests.
- **`test_read_good_config`**: Validates that a well-formed configuration string is parsed correctly and that default parameters are set as expected.
- **`test_unspecified_config_raises_error`**: Ensures that an error is raised when required configuration parameters are missing.
- **`test_pipeline_setup_correct`**: Checks that the pipeline is set up correctly from the entry to the exit point using a full configuration.
- **`test_subset_pipeline_setup_correct`**: Verifies that a subset of the pipeline is set up correctly based on specified entry and exit points.

#### Inputs
- **`basic_config_string`**: A string representation of a complete configuration.
- **`subset_config_string`**: A string representation of a partial configuration.
- **`failure_config_string`**: A string representation of an incomplete configuration.

#### Outputs
- **`parameters`**: A dictionary of parsed configuration parameters.
- **`pipeline_procedures`**: A list of pipeline stages to be executed.

#### Internal Logic
- The `setUp` method constructs configuration strings from dictionaries for use in tests.
- The `test_read_good_config` method checks that default and specified parameters are correctly parsed.
- The `test_unspecified_config_raises_error` method verifies that missing required parameters result in an error.
- The `test_pipeline_setup_correct` and `test_subset_pipeline_setup_correct` methods ensure that the pipeline stages are correctly determined based on the configuration.

## References

- **`setup_utilities.parse_config`**: Parses configuration strings into parameter dictionaries.
- **`setup_utilities.create_pipeline`**: Creates a list of pipeline procedures based on entry and exit points.
- **`cassiopeia_preprocess.STAGES`**: A dictionary mapping stage names to their corresponding functions.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the testing framework for writing and running tests. |
| `pandas` | Used for data manipulation and analysis, though not directly in this test file. |
| `cassiopeia.preprocess.setup_utilities` | Contains utility functions for parsing configurations and setting up pipelines. |

## Error Handling

- The `test_unspecified_config_raises_error` method checks for `UnspecifiedConfigParameterError` to ensure that missing configuration parameters are properly handled.

## Logging

- The test file itself does not implement logging, but it tests configurations that may affect logging behavior in the main pipeline.

## TODOs

- There are no TODOs or notes left in the code.