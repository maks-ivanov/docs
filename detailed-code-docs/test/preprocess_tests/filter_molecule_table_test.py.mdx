---
title: "filter_molecule_table_test.py"
---

## High-level description

The target file `filter_molecule_table_test.py` is a unit test suite designed to validate the functionality of the `filter_molecule_table` function from the `cassiopeia.preprocess.pipeline` module. This test suite ensures that the function correctly filters and processes molecular data tables, which are crucial for preprocessing sequencing data for phylogenetic analysis. The tests cover various scenarios, including format validation, filtering based on UMI and cell barcodes, handling doublets, error correction, and conflict resolution.

## Code Structure

The test suite is structured using the `unittest` framework, with a class `TestFilterMolculeTable` that contains multiple test methods. Each test method is designed to test a specific aspect of the `filter_molecule_table` function. The `setUp` method initializes test data, and the `tearDown` method cleans up any temporary resources used during testing.

## Symbols

### `TestFilterMolculeTable`
#### Description
This class is a test suite for the `filter_molecule_table` function. It contains setup and teardown methods for preparing test data and cleaning up resources, as well as several test methods that validate different functionalities of the `filter_molecule_table` function.

#### Inputs
- None directly, but uses predefined data frames as inputs for the tests.

#### Outputs
- None directly, but asserts conditions to validate the outputs of the `filter_molecule_table` function.

### `setUp`
#### Description
Prepares the test environment by creating several pandas DataFrames that simulate different scenarios of molecular data. These DataFrames are used as inputs for the test cases.

#### Inputs
- None

#### Outputs
- Initializes instance variables with test data.

### `tearDown`
#### Description
Cleans up the test environment by removing any temporary directories created during the tests.

#### Inputs
- None

#### Outputs
- None

### `test_format`
#### Description
Tests whether the `filter_molecule_table` function returns a DataFrame with the expected columns.

#### Inputs
- None directly, uses `self.base_filter_case` as input.

#### Outputs
- Asserts that the output DataFrame contains specific columns.

### `test_umi_and_cellbc_filter`
#### Description
Validates that the `filter_molecule_table` function correctly filters UMIs and cell barcodes based on specified thresholds.

#### Inputs
- None directly, uses `self.base_filter_case` as input.

#### Outputs
- Asserts that the filtered DataFrame contains expected read counts for specific read names.

### `test_doublet_and_map`
#### Description
Tests the function's ability to handle doublets and map them correctly based on a specified threshold.

#### Inputs
- None directly, uses `self.doublets_case` as input.

#### Outputs
- Asserts that the alleles in the output DataFrame match expected values for specific read names.

### `test_error_correct_intBC`
#### Description
Checks if the function correctly error-corrects integration barcodes (intBC) based on a whitelist.

#### Inputs
- None directly, uses `self.intBC_case` as input.

#### Outputs
- Asserts that the intBCs in the output DataFrame match expected values for specific read names.

### `test_filter_allow_conflicts`
#### Description
Tests the function's behavior when allowing allele conflicts during filtering.

#### Inputs
- None directly, uses `self.doublets_case` as input.

#### Outputs
- Asserts that the intBCs in the output DataFrame match expected values for specific read names.

## References

- `pipeline.filter_molecule_table`: The function being tested, which is part of the `cassiopeia.preprocess.pipeline` module.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the framework for writing and running tests. |
| `pandas` | Used for creating and manipulating DataFrames, which are the primary data structures in the tests. |
| `cassiopeia.preprocess.pipeline` | Contains the `filter_molecule_table` function that is being tested. |

## Error Handling

The test suite uses assertions to handle errors. If an assertion fails, it indicates that the `filter_molecule_table` function did not produce the expected output, and the test will report a failure.

## Logging

No explicit logging is implemented in the test suite. The `unittest` framework provides output regarding test results, including any failures or errors encountered during execution.