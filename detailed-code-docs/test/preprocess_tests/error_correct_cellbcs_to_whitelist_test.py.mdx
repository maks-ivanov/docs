---
title: "error_correct_cellbcs_to_whitelist_test.py"
---

## High-level description

The target file, `error_correct_cellbcs_to_whitelist_test.py`, is a unit test script designed to verify the functionality of the `error_correct_cellbcs_to_whitelist` function from the `pipeline.py` module. This function is responsible for correcting raw cell barcodes in BAM files to match a given whitelist of barcodes, which is crucial for ensuring data integrity in sequencing experiments. The test script uses the `unittest` framework to define and execute a series of tests that check the correctness of barcode correction for different datasets and whitelist formats.

## Code Structure

The main class in the code is `TestErrorCorrectCellBCsToWhitelist`, which inherits from `unittest.TestCase`. This class contains setup methods and test methods that are executed to validate the functionality of the barcode correction process. The tests are structured to handle different scenarios, such as using a file-based whitelist and a list-based whitelist, and they cover different sequencing chemistries like 10x Genomics v3 and Slide-seq2.

## Symbols

### `TestErrorCorrectCellBCsToWhitelist`
#### Description
This class is a test case for the `error_correct_cellbcs_to_whitelist` function. It sets up the necessary file paths and data for testing and contains methods to test the function's behavior with different inputs.

#### Inputs
- None directly, but it uses file paths and data initialized in the `setUp` method.

#### Outputs
- None directly, but it asserts conditions to validate the function's behavior.

#### Internal Logic
- **`setUp` Method**: Initializes file paths for test BAM files and whitelists. It sets up the environment for the tests by defining paths to test files and expected whitelist barcodes.
- **`test_10xv3` Method**: Tests the correction of cell barcodes using a file-based whitelist for 10x Genomics v3 data. It checks that the number of alignments and the corrected barcodes match expected values.
- **`test_10xv3_whitelist_list` Method**: Similar to `test_10xv3`, but uses a list of barcodes instead of a file.
- **`test_slideseq2` Method**: Tests the correction of cell barcodes for Slide-seq2 data using a file-based whitelist. It verifies the presence and correctness of the corrected barcodes.
- **`test_slideseq2_whitelist_list` Method**: Similar to `test_slideseq2`, but uses a list of barcodes instead of a file.

## References

- **`pipeline.error_correct_cellbcs_to_whitelist`**: This function from the `pipeline.py` module is the primary function being tested. It performs the error correction of cell barcodes against a whitelist.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the framework for writing and running tests. |
| `pysam` | Used for reading and writing BAM files, which are central to the tests. |
| `ngs_tools` | Likely used for sequence manipulation and correction, though not directly referenced in the test file. |
| `cassiopeia.preprocess.pipeline` | Contains the function being tested. |

## Error Handling

The test methods use assertions to handle errors. If the conditions specified in the assertions are not met, the test will fail, indicating an issue with the barcode correction process.

## Logging

No explicit logging is implemented in the test file. The focus is on using assertions to validate outcomes.

## TODOs

No TODOs are present in the code.