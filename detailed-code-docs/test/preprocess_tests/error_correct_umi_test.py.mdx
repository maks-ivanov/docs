---
title: "error_correct_umi_test.py"
---

## High-level description

The target file `error_correct_umi_test.py` is a unit test suite designed to validate the functionality of the `error_correct_umis` function from the `cassiopeia` library. This function is part of the preprocessing pipeline and is responsible for correcting errors in Unique Molecular Identifiers (UMIs) within sequencing data. The tests ensure that the function correctly formats the output, handles different UMI distance thresholds, and manages allele conflicts.

## Code Structure

The main class in this file is `TestErrorCorrectUMISequence`, which inherits from `unittest.TestCase`. This class contains several test methods that each test different aspects of the `error_correct_umis` function. The test methods use data frames created in the `setUp` method to simulate different scenarios and validate the function's behavior.

## Symbols

### `TestErrorCorrectUMISequence`
#### Description
This class is a test suite for the `error_correct_umis` function. It uses the `unittest` framework to define a series of tests that check the function's behavior under various conditions.

#### Inputs
- None directly, but it uses data frames defined in the `setUp` method for testing.

#### Outputs
- None directly, but it asserts conditions to validate the function's output.

#### Internal Logic
- **`setUp` Method**: Initializes test data frames `multi_case` and `ambiguous` with simulated sequencing data. These data frames are used in the test methods to provide input to the `error_correct_umis` function.
- **`test_format` Method**: Checks if the output data frame from `error_correct_umis` contains the expected columns.
- **`test_zero_dist` Method**: Verifies that when `max_umi_distance` is set to 0, the output data frame has the same number of rows as the input, indicating no error correction.
- **`test_error_correct_two_dist` Method**: Tests the function with a `max_umi_distance` of 2 and checks if the read counts in the output match expected values.
- **`test_error_correct_allow_conflicts` Method**: Tests the function with `allow_allele_conflicts` set to `True` and verifies the output read counts.

## References

- **`cassiopeia.pp.error_correct_umis`**: The function being tested, which is part of the `cassiopeia` library's preprocessing module.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the testing framework. |
| `numpy` | Used for numerical operations, though not directly in this file. |
| `pandas` | Used to create and manipulate data frames for testing. |
| `cassiopeia` | The library containing the `error_correct_umis` function being tested. |

## Error Handling

The test methods use assertions to handle errors. If an assertion fails, it indicates that the `error_correct_umis` function did not behave as expected under the test conditions.

## Logging

No explicit logging is implemented in this test file. The `unittest` framework handles test results and outputs.

## TODOs

No TODOs or notes are present in the code.