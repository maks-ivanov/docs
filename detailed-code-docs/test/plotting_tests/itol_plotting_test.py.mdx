---
title: "itol_plotting_test.py"
---

## High-level description

The `itol_plotting_test.py` file is a unit testing module designed to test the functionality of the `itol_utilities` module within the `cassiopeia.plotting` package. This module primarily focuses on testing the generation of various files used for visualizing phylogenetic trees with the iTOL (Interactive Tree of Life) platform. The tests cover the creation of gradient files, color bar files, and allele heatmaps, as well as the integration of these components into a pipeline for uploading and exporting trees to iTOL.

## Code Structure

The main class in this file is `TestITOLPlotting`, which is a subclass of `unittest.TestCase`. This class contains several test methods that validate different functionalities of the `itol_utilities` module. The tests are organized to check the creation of gradient files, color bar files, allele heatmaps, and the integration of these components into a complete pipeline for tree visualization.

## References

The test file references the `itol_utilities` module from the `cassiopeia.plotting` package, which contains the functions being tested. It also uses the `CassiopeiaTree` class from the `cassiopeia.data` module to create and manipulate phylogenetic trees.

## Symbols

### `TestITOLPlotting`
#### Description
This class is a test suite for the `itol_utilities` module, using the `unittest` framework. It sets up a testing environment, executes various tests on the utility functions, and cleans up after the tests are run.

#### Inputs
- None directly, but it uses class-level setup to initialize test data.

#### Outputs
- None directly, but it asserts conditions to validate the correctness of the utility functions.

#### Internal Logic
- **setUp**: Initializes a temporary directory, random state, indel frequency dictionary, allele table, and a `CassiopeiaTree` instance for use in tests.
- **tearDown**: Cleans up by removing the temporary directory created during setup.

### `test_generate_gradient_file`
#### Description
Tests the creation of a gradient file from numerical data in the `CassiopeiaTree` cell metadata.

#### Inputs
- None directly, uses initialized `CassiopeiaTree` and temporary directory.

#### Outputs
- Asserts that the gradient file is created and its content matches the expected format.

### `test_generate_colorbar_file`
#### Description
Tests the creation of a color bar file from categorical data in the `CassiopeiaTree` cell metadata.

#### Inputs
- None directly, uses initialized `CassiopeiaTree` and temporary directory.

#### Outputs
- Asserts that the color bar file is created and its content matches the expected format.

### `test_generate_colorbar_file_with_legend`
#### Description
Tests the creation of a color bar file with an included legend.

#### Inputs
- None directly, uses initialized `CassiopeiaTree` and temporary directory.

#### Outputs
- Asserts that the color bar file with a legend is created and its content matches the expected format.

### `test_create_allele_heatmap_specified_colors`
#### Description
Tests the creation of allele heatmap files using specified colors for indels.

#### Inputs
- None directly, uses initialized `allele_table`, `CassiopeiaTree`, and temporary directory.

#### Outputs
- Asserts that the correct number of allele heatmap files are created and exist.

### `test_create_allele_heatmap_specified_priors`
#### Description
Tests the creation of allele heatmap files using specified indel priors.

#### Inputs
- None directly, uses initialized `allele_table`, `CassiopeiaTree`, and temporary directory.

#### Outputs
- Asserts that the correct number of allele heatmap files are created and exist.

### `test_create_allele_heatmap_no_priors_or_colormap`
#### Description
Tests the creation of allele heatmap files without specified priors or colormap.

#### Inputs
- None directly, uses initialized `allele_table`, `CassiopeiaTree`, and temporary directory.

#### Outputs
- Asserts that the correct number of allele heatmap files are created and exist.

### `test_integrated_pipeline_simple_tree`
#### Description
Tests the integrated pipeline for uploading and exporting a simple tree to iTOL.

#### Inputs
- None directly, uses initialized `CassiopeiaTree` and temporary directory.

#### Outputs
- Asserts that the exported tree file exists.

### `test_integrated_pipeline_tree_with_allele_heatmap`
#### Description
Tests the integrated pipeline for uploading and exporting a tree with an allele heatmap to iTOL.

#### Inputs
- None directly, uses initialized `CassiopeiaTree`, `allele_table`, and temporary directory.

#### Outputs
- Asserts that the exported tree file exists.

### `test_integrated_pipeline_tree_with_meta_data`
#### Description
Tests the integrated pipeline for uploading and exporting a tree with metadata to iTOL.

#### Inputs
- None directly, uses initialized `CassiopeiaTree` and temporary directory.

#### Outputs
- Asserts that the exported tree file exists.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the testing framework. |
| `os`, `shutil`, `tempfile` | Used for file and directory operations. |
| `networkx`, `numpy`, `pandas` | Used for data manipulation and graph operations. |
| `cassiopeia` | Provides the `CassiopeiaTree` class and plotting utilities. |

## Error Handling

The tests use assertions to validate the correctness of the utility functions. If an assertion fails, it indicates a discrepancy between the expected and actual outcomes, which helps identify issues in the code.

## TODOs

The module notes that it currently does not test the actual uploading/exporting of trees due to difficulties in mock authentication with iTOL. This is a potential area for future improvement.