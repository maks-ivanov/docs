---
title: "dissimilarity_functions_test.py"
---

## High-level description

The `dissimilarity_functions_test.py` file contains unit tests for various dissimilarity functions used in the `DistanceSolver` module of the Cassiopeia library. These tests ensure that the dissimilarity functions, which are used to compare phylogenetic samples, behave as expected under different conditions and with different input parameters, such as weights derived from prior probabilities.

## Code Structure

The main class in this file is `TestDissimilarityFunctions`, which is a subclass of `unittest.TestCase`. This class contains several test methods that validate the functionality of dissimilarity functions and prior transformation utilities. The tests are organized to cover different aspects of the dissimilarity functions, including handling of missing data, use of weights, and different types of prior transformations.

## References

- `dissimilarity_functions`: This module provides the dissimilarity functions being tested, such as `weighted_hamming_distance`, `hamming_similarity_without_missing`, and others.
- `solver_utilities`: This module provides utility functions like `transform_priors` and `save_dissimilarity_as_phylip`, which are used in the tests.

## Symbols

### `TestDissimilarityFunctions`
#### Description
This class contains unit tests for the dissimilarity functions and prior transformation utilities. It sets up test data and defines various test cases to validate the correctness of these functions.

#### Inputs
- None directly, but uses predefined arrays and dictionaries as test data.

#### Outputs
- None directly, but uses assertions to validate expected outcomes.

#### Internal Logic
- `setUp`: Initializes test data, including sample arrays, ambiguous data, and prior probabilities.
- `test_bad_prior_transformations`: Tests that invalid prior transformations raise a `PriorTransformationError`.
- `test_negative_log_prior_transformations`: Validates the transformation of priors using the negative log method.
- `test_inverse_prior_transformations`: Validates the transformation of priors using the inverse method.
- `test_sq_inverse_prior_transformations`: Validates the transformation of priors using the square root inverse method.
- `test_weighted_hamming_distance_identical`: Tests the weighted Hamming distance for identical samples.
- `test_weighted_hamming_distance_no_priors`: Tests the weighted Hamming distance without using priors.
- `test_weighted_hamming_distance_priors_negative_log`: Tests the weighted Hamming distance using negative log priors.
- `test_weighted_hamming_distance_priors_inverse`: Tests the weighted Hamming distance using inverse priors.
- `test_weighted_hamming_distance_priors_sq_inverse`: Tests the weighted Hamming distance using square root inverse priors.
- `test_weighted_hamming_distance_all_missing`: Tests the weighted Hamming distance when all data is missing.
- `test_hamming_similarity_without_missing_identical`: Tests the Hamming similarity without missing data for identical samples.
- `test_hamming_similarity_without_missing_no_priors`: Tests the Hamming similarity without missing data and without priors.
- `test_hamming_similarity_without_missing_priors`: Tests the Hamming similarity without missing data using priors.
- `test_hamming_similarity_without_missing_all_missing`: Tests the Hamming similarity without missing data when all data is missing.
- `test_hamming_similarity_normalized_identical`: Tests the normalized Hamming similarity for identical samples.
- `test_hamming_similarity_normalized_no_priors`: Tests the normalized Hamming similarity without priors.
- `test_hamming_similarity_normalized_priors`: Tests the normalized Hamming similarity using priors.
- `test_hamming_similarity_normalized_all_missing`: Tests the normalized Hamming similarity when all data is missing.
- `test_weighted_hamming_similarity_identical`: Tests the weighted Hamming similarity for identical samples.
- `test_weighted_hamming_similarity_no_priors`: Tests the weighted Hamming similarity without priors.
- `test_weighted_hamming_similarity_priors`: Tests the weighted Hamming similarity using priors.
- `test_weighted_hamming_similarity_all_missing`: Tests the weighted Hamming similarity when all data is missing.
- `test_cluster_dissimilarity`: Tests the cluster dissimilarity function with a specified linkage function.
- `test_cluster_dissimilarity_weighted_hamming_distance_min_linkage`: Tests the cluster dissimilarity function using weighted Hamming distance with minimum linkage.
- `test_hamming_distance`: Tests the basic Hamming distance function.
- `test_hamming_distance_ignore_missing`: Tests the Hamming distance function with the option to ignore missing data.
- `test_save_dissimilarity_as_phylip`: Tests the function to save a dissimilarity map as a PHYLIP file format.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the framework for writing and running tests. |
| `mock` | Used to mock file operations in tests. |
| `numpy` | Used for numerical operations and array manipulations. |
| `pandas` | Used for handling data frames, particularly in the PHYLIP file test. |
| `cassiopeia.solver.dissimilarity_functions` | Provides the dissimilarity functions being tested. |
| `cassiopeia.solver.solver_utilities` | Provides utility functions for prior transformations and saving dissimilarity maps. |

## Error Handling

- The test `test_bad_prior_transformations` checks for the `PriorTransformationError` to ensure that invalid prior transformations are correctly handled.

## Logging

- No explicit logging is implemented in this test file.

## TODOs

- The related code snippet in `dissimilarity_functions.py` contains a TODO comment suggesting optimization using masks for the `hamming_similarity_without_missing` and `hamming_similarity_normalized_over_missing` functions. This is not directly related to the test file but indicates potential areas for performance improvement in the functions being tested.