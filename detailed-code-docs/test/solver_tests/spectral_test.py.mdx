---
title: "spectral_test.py"
---

## High-level description

The `spectral_test.py` file is a unit test suite for the `SpectralSolver` class, which is part of the Cassiopeia library. This test suite uses the `unittest` framework to verify the functionality of the `SpectralSolver` and related graph utilities, ensuring that the solver correctly constructs similarity graphs, computes similarity scores, and partitions data using spectral methods.

## Code Structure

The main components of the code are the `SpectralSolverTest` class, which contains multiple test methods, and the `find_triplet_structure` function. The test methods in `SpectralSolverTest` are designed to test different aspects of the `SpectralSolver` and its associated utilities, such as similarity computation, graph construction, and tree solving.

## References

- `SpectralSolver`: The main class being tested, which is responsible for solving phylogenetic trees using spectral methods.
- `graph_utilities`: A module providing utility functions for graph construction and manipulation.
- `dissimilarity_functions`: A module providing functions to compute similarity or dissimilarity between samples.

## Symbols

### `find_triplet_structure`
#### Description
This function determines the structure of a triplet (three nodes) in a given tree by comparing their common ancestors.

#### Inputs
| Name   | Type       | Description                        |
|:-------|:-----------|:-----------------------------------|
| triplet| tuple      | A tuple of three nodes.            |
| T      | nx.DiGraph | A directed graph representing a tree.|

#### Outputs
| Name     | Type   | Description                                      |
|:---------|:-------|:-------------------------------------------------|
| structure| str    | A string indicating the structure of the triplet.|

#### Internal Logic
- The function calculates the ancestors for each node in the triplet.
- It then computes the number of common ancestors between each pair of nodes.
- Based on the number of common ancestors, it determines the structure of the triplet as "ab", "ac", or "bc".

### `SpectralSolverTest`
#### Description
A test class that extends `unittest.TestCase` to test the functionality of the `SpectralSolver` and related utilities.

#### Test Methods
- `test_similarity`: Tests the `hamming_similarity_without_missing` function for computing similarity scores between character vectors.
- `test_similarity_weighted`: Similar to `test_similarity`, but includes weights for character states.
- `test_graph_construction`: Tests the construction of a similarity graph using the `construct_similarity_graph` function.
- `test_graph_construction_weighted`: Similar to `test_graph_construction`, but includes weights for character states.
- `test_hill_climb`: Tests the `spectral_improve_cut` function for optimizing graph partitions.
- `test_simple_base_case`: Tests the `SpectralSolver` on a simple character matrix to verify tree topology.
- `test_simple_base_case_string`: Similar to `test_simple_base_case`, but includes string-based character states.
- `test_simple_base_case2`: Another test for `SpectralSolver` with a different character matrix.
- `test_simple_base_case2_priors`: Tests `SpectralSolver` with prior probabilities for character states.

## Dependencies

| Dependency | Purpose                                      |
|:-----------|:---------------------------------------------|
| `unittest` | Provides the testing framework.              |
| `networkx` | Used for graph operations and tree structures.|
| `pandas`   | Used for handling character matrices.        |
| `cassiopeia` | The main library being tested.             |

## Error Handling

The test suite uses assertions to verify expected outcomes. If an assertion fails, it indicates a discrepancy between the expected and actual behavior of the code being tested.

## Logging

No explicit logging is implemented in this test suite. The focus is on using assertions to validate functionality.

## TODOs

There are no TODOs or notes left in the code.