---
title: "complete_binary_simulator_test.py"
---

## High-level description

The `complete_binary_simulator_test.py` file contains unit tests for the `CompleteBinarySimulator` class, which is part of the Cassiopeia library. This simulator is designed to generate complete binary trees, and the tests ensure that the simulator initializes correctly and produces the expected tree structure and properties.

## Code Structure

The main class in this file is `TestCompleteBinarySimulator`, which is a subclass of `unittest.TestCase`. This class contains two test methods: `test_init` and `test_simulate_tree`. These methods test the initialization and tree simulation functionalities of the `CompleteBinarySimulator` class, respectively.

## References

- `TreeSimulatorError`: This is an exception class imported from `cassiopeia.mixins` and is used to handle errors specific to tree simulation.
- `CompleteBinarySimulator`: This is the class being tested, imported from `cassiopeia.simulator`.

## Symbols

### `TestCompleteBinarySimulator`
#### Description
This class contains unit tests for the `CompleteBinarySimulator` class. It verifies that the simulator raises appropriate errors during initialization and correctly simulates a complete binary tree.

#### Methods

#### `test_init`
##### Description
Tests the initialization of the `CompleteBinarySimulator` class, ensuring that it raises `TreeSimulatorError` when initialized with invalid parameters and correctly sets the depth when valid parameters are provided.

##### Inputs
None

##### Outputs
None

##### Internal Logic
- Attempts to initialize `CompleteBinarySimulator` without parameters, expecting a `TreeSimulatorError`.
- Attempts to initialize with `num_cells=3`, expecting a `TreeSimulatorError` because 3 is not a power of 2.
- Attempts to initialize with `depth=0`, expecting a `TreeSimulatorError` because depth must be greater than 0.
- Initializes with `num_cells=4` and checks if the depth is set to 2, which is the correct depth for 4 cells.

#### `test_simulate_tree`
##### Description
Tests the `simulate_tree` method of the `CompleteBinarySimulator` class, ensuring that it generates a tree with the correct structure and branch lengths.

##### Inputs
None

##### Outputs
None

##### Internal Logic
- Simulates a tree with `depth=2` and verifies the nodes, leaves, and edges of the tree.
- Checks that the branch lengths are correctly normalized, ensuring the tree has a height of 1.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `numpy` | Used for mathematical operations, specifically for checking powers of 2. |
| `unittest` | Provides the framework for writing and running tests. |
| `cassiopeia.mixins` | Provides the `TreeSimulatorError` class for error handling. |
| `cassiopeia.simulator` | Contains the `CompleteBinarySimulator` class being tested. |

## Error Handling

The tests in this file primarily check for `TreeSimulatorError` exceptions, which are raised by the `CompleteBinarySimulator` class when invalid parameters are provided during initialization.

## Logging

No logging mechanisms are implemented in this test file.

## TODOs

There are no TODOs or notes left in the code.