---
title: "cas9_lineage_tracing_simulator_test.py"
---

## High-level description

The target file `cas9_lineage_tracing_simulator_test.py` is a unit test suite for the `Cas9LineageTracingDataSimulator` class, which is part of the Cassiopeia library. This test suite is designed to verify the functionality of the Cas9-based lineage tracing data simulator by testing various configurations and edge cases, ensuring that the simulator behaves as expected when generating lineage tracing data.

## Code Structure

The main class in this file is `TestCas9LineageTracingDataSimulator`, which is a subclass of `unittest.TestCase`. This class contains several test methods that set up different scenarios and configurations for the `Cas9LineageTracingDataSimulator` and verify its behavior through assertions.

## Symbols

### `TestCas9LineageTracingDataSimulator`
#### Description
This class is a test suite for the `Cas9LineageTracingDataSimulator`. It uses the `unittest` framework to define a series of tests that validate the simulator's behavior under various conditions.

#### Inputs
- None directly, but it uses configurations and parameters for the simulator within its methods.

#### Outputs
- None directly, but it produces test results indicating pass or fail for each test case.

#### Internal Logic
- **`setUp` Method**: Initializes common test data and simulator configurations used across multiple test cases. It sets up a basic tree topology and several instances of `Cas9LineageTracingDataSimulator` with different parameters.
- **`test_basic_setup` Method**: Verifies the basic setup of the simulator, including the number of characters, silencing rates, and mutation priors.
- **`test_setup_errors` Method**: Tests various invalid configurations to ensure that the simulator raises appropriate errors.
- **`test_get_cassettes` Method**: Checks that the simulator correctly identifies cassette indices.
- **`test_introduce_states` Method**: Validates the introduction of states into a character array.
- **`test_silence_cassettes` Method**: Tests the silencing of cassettes based on a given silencing rate.
- **`test_collapse_sites` Method**: Verifies the behavior of collapsing sites within cassettes.
- **`test_simulator_basic` Method**: Tests the simulator's ability to overlay data onto a tree and checks the resulting character matrix.
- **`test_no_collapse` Method**: Ensures that the simulator behaves correctly when site collapse is disabled.
- **`test_no_resection` Method**: Tests the simulator's behavior when resection is not allowed.
- **`test_simulator_with_state_generating_distribution` Method**: Validates the simulator's use of a state-generating distribution.
- **`test_simulator_with_per_character_priors` Method**: Tests the simulator's handling of per-character state priors.
- **`test_simulator_with_per_character_rates` Method**: Verifies the simulator's handling of per-character mutation rates.

## References

- `Cas9LineageTracingDataSimulator`: The class being tested, which is part of the `cassiopeia.simulator` module.
- `DataSimulatorError`: An exception class used to handle errors in the simulator setup.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the testing framework for the test suite. |
| `networkx` | Used to create and manipulate the tree topology. |
| `numpy` | Utilized for numerical operations and random number generation. |
| `pandas` | Used for handling data structures like DataFrames. |
| `cassiopeia` | The main library being tested, specifically the simulator module. |

## Error Handling

The test suite includes error handling by using `assertRaises` to check that the simulator raises `DataSimulatorError` for invalid configurations, ensuring robustness against incorrect inputs.

## Logging

No explicit logging is implemented in this test suite. The focus is on assertions to validate expected outcomes.

## TODOs

No TODOs or notes are present in the code.