---
title: "supercellular_sampler_test.py"
---

## High-level description

The `supercellular_sampler_test.py` file is a unit test suite for the `SupercellularSampler` class, which is part of the Cassiopeia software package. This test suite is designed to verify the functionality of the `SupercellularSampler`, which merges leaves in a phylogenetic tree to create a new tree with ambiguous character states. The tests ensure that the sampler behaves correctly under various conditions, such as invalid parameters, incorrect number of merges, and proper subsampling of a balanced tree.

## Code Structure

The main class in this file is `SupercellularSamplerTest`, which inherits from `unittest.TestCase`. This class contains several test methods that validate different aspects of the `SupercellularSampler` class. The tests are organized as follows:

1. **Setup**: The `setUp` method initializes a test network and a character matrix, which are used in the test cases.
2. **Test Methods**: Each test method checks a specific functionality or edge case of the `SupercellularSampler`.

## References

- `SupercellularSampler`: The class being tested, which is defined in `cassiopeia/simulator/SupercellularSampler.py`.
- `CassiopeiaTree`: A class used to represent phylogenetic trees, defined in `cassiopeia/data/CassiopeiaTree.py`.
- `LeafSubsamplerError` and `CassiopeiaTreeError`: Exception classes used for error handling, defined in `cassiopeia/mixins/errors.py`.

## Symbols

### `SupercellularSamplerTest`
#### Description
This class contains unit tests for the `SupercellularSampler` class. It uses the `unittest` framework to define and run tests that verify the behavior of the sampler under various conditions.

#### Inputs
- None directly, but it uses a predefined network and character matrix set up in the `setUp` method.

#### Outputs
- None directly, but it asserts conditions to validate the behavior of the `SupercellularSampler`.

#### Internal Logic
- **setUp**: Initializes a directed graph (`test_network`) and a character matrix (`character_matrix`) to be used in the tests.
- **test_bad_parameters**: Verifies that the `SupercellularSampler` raises a `LeafSubsamplerError` when initialized with invalid parameters.
- **test_bad_number_of_samples**: Checks that the sampler raises errors when the number of merges is inappropriate or when the character matrix is missing.
- **test_subsample_balanced_tree**: Tests the subsampling functionality on a balanced tree, ensuring that the resulting tree and character matrix match expected values.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the testing framework. |
| `networkx` | Used to create and manipulate the test network graph. |
| `numpy` | Utilized for random number generation and array operations. |
| `pandas` | Used for handling the character matrix as a DataFrame. |

## Error Handling

The test methods use `assertRaises` to check that specific errors are raised under certain conditions, such as invalid parameters or missing data.

## Logging

No explicit logging is implemented in this test suite. The `unittest` framework handles test results and outputs.

## TODOs

No TODOs are present in the code.