---
title: "brownian_spatial_simulator_test.py"
---

## High-level description

The `brownian_spatial_simulator_test.py` file contains unit tests for the `BrownianSpatialDataSimulator` class, which is part of the Cassiopeia library. This simulator is designed to overlay spatial data onto a phylogenetic tree using a Brownian motion model. The tests ensure that the simulator initializes correctly, handles errors appropriately, and accurately overlays spatial data onto trees with or without existing metadata.

## Code Structure

The main class in this file is `TestBrownianSpatialDataSimulator`, which is a subclass of `unittest.TestCase`. This class contains several test methods that validate different aspects of the `BrownianSpatialDataSimulator` class. The tests are organized as follows:

- `setUp`: Initializes the test environment by creating a sample tree and associated metadata.
- `test_init`: Tests the initialization of the simulator, including error handling for invalid parameters.
- `test_overlay_data`: Validates the overlay of spatial data onto a tree using the simulator.
- `test_overlay_data_without_scale`: Tests the overlay of spatial data without scaling the unit area.
- `test_overlay_data_with_existing_cell_meta`: Ensures that the simulator correctly overlays data onto a tree that already has cell metadata.

## References

- `BrownianSpatialDataSimulator`: The class being tested, which is responsible for simulating spatial data using Brownian motion.
- `DataSimulatorError`: An exception class used to handle errors specific to data simulation.

## Symbols

### `TestBrownianSpatialDataSimulator`
#### Description
This class contains unit tests for the `BrownianSpatialDataSimulator`. It uses the `unittest` framework to define and run tests that verify the simulator's functionality.

#### Inputs
- None directly, but it uses a sample tree and metadata set up in the `setUp` method.

#### Outputs
- None directly, but it asserts conditions to validate the simulator's behavior.

#### Internal Logic
- The `setUp` method initializes a directed graph representing a phylogenetic tree and sets up node times and metadata.
- Each test method uses assertions to check the simulator's behavior, such as raising exceptions for invalid parameters or correctly overlaying spatial data.

### `setUp`
#### Description
Initializes the test environment by creating a sample tree and associated metadata.

#### Inputs
- None

#### Outputs
- None

#### Internal Logic
- Constructs a directed graph using `networkx` to represent a phylogenetic tree.
- Sets node times and initializes metadata for the tree.

### `test_init`
#### Description
Tests the initialization of the `BrownianSpatialDataSimulator`, including error handling for invalid parameters.

#### Inputs
- None

#### Outputs
- None

#### Internal Logic
- Attempts to create a simulator with invalid parameters and checks that `DataSimulatorError` is raised.
- Verifies that valid parameters result in a correctly initialized simulator.

### `test_overlay_data`
#### Description
Validates the overlay of spatial data onto a tree using the simulator.

#### Inputs
- None

#### Outputs
- None

#### Internal Logic
- Uses the simulator to overlay spatial data onto the sample tree.
- Compares the resulting spatial coordinates and cell metadata against expected values.

### `test_overlay_data_without_scale`
#### Description
Tests the overlay of spatial data without scaling the unit area.

#### Inputs
- None

#### Outputs
- None

#### Internal Logic
- Configures the simulator to not scale the unit area.
- Verifies that the resulting spatial coordinates match expected values without scaling.

### `test_overlay_data_with_existing_cell_meta`
#### Description
Ensures that the simulator correctly overlays data onto a tree that already has cell metadata.

#### Inputs
- None

#### Outputs
- None

#### Internal Logic
- Uses the simulator to overlay spatial data onto a tree with existing metadata.
- Checks that the resulting metadata includes both the original and new spatial data.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the testing framework. |
| `networkx` | Used to create and manipulate the directed graph representing the tree. |
| `numpy` | Used for numerical operations and random number generation. |
| `pandas` | Used to handle metadata in DataFrame format. |
| `cassiopeia` | The library containing the `BrownianSpatialDataSimulator` and related classes. |

## Error Handling

The tests check for `DataSimulatorError` when invalid parameters are used to initialize the `BrownianSpatialDataSimulator`.

## Logging

No explicit logging is implemented in the test file. The `unittest` framework handles test output and reporting.