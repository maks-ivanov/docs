---
title: "cassiopeia_tree_test.py"
---

## High-level description

The `cassiopeia_tree_test.py` file contains a suite of unit tests for the `CassiopeiaTree` class, which is part of the Cassiopeia data module. These tests are designed to verify the functionality of the `CassiopeiaTree` class, ensuring that it correctly handles tree construction, manipulation, and analysis tasks such as converting Newick strings to networkx graphs, managing character matrices, and computing dissimilarity maps.

## Code Structure

The main components of the code are organized into a test class `TestCassiopeiaTree`, which inherits from `unittest.TestCase`. This class contains multiple test methods, each designed to test a specific functionality of the `CassiopeiaTree` class. The test methods use various assertions to verify the expected behavior of the class methods.

## References

- `CassiopeiaTree`: The class being tested, which is part of the `cassiopeia.data` module.
- `CassiopeiaTreeError` and `CassiopeiaTreeWarning`: Custom exceptions and warnings used within the `CassiopeiaTree` class.
- `data_utilities`: A module containing utility functions for data manipulation, such as converting Newick strings to networkx graphs.
- `dissimilarity_functions`: A module containing functions for computing dissimilarity between nodes.

## Symbols

### `delta_fn`
#### Description
A simple dissimilarity function that calculates the number of differing elements between two numpy arrays, `x` and `y`.

#### Inputs
| Name          | Type          | Description                                      |
|:--------------|:--------------|:-------------------------------------------------|
| `x`           | `np.array`    | The first array to compare.                      |
| `y`           | `np.array`    | The second array to compare.                     |
| `missing_state` | `int`       | The state considered as missing.                 |
| `priors`      | `Optional[Dict[int, Dict[int, float]]]` | Priors for state transitions, not used in this function. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| `d`  | `int` | The count of differing elements between `x` and `y`. |

### `TestCassiopeiaTree`
#### Description
A test class that contains unit tests for the `CassiopeiaTree` class. It uses the `unittest` framework to define and run tests.

#### Internal Logic
- **`setUp` Method**: Initializes test data, including a Newick string, a networkx graph, and several character matrices, which are used across multiple test cases.
- **Test Methods**: Each method tests a specific functionality of the `CassiopeiaTree` class, such as tree construction from Newick strings, handling of character matrices, and traversal methods. Assertions are used to verify expected outcomes.

## Side Effects

- The tests may modify the state of the `CassiopeiaTree` instances, such as adding or removing nodes and edges, or setting character states.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the testing framework. |
| `networkx` | Used for graph representation and manipulation. |
| `numpy`    | Used for numerical operations and array handling. |
| `pandas`   | Used for handling character matrices and data frames. |
| `cassiopeia` | The main library being tested, specifically the `CassiopeiaTree` class. |

## Error Handling

- The tests check for specific exceptions like `CassiopeiaTreeError` to ensure that the `CassiopeiaTree` class handles errors correctly.

## Logging

- The test suite does not implement logging, but it uses assertions to verify expected outcomes.

## TODOs

- There are no explicit TODOs in the code, but the test suite could be expanded to cover additional edge cases or new features as the `CassiopeiaTree` class evolves.