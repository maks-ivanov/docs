---
title: "layers_test.py"
---

Here's a detailed documentation of the provided code:

## High-level description
This file contains unit tests for the Layers class in the data module of the Cassiopeia project. It tests various functionalities related to character matrices, tree topologies, and layer operations in the context of phylogenetic analysis.

## Code Structure
The code defines a TestLayers class that inherits from unittest.TestCase. It contains several test methods that check different aspects of the Layers functionality, including basic character matrix operations, adding layers, reconstructing trees with layers, and handling different types of character matrices.

## Symbols

### TestLayers
#### Description
A test class that contains various unit tests for the Layers functionality in the Cassiopeia data module.

#### Internal Logic
The class sets up a basic character matrix and tree topology in the setUp method, which is used across multiple test cases. It then defines several test methods to check different aspects of the Layers functionality.

### setUp
#### Description
Initializes the test environment with a basic character matrix and tree topology.

#### Internal Logic
- Creates a character matrix using pandas DataFrame
- Defines a tree topology using networkx DiGraph
- Initializes a CassiopeiaTree object with the character matrix and topology

### test_basic_character_matrix
#### Description
Tests if the basic character matrix is correctly initialized in the CassiopeiaTree object.

#### Internal Logic
- Retrieves the character matrix from the CassiopeiaTree object
- Compares it with the expected character matrix using pandas testing utilities

### test_add_layer
#### Description
Tests the functionality of adding a new layer to the CassiopeiaTree object.

#### Internal Logic
- Creates a modified character matrix
- Adds it as a new layer to the CassiopeiaTree object
- Verifies that the new layer is correctly added and can be accessed
- Checks that modifying the new layer doesn't affect the base character matrix

### test_reconstruct_tree_with_layers
#### Description
Tests the tree reconstruction process using different layers.

#### Internal Logic
- Reconstructs the tree using the base character matrix
- Verifies the reconstructed tree structure
- Adds a modified layer and reconstructs the tree again
- Compares the new tree structure with the expected topology

### test_add_layer_with_incorrect_number_of_cells
#### Description
Tests error handling when adding a layer with an incorrect number of cells.

#### Internal Logic
- Attempts to add a layer with an extra cell
- Verifies that a ValueError is raised

### test_add_layer_with_different_number_of_characters
#### Description
Tests adding a layer with a different number of characters than the base matrix.

#### Internal Logic
- Adds a layer with an extra character column
- Verifies that the new layer is correctly added and can be accessed
- Checks that the character states are updated correctly when using the new layer

## Dependencies
The code relies on several external libraries and modules:
- unittest for test framework
- ete3 for tree manipulation
- networkx for graph operations
- numpy and pandas for data manipulation
- cassiopeia for the main functionality being tested

## Error Handling
The code uses assertions and unittest methods to check for expected behavior and raise errors when unexpected results occur.

## Performance Considerations
The tests involve tree reconstruction and manipulation, which can be computationally expensive for large trees. However, as these are unit tests, they use small sample data and are not intended for performance testing.

This documentation provides a comprehensive overview of the test file, explaining its structure, main components, and the specific aspects of the Layers functionality being tested.