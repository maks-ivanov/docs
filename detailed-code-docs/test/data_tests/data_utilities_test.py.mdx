---
title: "data_utilities_test.py"
---

## High-level description

The `data_utilities_test.py` file is a unit test suite designed to validate the functionality of utility functions in the `cassiopeia.data.utilities` module. It uses the `unittest` framework to test various operations related to character matrices, allele tables, phylogenetic trees, and related computations. The tests ensure that the utility functions perform as expected, including bootstrapping character matrices, converting trees to Newick format, computing phylogenetic weight matrices, and calculating inter-cluster distances.

## Code Structure

The main class in this file is `TestDataUtilities`, which inherits from `unittest.TestCase`. This class contains several test methods, each designed to test a specific function or feature from the `cassiopeia.data.utilities` module. The tests are organized to cover different aspects of data manipulation and analysis, such as bootstrapping, tree conversion, and distance computation.

## References

- `cassiopeia.data.utilities`: The module containing the utility functions being tested.
- `cassiopeia.data.CassiopeiaTree`: A class used in some tests to represent phylogenetic trees.
- `cassiopeia.preprocess.utilities`: A module used for preprocessing operations, such as converting allele tables to character matrices.
- `cassiopeia.mixins.errors.CassiopeiaError`: An error class used to handle exceptions in the tests.

## Symbols

### `TestDataUtilities`
#### Description
The `TestDataUtilities` class is a test suite for validating the utility functions in the `cassiopeia.data.utilities` module. It uses the `unittest` framework to define and run tests.

#### Methods

- **`setUp`**: Initializes test data, including character matrices, priors, allele tables, and other necessary data structures for the tests.
- **`test_bootstrap_character_matrices_no_priors`**: Tests the bootstrapping of character matrices without prior probabilities.
- **`test_bootstrap_character_matrices_with_priors`**: Tests the bootstrapping of character matrices with prior probabilities.
- **`test_bootstrap_allele_tables`**: Tests the bootstrapping of allele tables.
- **`test_bootstrap_allele_tables_non_cassiopeia_allele_table`**: Tests bootstrapping with allele tables that do not follow the standard Cassiopeia format.
- **`test_bootstrap_allele_tables_priors`**: Tests bootstrapping of allele tables with indel priors.
- **`test_to_newick_no_branch_lengths`**: Tests the conversion of a tree to Newick format without branch lengths.
- **`test_to_newick_branch_lengths`**: Tests the conversion of a tree to Newick format with branch lengths.
- **`test_lca_characters`**: Tests the computation of the least common ancestor (LCA) character vector.
- **`test_lca_characters_ambiguous`**: Tests LCA computation with ambiguous character states.
- **`test_lca_characters_ambiguous2`**: Another test for LCA computation with different ambiguous states.
- **`test_lca_characters_ambiguous_and_missing`**: Tests LCA computation with both ambiguous and missing states.
- **`test_resolve_most_abundant`**: Tests the resolution of ambiguous states by selecting the most abundant state.
- **`test_simple_phylogenetic_weights_matrix`**: Tests the computation of a simple phylogenetic weight matrix.
- **`test_simple_phylogenetic_weights_matrix_inverse`**: Tests the computation of an inverse phylogenetic weight matrix.
- **`test_phylogenetic_weights_matrix_inverse_fn`**: Tests the computation of an inverse phylogenetic weight matrix using a custom inverse function.
- **`test_net_relatedness_index`**: Tests the computation of the net relatedness index between two sets of indices.
- **`test_inter_cluster_distance_basic`**: Tests the computation of inter-cluster distances using basic settings.
- **`test_inter_cluster_distance_custom_input`**: Tests the computation of inter-cluster distances with custom input data.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the testing framework. |
| `networkx` | Used for creating and manipulating graph structures. |
| `numpy` | Provides support for numerical operations. |
| `pandas` | Used for data manipulation and analysis. |

## Error Handling

The tests use assertions to validate expected outcomes. If an assertion fails, it indicates a discrepancy between the expected and actual behavior of the utility functions. The `CassiopeiaError` is used to handle specific exceptions related to the Cassiopeia library.

## Logging

No explicit logging is implemented in this test suite. The `unittest` framework handles test results and outputs.

## TODOs

No TODOs are present in the code.