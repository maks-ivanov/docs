---
title: "Overview"
---

## High-level description

The `test/tools_tests` directory is a comprehensive suite of unit tests designed to validate the functionality of various modules within the `cassiopeia.tools` package. These tests cover a wide range of functionalities, including autocorrelation, branch length estimation, evolutionary coupling, fitness estimation, parameter estimation, small parsimony, topology analysis, and tree metrics. Each test file is focused on a specific aspect of phylogenetic analysis, ensuring that the corresponding module functions correctly under various conditions and scenarios.

## What does it do?

The test suite in this directory ensures the robustness and accuracy of the `cassiopeia.tools` package by verifying that each module performs as expected. Here's a breakdown of the workflows and processes implemented in the tests:

- **Autocorrelation Tests**: Validate the computation of Moran's I, a measure of spatial autocorrelation, using phylogenetic trees and associated data. The tests check the function's behavior with different variables, custom weight matrices, and error scenarios.

- **Branch Length Estimator Tests**: Verify the accuracy of branch length estimators using Bayesian and maximum likelihood approaches. These tests ensure that the models compute likelihoods, posterior distributions, and branch lengths accurately.

- **Coupling Tests**: Test the computation of evolutionary coupling statistics between different cell types in a phylogenetic tree. The tests cover default settings, custom dissimilarity maps, and minimum proportion thresholds.

- **Fitness Estimator Tests**: Assess the functionality of the `LBIJungle` class, which estimates node fitness using the Local Branching Index method. The tests ensure logical fitness estimates and enforce constraints like leaf naming conventions.

- **Parameter Estimator Tests**: Validate the estimation of mutation rates and missing data rates in phylogenetic trees. The tests cover both discrete and continuous models, ensuring the correctness of parameter estimation functions.

- **Small Parsimony Tests**: Focus on verifying the correctness of small parsimony algorithms, including the Fitch-Hartigan algorithm for reconstructing ancestral states and scoring parsimony.

- **Topology Tests**: Ensure the correct functionality of topology-related functions, such as calculating combinatorial choices, coalescent probabilities, expansion probabilities, and cophenetic correlations.

- **Tree Metrics Tests**: Validate functions related to tree metrics, such as parsimony and likelihood calculations, using predefined tree structures and character matrices.

## Entry points

The directory contains multiple test files, each serving as an entry point for testing specific functionalities:

1. **`autocorrelation_test.py`**: Tests the `compute_morans_i` function for spatial autocorrelation.
2. **`branch_length_estimator_tests`**: Contains tests for branch length estimators using Bayesian and MLE approaches.
3. **`coupling_test.py`**: Tests evolutionary coupling estimators.
4. **`fitness_estimator_tests`**: Tests the `LBIJungle` class for fitness estimation.
5. **`parameter_estimators_test.py`**: Tests parameter estimation methods for mutation and missing data rates.
6. **`small_parsimony_test.py`**: Tests small parsimony algorithms.
7. **`topology_test.py`**: Tests topology-related functions.
8. **`tree_metrics_test.py`**: Tests tree metrics functions.

## Dependencies

The test suites rely on several external libraries to perform their functions:

- **`unittest`**: Provides the framework for defining and running the tests.
- **`networkx`**: Used for creating and manipulating tree structures as directed graphs.
- **`numpy`**: Facilitates numerical computations and operations within the tests.
- **`pandas`**: Used for data manipulation and storage, particularly for character matrices and metadata.
- **`cassiopeia`**: The main library being tested, specifically its `tools` and `data` modules.
- **`scipy`**: Offers integration and special functions necessary for numerical approximations (used in branch length estimator tests).
- **`pytest`**: Utilized for marking slow tests, enhancing test management (used in branch length estimator tests).
- **`parameterized`**: Allows test methods to be run with different inputs, ensuring comprehensive coverage of the estimators' behavior (used in branch length estimator tests).

These dependencies are chosen for their robust support of numerical and graph-based operations, which are essential for the accurate testing of phylogenetic models.