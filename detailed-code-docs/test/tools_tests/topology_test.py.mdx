---
title: "topology_test.py"
---

## High-level description

The `topology_test.py` file is a test suite designed to validate the functionality of various topology-related functions within the `cassiopeia.tools.topology` module. It uses the `unittest` framework to ensure that the functions for calculating combinatorial choices, coalescent probabilities, expansion probabilities, and cophenetic correlations behave as expected. The tests are performed on a predefined tree structure and character matrix, simulating a phylogenetic tree.

## Code Structure

The main class in this file is `TestTopology`, which inherits from `unittest.TestCase`. This class contains several test methods that each focus on a specific function from the `cassiopeia.tools.topology` module. The `setUp` method initializes a tree and character matrix that are used across multiple tests.

## References

- `CassiopeiaError` and `CassiopeiaTreeError` from `cassiopeia.mixins.errors.py` are used for exception handling.
- Functions from `cassiopeia.tools.topology.py` such as `nCk`, `simple_coalescent_probability`, `compute_expansion_pvalues`, and `compute_cophenetic_correlation` are the primary focus of the tests.

## Symbols

### `TestTopology`
#### Description
A test class that contains unit tests for the topology functions in the `cassiopeia.tools.topology` module.

#### Methods

- **`setUp`**: Initializes a directed graph representing a tree and a character matrix, which are used in the tests.
- **`test_simple_choose_function`**: Tests the `nCk` function for calculating combinations and checks for error handling when `k &gt; n`.
- **`test_simple_coalescent_probability`**: Validates the `simple_coalescent_probability` function and its error handling.
- **`test_expansion_probability`**: Tests the `compute_expansion_pvalues` function with different clade sizes and checks the computed expansion probabilities.
- **`test_expansion_probability_variable_depths`**: Similar to `test_expansion_probability`, but with a focus on variable depths.
- **`test_expansion_probability_copy_tree`**: Tests the `compute_expansion_pvalues` function with the `copy` parameter set to `True`, ensuring the original tree remains unchanged.
- **`test_cophenetic_correlation_perfect`**: Tests the `compute_cophenetic_correlation` function with a custom dissimilarity map to ensure perfect correlation.
- **`test_cophenetic_correlation_default`**: Tests the default behavior of `compute_cophenetic_correlation` and compares it to an expected correlation value.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the testing framework. |
| `networkx` | Used to create and manipulate the tree structure as a directed graph. |
| `numpy` | Utilized for numerical operations. |
| `pandas` | Used to handle the character matrix as a DataFrame. |
| `cassiopeia` | The main library being tested, specifically its `tools` and `mixins` modules. |

## Error Handling

The test suite checks for specific exceptions, such as `CassiopeiaError` and `CassiopeiaTreeError`, to ensure that the functions handle erroneous inputs correctly.

## Logging

No explicit logging is implemented in this test suite. The `unittest` framework handles test results and outputs.

## TODOs

No TODOs or notes are present in the code.