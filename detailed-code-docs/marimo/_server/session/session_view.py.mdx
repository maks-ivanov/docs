---
title: "session_view.py"
---

## High-level description

The `session_view.py` file defines the `SessionView` class, which is responsible for maintaining the current state of a session in the Marimo application. This includes tracking cell operations, datasets, variable operations, and UI element values. The class provides methods to update the session state based on various operations and requests, such as control requests and message operations.

## Code Structure

The main symbol in this file is the `SessionView` class, which interacts with several other components of the Marimo application. It uses various data structures and methods to manage the session state, including dictionaries for tracking cell operations, datasets, and variable values. The class also provides methods to handle different types of operations and requests, updating the session state accordingly.

## Symbols

### `SessionView`
#### Description
The `SessionView` class is responsible for maintaining the current state of a session, including cell outputs, statuses, console outputs, datasets, and variable operations. It provides methods to update the session state based on various operations and requests.

#### Inputs
- Various methods take different inputs, such as `raw_operation` (Any), `request` (ControlRequest), `stdin` (str), and `operation` (MessageOperation).

#### Outputs
- The class does not directly return outputs but updates the internal state of the session, which can be accessed through its properties and methods.

#### Internal Logic
- **Initialization**: Initializes dictionaries to track cell operations, datasets, variable operations, UI values, last executed code, and execution times.
- **_add_ui_value**: Adds or updates a UI element value in the session state.
- **_add_last_run_code**: Updates the last executed code for a given cell.
- **add_raw_operation**: Parses a raw operation and adds it to the session state.
- **add_control_request**: Handles different types of control requests, updating UI values and last executed code as needed.
- **add_stdin**: Adds a stdin request to the session view, updating the console output of the relevant cell.
- **add_operation**: Handles various message operations, updating cell operations, variable operations, datasets, and resolving stdin as needed.
- **get_cell_outputs**: Retrieves the outputs for specified cell IDs.
- **get_cell_console_outputs**: Retrieves the console outputs for specified cell IDs.
- **save_execution_time**: Updates the execution time for a given cell based on the event type (start or end).

## References

- **CellId_t**: Used as a type for cell identifiers.
- **CellOp, Datasets, Variables, VariableValue, VariableValues, Interrupted, MessageOperation**: Various message operations and data structures used to update the session state.
- **ControlRequest, CreationRequest, ExecuteMultipleRequest, ExecutionRequest, SetUIElementValueRequest**: Different types of control requests that the session view can handle.
- **parse_raw**: Utility function used to parse raw operations into structured data.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `time` | Used for tracking execution times. |
| `dataclasses` | Used for defining data structures like `_Container`. |
| `typing` | Provides type annotations for better code clarity and safety. |

## Error Handling

The code uses assertions and type checks to ensure that operations and requests are valid before processing them. For example, it checks the types of operations and requests before updating the session state.

## Logging

The code does not explicitly implement logging, but it could benefit from adding logging statements to track the flow of operations and requests through the session view.

## TODOs

There are no TODOs or notes left in the code.