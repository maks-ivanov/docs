---
title: "login.py"
---

## High-level description

The target file, `marimo/_server/api/endpoints/login.py`, defines the login functionality for a web application using the Starlette framework. It provides two main endpoints: one for displaying a login page and another for handling login form submissions. The login process involves validating user credentials and redirecting authenticated users to a specified URL.

## Code Structure

The code is structured around two main endpoints defined using the `APIRouter` class from the Starlette framework. The `login_page` endpoint serves the login HTML page, while the `login_submit` endpoint processes login form submissions. The `validate_auth` function from the `auth.py` module is used to authenticate users.

## References

- `validate_auth`: A function from `marimo/_server/api/auth.py` used to validate user credentials.
- `APIRouter`: A class from `marimo/_server/router.py` used to define and manage API routes.

## Symbols

### `router`
#### Description
An instance of `APIRouter` used to define and manage the login-related API routes.

### `LOGIN_PAGE`
#### Description
A string containing the HTML content for the login page. It includes a form for users to enter their password or access token.

### `login_submit`
#### Description
Handles POST requests to the `/login` endpoint, processing login form submissions and authenticating users.

#### Inputs
| Name    | Type     | Description                        |
|:--------|:---------|:-----------------------------------|
| request | Request  | The HTTP request containing form data.|

#### Outputs
| Name    | Type     | Description                        |
|:--------|:---------|:-----------------------------------|
| output  | Response | A redirect response or HTML response.|

#### Internal Logic
1. Checks if the user is already authenticated; if so, redirects to the home page.
2. Parses the form data from the request body.
3. Validates the password using the `validate_auth` function.
4. Redirects to the specified URL on successful authentication or returns the login page with an error message on failure.

### `login_page`
#### Description
Handles GET requests to the `/login` endpoint, serving the login HTML page.

#### Inputs
| Name    | Type     | Description                        |
|:--------|:---------|:-----------------------------------|
| request | Request  | The HTTP request object.           |

#### Outputs
| Name    | Type         | Description                        |
|:--------|:-------------|:-----------------------------------|
| output  | HTMLResponse | The HTML content of the login page.|

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `starlette.responses` | Provides response classes like `HTMLResponse` and `RedirectResponse`. |
| `marimo._server.api.auth` | Contains the `validate_auth` function for user authentication. |
| `marimo._server.router` | Provides the `APIRouter` class for defining API routes. |

## Error Handling

The `login_submit` function handles errors by displaying an error message on the login page if the password is missing or invalid. It uses the `validate_auth` function to determine the validity of the credentials.

## API/Interface Reference

| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| `/login` | POST   | Form data with `password` | Redirect or HTML | Processes login form submissions. |
| `/login` | GET    | None     | HTML      | Serves the login page. |

## TODOs

No TODOs or notes are present in the code.