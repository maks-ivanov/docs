---
title: "config.py"
---

## High-level description

The `config.py` file in the `marimo/_utils/config` directory provides functionality for reading and writing configuration files in TOML format. It defines a `ConfigReader` class that handles the reading and writing of configuration data to and from files, with support for default values and directory management. The file also includes utility functions to ensure necessary directories exist before writing files.

## Code Structure

The main symbol in this file is the `ConfigReader` class, which is responsible for managing configuration files. It interacts with the file system to read and write TOML files and uses the `parse_raw` function from the `marimo._utils.parse_dataclass` module to parse data into Python dataclasses. The `_maybe_create_directory` function is a utility to ensure that the directory structure for a given file path exists before attempting to write to it.

## Symbols

### `ConfigReader`
#### Description
The `ConfigReader` class is designed to handle reading from and writing to configuration files in TOML format. It provides methods to read a configuration file into a specified dataclass and to write data from a dataclass back to a file. It also includes a static method to determine the appropriate file path based on the user's home directory.

#### Inputs
- `filepath`: `str` - The path to the configuration file.

#### Outputs
- None directly, but methods return parsed data or write data to files.

#### Internal Logic
- **Constructor (`__init__`)**: Initializes the `ConfigReader` with a file path.
- **`for_filename`**: Static method that constructs a `ConfigReader` for a given filename by expanding the user's home directory and appending the filename to a predefined root directory.
- **`read_toml`**: Reads a TOML file, parses it into a specified dataclass, and returns the dataclass instance. If the file is not found, it returns a fallback instance.
- **`write_toml`**: Writes a dataclass instance to a TOML file, ensuring the directory exists before writing.
- **`_get_home_directory`**: Static method that returns the user's home directory, with special handling for test environments to use a temporary directory.

### `_maybe_create_directory`
#### Description
This function ensures that the directory for a given file path exists, creating it if necessary.

#### Inputs
- `file_path`: `str` - The path for which to ensure directory existence.

#### Outputs
- None

#### Internal Logic
- Checks if the directory part of the file path exists and creates it if it does not.

## References

- **`parse_raw`**: This function from `marimo._utils.parse_dataclass` is used to parse raw TOML data into a specified dataclass. It is crucial for the `read_toml` method in `ConfigReader`.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `os` | Used for file path manipulations and environment variable access. |
| `dataclasses` | Provides the `asdict` function to convert dataclass instances to dictionaries. |
| `tempfile` | Used to create temporary directories for testing purposes. |
| `tomlkit` | Used to parse and dump TOML data. |
| `marimo._utils.parse_dataclass` | Provides the `parse_raw` function to parse data into dataclasses. |

## Error Handling

- The `read_toml` method handles `FileNotFoundError` by returning a fallback dataclass instance, ensuring that the application can continue to function even if the configuration file is missing.

## Side Effects

- The `write_toml` method may create directories on the file system if they do not already exist, as facilitated by the `_maybe_create_directory` function.

## Performance Considerations

- The use of `os.path.realpath` and `os.path.expanduser` in `_get_home_directory` ensures that the file paths are resolved efficiently, but these operations can be relatively slow if called frequently in a performance-critical section of code.