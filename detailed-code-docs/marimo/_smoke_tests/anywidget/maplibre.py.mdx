---
title: "maplibre.py"
---

## High-level description

The target file `marimo/_smoke_tests/anywidget/maplibre.py` is a script designed to create an interactive map using the `maplibre` library within a `marimo` application. It sets up a map widget with specific controls and layers, allowing for user interaction such as zooming and clicking, and includes a button to add additional controls to the map.

## Code Structure

The code is structured using the `marimo` framework, which organizes the application into cells. Each cell is a function decorated with `@app.cell`, and these cells are executed in sequence to build the application. The main components include setting up the map options, creating the map widget, adding controls and layers, and handling user interactions.

## Symbols

### `app`
#### Description
`app` is an instance of `marimo.App`, which serves as the main application object. It is configured with a medium width and is responsible for managing the lifecycle and execution of the application cells.

### `@app.cell`
#### Description
The `@app.cell` decorator is used to define a function as a cell within the `marimo` application. Each cell represents a discrete unit of functionality that contributes to the overall application.

### `__()`
#### Description
The `__()` functions are anonymous cells that perform various tasks such as importing modules, defining map options, creating map widgets, and handling user interactions. Each cell is executed in the order it is defined.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| MapOptions | class | Used to configure map options like center, zoom, hash, and pitch. |
| MapWidget | class | Represents the map widget that is displayed to the user. |
| NavigationControl | class | A control for navigating the map. |
| ScaleControl | class | A control for displaying the map scale. |
| deck_grid_layer | dict | Configuration for a grid layer to be added to the map. |
| map_options | instance | An instance of `MapOptions` with specific settings. |
| mo | module | The `marimo` module, used for UI components. |
| add_control_button | instance | A button UI component to add scale control. |
| m | instance | The map widget instance. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| functools, mo | tuple | Imported modules for use in other cells. |
| MapOptions, MapWidget, NavigationControl, ScaleControl | tuple | Imported classes for map configuration and controls. |
| deck_grid_layer | dict | Configuration for a grid layer. |
| map_options | instance | Configured map options. |
| m | instance | Configured map widget. |
| add_control_button | instance | Button UI component. |

#### Internal Logic
- **Importing Modules**: The first cell imports `functools` and `marimo` for use in subsequent cells.
- **Map Configuration**: The map is configured with options such as center coordinates, zoom level, and pitch.
- **Map Widget Setup**: A `MapWidget` is created with the specified options, and controls like `NavigationControl` are added.
- **Layer Addition**: A grid layer is added to the map using data from a specified URL.
- **UI Components**: A button is created to allow users to add a scale control to the map.
- **User Interaction**: The map's click and zoom events are exposed for potential interaction handling.

## Side Effects
- The map widget (`m`) is modified by adding controls and layers.
- The button (`add_control_button`) can trigger the addition of a scale control to the map.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| marimo | Provides the framework for building the application and UI components. |
| maplibre | Used for creating and managing the map widget and its controls. |

## Error Handling
The code does not explicitly handle errors beyond the basic execution of cells. Any issues with imports or map configuration would likely result in runtime errors.

## Logging
The code does not implement any logging mechanisms.

## API/Interface Reference
The code does not expose an API or public interface beyond the interactive map and UI components within the `marimo` application.

## TODOs
There are no TODOs or notes left in the code.