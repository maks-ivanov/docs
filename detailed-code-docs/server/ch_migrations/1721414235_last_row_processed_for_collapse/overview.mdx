---
title: "Overview"
---

## High-level description
This directory contains database migration scripts for managing the `last_collapsed_dataset` table in a ClickHouse database. The scripts are written in SQL and use ClickHouse-specific syntax. The directory includes two files: `up.sql` for creating the table and `down.sql` for dropping it.

## What does it do?
These scripts are used to manage the lifecycle of a table that tracks the last time a dataset was collapsed. The `up.sql` script creates the table with specific columns to store information about the collapse operation, such as the timestamp and the dataset ID. The `down.sql` script removes this table from the database. These scripts are typically used in a database migration tool to apply and revert changes to the database schema in a controlled manner.

## Key Files
- **up.sql:** This script creates the `last_collapsed_dataset` table. It defines the table structure, including columns for storing a unique ID, the timestamp of the last collapse operation, the dataset ID, and the record creation timestamp. The script utilizes the ReplacingMergeTree engine for efficient updates and partitions the table by year, month, and dataset ID for optimized query performance.
- **down.sql:** This script drops the `last_collapsed_dataset` table if it exists. It uses a conditional drop statement to avoid errors if the table is already absent. This script is used to revert the changes made by the `up.sql` script during database rollbacks. 
