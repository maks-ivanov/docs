---
title: "Overview"
---

## High-level description
The `server/ch_migrations/1720668303_create_inital_tables` directory contains database migration scripts for creating and dropping tables related to datasets, search queries, cluster topics, and recommendations in a ClickHouse database. 

## What does it do?
This directory manages the creation and deletion of tables within a ClickHouse database. It ensures that the database schema is properly set up or reverted during deployments or rollbacks. When applied, the `up.sql` script creates tables for storing data about datasets, search queries, cluster topics, and recommendations. Conversely, the `down.sql` script undoes these changes by dropping the created tables. This mechanism ensures that the database structure aligns with the application's requirements.

## Entry points
The directory contains two SQL files:
- `up.sql`: Defines the schema for creating the initial tables. This script is executed to apply the migration and create the tables.
- `down.sql`: Contains instructions to drop the tables created by `up.sql`. This script is used to revert the migration.

The code is organized around database operations. `up.sql` handles table creation, outlining their structure and data types, while `down.sql` focuses on removing these tables.

## Key Files
- **up.sql:** This file contains a series of `CREATE TABLE` statements that define the structure of six tables: `dataset_events`, `search_queries`, `cluster_topics`, `search_cluster_memberships`, `rag_queries`, and `recommendations`. Each table is designed to store specific information related to datasets, search queries, cluster topics, and recommendations. The script also specifies the engine, ordering, partitioning, and TTL settings for each table to optimize performance and data management.

- **down.sql:** This file contains a series of `DROP TABLE IF EXISTS` statements to remove the tables created by the `up.sql` script. The `IF EXISTS` clause ensures that the script executes without errors even if a table doesn't exist. This script is crucial for rolling back changes and reverting the database to its previous state.
```sql
DROP TABLE IF EXISTS recommendations;
DROP TABLE IF EXISTS rag_queries;
DROP TABLE IF EXISTS search_cluster_memberships;
DROP TABLE IF EXISTS cluster_topics;
DROP TABLE IF EXISTS search_queries;
DROP TABLE IF EXISTS events;
```
