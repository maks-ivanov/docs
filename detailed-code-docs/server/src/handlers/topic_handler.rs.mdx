---
title: "topic_handler.rs"
---

## High-level description
This code defines a set of API endpoints for managing chat topics. It includes functionality for creating, deleting, updating, and retrieving topics. Topics are associated with an owner ID and a dataset ID, and they serve as a way to organize conversation message history for generative AI chat sessions.

## Table of contents
- `create_topic`
- `delete_topic`
- `update_topic`
- `get_all_topics_for_owner_id`

## References
- `AdminOnly` (from `crate::handlers::auth_handler`)
- `DatasetAndOrgWithSubAndPlan` (from `crate::data::models`)
- `Topic` (from `crate::data::models`)
- `create_topic_query` (from `crate::operators::topic_operator`)
- `delete_topic_query` (from `crate::operators::topic_operator`)
- `get_all_topics_for_owner_id_query` (from `crate::operators::topic_operator`)
- `update_topic_query` (from `crate::operators::topic_operator`)
- `get_topic_string` (from `crate::operators::message_operator`)
- `DatasetConfiguration` (from `crate::data::models`)
- `ServiceError` (from `crate::errors`)

## Symbols

### `create_topic`
#### Description
Creates a new chat topic. The topic name can be explicitly provided or generated from the first user message.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| `data` | `web::Json&lt;CreateTopicReqPayload&gt;` | JSON payload containing the topic details |
| `user` | `AdminOnly` | Authenticated user with admin privileges |
| `dataset_org_plan_sub` | `DatasetAndOrgWithSubAndPlan` | Dataset, organization, subscription, and plan information |
| `pool` | `web::Data&lt;Pool&gt;` | Database connection pool |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| `HttpResponse` | `Result&lt;HttpResponse, actix_web::Error&gt;` | HTTP response containing the created topic or an error |

#### Internal Logic
1. Extracts the topic details from the JSON payload.
2. Checks if either the first user message or the topic name is provided.
3. If the first user message is provided, generates the topic name using `get_topic_string`.
4. Creates a new `Topic` instance with the generated or provided name, owner ID, and dataset ID.
5. Inserts the new topic into the database using `create_topic_query`.
6. Returns an HTTP response with the created topic.

### `delete_topic`
#### Description
Deletes an existing chat topic and all associated chat messages.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| `topic_id` | `web::Path&lt;uuid::Uuid&gt;` | Topic ID to delete |
| `user` | `AdminOnly` | Authenticated user with admin privileges |
| `dataset_org_plan_sub` | `DatasetAndOrgWithSubAndPlan` | Dataset, organization, subscription, and plan information |
| `pool` | `web::Data&lt;Pool&gt;` | Database connection pool |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| `HttpResponse` | `Result&lt;HttpResponse, actix_web::Error&gt;` | HTTP response indicating success or an error |

#### Internal Logic
1. Extracts the topic ID from the path parameter.
2. Deletes the topic from the database using `delete_topic_query`.
3. Returns an HTTP response with a 204 No Content status.

### `update_topic`
#### Description
Updates the name of an existing chat topic.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| `data` | `web::Json&lt;UpdateTopicReqPayload&gt;` | JSON payload containing the topic ID and new name |
| `user` | `AdminOnly` | Authenticated user with admin privileges |
| `dataset_org_plan_sub` | `DatasetAndOrgWithSubAndPlan` | Dataset, organization, subscription, and plan information |
| `pool` | `web::Data&lt;Pool&gt;` | Database connection pool |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| `HttpResponse` | `Result&lt;HttpResponse, actix_web::Error&gt;` | HTTP response indicating success or an error |

#### Internal Logic
1. Extracts the topic ID and new name from the JSON payload.
2. Checks if the new name is empty.
3. Updates the topic name in the database using `update_topic_query`.
4. Returns an HTTP response with a 204 No Content status.

### `get_all_topics_for_owner_id`
#### Description
Retrieves all topics belonging to a given owner ID.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| `user` | `AdminOnly` | Authenticated user with admin privileges |
| `owner_id` | `web::Path&lt;String&gt;` | Owner ID to retrieve topics for |
| `dataset_org_plan_sub` | `DatasetAndOrgWithSubAndPlan` | Dataset, organization, subscription, and plan information |
| `pool` | `web::Data&lt;Pool&gt;` | Database connection pool |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| `HttpResponse` | `Result&lt;HttpResponse, ServiceError&gt;` | HTTP response containing the retrieved topics or an error |

#### Internal Logic
1. Extracts the owner ID from the path parameter.
2. Retrieves all topics for the owner ID and dataset ID from the database using `get_all_topics_for_owner_id_query`.
3. Returns an HTTP response with the retrieved topics.
