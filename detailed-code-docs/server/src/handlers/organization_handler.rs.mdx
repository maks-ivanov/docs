---
title: "organization_handler.rs"
---

## High-level description
This code defines a set of API endpoints for managing organizations within the application. It handles operations such as creating, retrieving, updating, and deleting organizations, as well as managing organization users and configurations.

## Table of contents
- `get_organization`
- `delete_organization`
- `UpdateOrganizationReqPayload`
- `update_organization`
- `CreateOrganizationReqPayload`
- `create_organization`
- `get_organization_usage`
- `get_organization_users`
- `RemoveUserFromOrgPathParams`
- `remove_user_from_org`
- `UpdateAllOrgDatasetConfigsReqPayload`
- `update_all_org_dataset_configs`

## References
- `AdminOnly`: From `auth_handler` module, used to restrict access to admin users.
- `OwnerOnly`: From `auth_handler` module, used to restrict access to organization owners.
- `LoggedUser`: From `auth_handler` module, represents a logged-in user.
- `get_role_for_org`: From `auth_middleware` module, retrieves the role of a user within an organization.
- `verify_admin`: From `auth_middleware` module, verifies if a user has admin privileges.
- `verify_owner`: From `auth_middleware` module, verifies if a user is the owner of an organization.
- Various operators from `organization_operator` and `user_operator` modules to interact with the database.

## Symbols

### `get_organization`
#### Description
Retrieves the details of an organization by its ID. Only users with admin or owner roles for the organization can access this endpoint.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization_id | web::Path&lt;uuid::Uuid&gt; | The ID of the organization to retrieve. |
| pool | web::Data&lt;Pool&gt; | Database connection pool. |
| user | AdminOnly | Authenticated user with admin privileges. |

#### Outputs
- `HttpResponse`: Returns an HTTP response with the organization details in JSON format on success (status code 200), or an error response on failure (status code 400, 404).

### `delete_organization`
#### Description
Deletes an organization by its ID. Only the owner of the organization can perform this action.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| req | HttpRequest | The HTTP request object. |
| organization_id | web::Path&lt;uuid::Uuid&gt; | The ID of the organization to delete. |
| pool | web::Data&lt;Pool&gt; | Database connection pool. |
| redis_pool | web::Data&lt;RedisPool&gt; | Redis connection pool. |
| user | OwnerOnly | Authenticated user who is the owner of the organization. |

#### Outputs
- `HttpResponse`: Returns an HTTP response with no content on success (status code 204), or an error response on failure (status code 400).

### `UpdateOrganizationReqPayload`
#### Description
Represents the request payload structure for updating an organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization_id | uuid::Uuid | The ID of the organization to update. |
| name | Option&lt;String&gt; | The new name for the organization (optional). |

### `update_organization`
#### Description
Updates an organization's details. Only the owner of the organization can modify it.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | web::Json&lt;UpdateOrganizationReqPayload&gt; | The updated organization data in JSON format. |
| pool | web::Data&lt;Pool&gt; | Database connection pool. |
| redis_pool | web::Data&lt;RedisPool&gt; | Redis connection pool. |
| user | OwnerOnly | Authenticated user who is the owner of the organization. |

#### Outputs
- `HttpResponse`: Returns an HTTP response with the updated organization object in JSON format on success (status code 200), or an error response on failure (status code 400).

### `CreateOrganizationReqPayload`
#### Description
Represents the request payload structure for creating a new organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | String | The name for the new organization. |

### `create_organization`
#### Description
Creates a new organization. The authenticated user who initiates the creation becomes the default owner of the organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| req | HttpRequest | The HTTP request object. |
| organization | web::Json&lt;CreateOrganizationReqPayload&gt; | The organization data to create in JSON format. |
| pool | web::Data&lt;Pool&gt; | Database connection pool. |
| user | LoggedUser | Authenticated user creating the organization. |
| redis_pool | web::Data&lt;RedisPool&gt; | Redis connection pool. |

#### Outputs
- `HttpResponse`: Returns an HTTP response with the created organization object in JSON format on success (status code 200), or an error response on failure (status code 400).

### `get_organization_usage`
#### Description
Retrieves the current usage statistics for an organization. Only users with admin or owner roles for the organization can access this endpoint.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | web::Path&lt;uuid::Uuid&gt; | The ID of the organization to retrieve usage for. |
| pool | web::Data&lt;Pool&gt; | Database connection pool. |
| user | AdminOnly | Authenticated user with admin privileges. |

#### Outputs
- `HttpResponse`: Returns an HTTP response with the organization usage data in JSON format on success (status code 200), or an error response on failure (status code 400).

### `get_organization_users`
#### Description
Retrieves a list of users who belong to an organization. Only users with admin or owner roles for the organization can access this endpoint.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization_id | web::Path&lt;uuid::Uuid&gt; | The ID of the organization to retrieve users for. |
| pool | web::Data&lt;Pool&gt; | Database connection pool. |
| user | AdminOnly | Authenticated user with admin privileges. |

#### Outputs
- `HttpResponse`: Returns an HTTP response with an array of user objects in JSON format on success (status code 200), or an error response on failure (status code 400).

### `RemoveUserFromOrgPathParams`
#### Description
Represents the path parameters structure for removing a user from an organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization_id | uuid::Uuid | The ID of the organization to remove the user from. |
| user_id | uuid::Uuid | The ID of the user to remove. |

### `remove_user_from_org`
#### Description
Removes a user from an organization. Only users with admin or owner roles for the organization can perform this action.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | web::Path&lt;RemoveUserFromOrgPathParams&gt; | The path parameters containing the organization ID and user ID. |
| pool | web::Data&lt;Pool&gt; | Database connection pool. |
| redis_pool | web::Data&lt;RedisPool&gt; | Redis connection pool. |
| user | AdminOnly | Authenticated user with admin privileges. |

#### Outputs
- `HttpResponse`: Returns an HTTP response with no content on success (status code 204), or an error response on failure (status code 400).

### `UpdateAllOrgDatasetConfigsReqPayload`
#### Description
Represents the request payload structure for updating the configurations of all datasets within an organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization_id | uuid::Uuid | The ID of the organization to update dataset configurations for. |
| dataset_config | serde_json::Value | The new configuration object to apply to all datasets. |

### `update_all_org_dataset_configs`
#### Description
Updates the configurations of all datasets within an organization. Only the owner of the organization can perform this action. This endpoint allows for partial updates to dataset configurations, preserving dataset-specific values for keys not included in the provided configuration object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| req_payload | web::Json&lt;UpdateAllOrgDatasetConfigsReqPayload&gt; | The request payload containing the organization ID and new dataset configuration. |
| pool | web::Data&lt;Pool&gt; | Database connection pool. |
| user | OwnerOnly | Authenticated user who is the owner of the organization. |

#### Outputs
- `HttpResponse`: Returns an HTTP response with no content on success (status code 204), or an error response on failure (status code 400).
