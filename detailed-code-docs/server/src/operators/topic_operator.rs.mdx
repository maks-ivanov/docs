---
title: "topic_operator.rs"
---

## High-level description
This code defines several database query functions related to managing chat topics. These functions handle creating, deleting, updating, and retrieving topics associated with a specific dataset and owner ID.

## Table of contents
- `create_topic_query`
- `delete_topic_query`
- `update_topic_query`
- `get_topic_query`
- `get_topic_for_owner_id_query`
- `get_all_topics_for_owner_id_query`

## References
- `Topic` struct from `crate::data::models`
- `Pool` type alias from `crate::data::models`
- `ServiceError` enum from `crate::errors`

## Symbols

### `create_topic_query`
#### Description
Inserts a new topic into the `topics` table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| topic | `Topic` | The `Topic` struct containing the details of the new topic. |
| pool | `&web::Data&lt;Pool&gt;` | A reference to the database connection pool. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Result | `Result&lt;(), ServiceError&gt;` | Returns `Ok(())` if the insertion was successful, otherwise returns a `ServiceError::BadRequest` error. |

#### Side Effects
- Modifies the `topics` table by inserting a new row.

### `delete_topic_query`
#### Description
"Soft deletes" a topic by setting the `deleted` flag to `true` in the `topics` table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| topic_id | `uuid::Uuid` | The UUID of the topic to delete. |
| given_dataset_id | `uuid::Uuid` | The UUID of the dataset the topic belongs to. |
| pool | `&web::Data&lt;Pool&gt;` | A reference to the database connection pool. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Result | `Result&lt;(), ServiceError&gt;` | Returns `Ok(())` if the update was successful, otherwise returns a `ServiceError::BadRequest` error. |

#### Side Effects
- Modifies the `topics` table by updating the `deleted` flag of the specified topic.

### `update_topic_query`
#### Description
Updates the name and `updated_at` timestamp of a topic in the `topics` table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| topic_id | `uuid::Uuid` | The UUID of the topic to update. |
| topic_name | `String` | The new name for the topic. |
| given_dataset_id | `uuid::Uuid` | The UUID of the dataset the topic belongs to. |
| pool | `&web::Data&lt;Pool&gt;` | A reference to the database connection pool. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Result | `Result&lt;(), ServiceError&gt;` | Returns `Ok(())` if the update was successful, otherwise returns a `ServiceError::BadRequest` error. |

#### Side Effects
- Modifies the `topics` table by updating the name and `updated_at` timestamp of the specified topic.

### `get_topic_query`
#### Description
Retrieves a topic from the `topics` table based on its UUID and dataset ID.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| topic_id | `uuid::Uuid` | The UUID of the topic to retrieve. |
| given_dataset_id | `uuid::Uuid` | The UUID of the dataset the topic belongs to. |
| pool | `&web::Data&lt;Pool&gt;` | A reference to the database connection pool. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Result | `Result&lt;Topic, ServiceError&gt;` | Returns `Ok(Topic)` containing the retrieved topic if successful, otherwise returns a `ServiceError::BadRequest` error. |

### `get_topic_for_owner_id_query`
#### Description
Retrieves a topic from the `topics` table based on its UUID, owner ID, and dataset ID.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| owner_id | `String` | The owner ID of the topic. |
| topic_id | `uuid::Uuid` | The UUID of the topic to retrieve. |
| given_dataset_id | `uuid::Uuid` | The UUID of the dataset the topic belongs to. |
| pool | `&web::Data&lt;Pool&gt;` | A reference to the database connection pool. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Result | `Result&lt;Topic, ServiceError&gt;` | Returns `Ok(Topic)` containing the retrieved topic if successful, otherwise returns a `ServiceError::BadRequest` error. |

### `get_all_topics_for_owner_id_query`
#### Description
Retrieves all topics from the `topics` table belonging to a specific owner ID and dataset ID.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| topic_owner_id | `String` | The owner ID of the topics. |
| given_dataset_id | `uuid::Uuid` | The UUID of the dataset the topics belong to. |
| pool | `&web::Data&lt;Pool&gt;` | A reference to the database connection pool. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Result | `Result&lt;Vec&lt;Topic&gt;, ServiceError&gt;` | Returns `Ok(Vec&lt;Topic&gt;)` containing the retrieved topics if successful, otherwise returns a `ServiceError::BadRequest` error. |

```

```