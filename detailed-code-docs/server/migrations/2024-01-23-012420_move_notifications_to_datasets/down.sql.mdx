---
title: "down.sql"
---

## High-level description
This SQL migration script is designed to revert changes made in the corresponding `up.sql` file. It undoes the migration of notifications from a user-based system to a dataset-based system by modifying table structures and renaming a table.

## Table of contents
- Modify `dataset_notification_counts` table
- Rename `dataset_notification_counts` to `user_notification_counts`
- Modify `file_upload_completed_notifications` table

## Symbols

### ALTER TABLE dataset_notification_counts ADD COLUMN user_uuid uuid;
#### Description
This statement adds a `user_uuid` column of type UUID to the `dataset_notification_counts` table.

### ALTER TABLE dataset_notification_counts DROP COLUMN dataset_uuid;
#### Description
This statement removes the `dataset_uuid` column from the `dataset_notification_counts` table.

### ALTER TABLE dataset_notification_counts RENAME TO user_notification_counts;
#### Description
This statement renames the `dataset_notification_counts` table to `user_notification_counts`.

### ALTER TABLE file_upload_completed_notifications ADD COLUMN user_uuid uuid;
#### Description
This statement adds a `user_uuid` column of type UUID to the `file_upload_completed_notifications` table.

## Side Effects
- The `dataset_notification_counts` table structure is modified.
- The `dataset_notification_counts` table is renamed to `user_notification_counts`.
- The `file_upload_completed_notifications` table structure is modified.

## Future Improvements
- Consider adding appropriate indexes on the newly added `user_uuid` columns to improve query performance if these columns will be frequently used in WHERE clauses or joins.
- Ensure that any application code referencing these tables is updated to reflect the changes made in this migration.
- If there's data in the affected tables, consider adding data migration steps to populate the new `user_uuid` columns with appropriate values.