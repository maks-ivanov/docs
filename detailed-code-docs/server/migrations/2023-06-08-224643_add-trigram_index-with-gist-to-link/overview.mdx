---
title: "Overview"
---

## High-level description
This directory contains SQL migration files for adding and removing a GIN (Generalized Inverted Index) index on the `link` column of the `card_metadata` table using the trigram (trgm) operator class. The migration is designed to improve the performance of similarity searches and pattern matching queries on the `link` column.

## What does it do?
The migration creates a specialized index that helps the database quickly find similar or partially matching links in the `card_metadata` table. This is particularly useful for searches where you want to find links that are similar but not exactly the same, or when you're looking for links that contain certain patterns. 

For example, if you have a link like "https://example.com/page1" and you want to find all links that are similar to this, or all links that contain "example.com", this index will make those searches much faster.

The migration also includes a way to undo this change, removing the index if needed. This is important for maintaining flexibility in the database structure and allowing for rollbacks if issues arise.

## Key Files

1. `up.sql`:
   - Creates the GIN index named `idx_link_gin` on the `link` column of the `card_metadata` table.
   - Uses the trigram operator class (`gin_trgm_ops`) for efficient similarity searches.

2. `down.sql`:
   - Removes the `idx_link_gin` index if it exists.
   - Provides a way to undo the changes made by the `up.sql` file.

## Dependencies
The migration relies on the `pg_trgm` PostgreSQL extension, which must be enabled in the database for the index to work correctly. This extension provides trigram-based operations and index support.

## Configuration
No specific configuration files or environment variables are used in this migration. However, it's important to note that the database must have the `pg_trgm` extension enabled for the migration to work properly.

## Performance Considerations
- The GIN index with trigram support can significantly improve the performance of similarity searches and pattern matching queries on the `link` column.
- However, it will increase storage requirements and may slightly slow down insert, update, and delete operations on the `card_metadata` table.
- It's recommended to monitor the performance impact of this index on write operations to ensure it doesn't negatively affect overall system performance.

## Future Improvements
1. Consider adding similar indexes on other text columns if they are frequently used in similarity or pattern matching queries.
2. Evaluate the need for partial indexes if only a subset of the `link` values are typically searched.
3. In the `down.sql` file, consider adding a comment explaining which table the `idx_link_gin` index was associated with, for better context.
4. If there are any dependencies on this index, consider addressing them in the migration files.

Here's an example of how the index might be used in a SQL query:

```sql
SELECT * FROM card_metadata
WHERE link % 'example.com'
ORDER BY link &lt;-&gt; 'example.com'
LIMIT 10;
```

This query would find the top 10 links most similar to 'example.com', utilizing the GIN index for efficient searching.