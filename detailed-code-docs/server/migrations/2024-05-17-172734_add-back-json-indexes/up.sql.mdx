---
title: "up.sql"
---

## High-level description
This SQL migration script removes two existing indexes and creates a new JSON-based index on the `chunk_metadata` table. It's designed to optimize query performance for JSON data in the `metadata` column.

## Table of contents
- Drop existing indexes
- Create new JSON index

## Symbols

### DROP INDEX idx_card_metadata_link
#### Description
Removes an existing index named `idx_card_metadata_link`.

### DROP INDEX idx_chunk_metadata_created_at
#### Description
Removes an existing index named `idx_chunk_metadata_created_at`.

### DROP INDEX idx_chunk_metadata_time_stamp
#### Description
Removes an existing index named `idx_chunk_metadata_time_stamp`.

### CREATE INDEX idx_chunk_metadata_json
#### Description
Creates a new index named `idx_chunk_metadata_json` on the `chunk_metadata` table, specifically on the `metadata` column using the GIN (Generalized Inverted Index) index type with `jsonb_path_ops` operator class.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| chunk_metadata | table | The table on which the index is created |
| metadata | column | The JSON column being indexed |

#### Performance Considerations
The GIN index with `jsonb_path_ops` is optimized for querying JSON data, particularly for containment and path operations. This can significantly improve query performance for JSON-based searches on the `metadata` column.

## Future Improvements
- Monitor query performance after this migration to ensure the new index is being utilized effectively.
- Consider adding more specific indexes if certain JSON paths within the `metadata` column are frequently queried.
- Evaluate the impact of removing the `idx_card_metadata_link`, `idx_chunk_metadata_created_at`, and `idx_chunk_metadata_time_stamp` indexes on overall database performance.