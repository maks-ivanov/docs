---
title: "down.sql"
---

## High-level description
This SQL migration script is designed to revert the changes made in the corresponding `up.sql` file. It drops the `user_api_key` table and adds back an `api_key_hash` column to the `users` table.

## Table of contents
- Drop `user_api_key` table
- Alter `users` table to add `api_key_hash` column

## Symbols

### DROP TABLE IF EXISTS user_api_key;
#### Description
This SQL command removes the `user_api_key` table if it exists in the database.

#### Side Effects
- Permanently deletes the `user_api_key` table and all its data if it exists.
- If the table doesn't exist, the command has no effect.

### ALTER TABLE users ADD COLUMN api_key_hash TEXT;
#### Description
This SQL command modifies the `users` table by adding a new column named `api_key_hash` of type TEXT.

#### Side Effects
- Adds a new column `api_key_hash` to the `users` table.
- The new column will be empty (NULL) for existing rows.

## Error Handling
This script does not include explicit error handling. If an error occurs during execution, it will depend on the database system's default behavior and the migration tool being used to manage the error.

## Future Improvements
- Consider adding a `CASCADE` option to the `DROP TABLE` statement if there are any dependencies on the `user_api_key` table that should be automatically removed.
- If data migration is needed, consider adding statements to transfer any relevant data from the `user_api_key` table to the `api_key_hash` column in the `users` table before dropping the `user_api_key` table.
- Add comments explaining the reason for this reversion, which could help future developers understand the context of these changes.