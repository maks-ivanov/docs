---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for implementing and reverting a soft delete functionality for votes in the card_votes table. The migration adds a 'deleted' column to enable soft deletion of votes, while the down migration removes this column, reverting the table to its previous state.

## What does it do?
These migration scripts modify the structure of the card_votes table in the database. The up migration adds a new column called 'deleted' to the table, which allows for soft deletion of votes. Soft deletion means that instead of permanently removing a vote from the database, it is marked as deleted by setting this column to true. This approach preserves the data for potential future reference or recovery.

The down migration, on the other hand, removes the 'deleted' column from the card_votes table. This effectively undoes the soft delete functionality, reverting the table to its original structure without the ability to mark votes as deleted.

## Key Files

1. up.sql
   - Purpose: Adds the 'deleted' column to the card_votes table
   - Content:
     ```sql
     ALTER TABLE card_votes
     ADD COLUMN deleted BOOLEAN NOT NULL DEFAULT false;
     ```
   - This script adds a boolean column named 'deleted' to the card_votes table, with a default value of false and a NOT NULL constraint.

2. down.sql
   - Purpose: Removes the 'deleted' column from the card_votes table
   - Content:
     ```sql
     ALTER TABLE card_votes DROP COLUMN deleted;
     ```
   - This script removes the 'deleted' column from the card_votes table, undoing the changes made by the up migration.

## Dependencies
These migration scripts rely on the existing database system and the card_votes table. They don't introduce any new external dependencies.

## Configuration
No specific configuration is required for these migration scripts. However, it's important to note that the database connection details and migration execution environment should be properly set up in the main application or migration tool.

Additional notes:

1. Data Preservation: The up migration preserves existing data by setting a default value of false for the new 'deleted' column. However, the down migration will permanently remove any data stored in the 'deleted' column.

2. Application Impact: After applying the up migration, any application code interacting with the card_votes table should be updated to handle the new 'deleted' column. This might include modifying queries to filter out deleted votes or updating the vote deletion process to use soft deletes.

3. Performance Consideration: If the 'deleted' column is frequently used in WHERE clauses after the up migration, consider adding an index to improve query performance.

4. Backup Recommendation: Before running the down migration, it's advisable to backup any data in the 'deleted' column, as this information will be permanently lost once the column is dropped.

5. Migration Order: Ensure that these migrations are executed in the correct order relative to other database changes, especially those affecting the card_votes table.

By implementing soft delete functionality, this migration allows for more flexible data management in the application, enabling features like vote recovery or historical analysis of deleted votes.