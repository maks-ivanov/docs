---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for modifying the foreign key constraint between the `messages` and `topics` tables in a database schema. The migration implements and reverts a change to enable cascading delete behavior for messages when their associated topic is deleted.

## What does it do?
These migration scripts alter the relationship between messages and topics in the database. The "up" migration adds a cascading delete feature, which means that when a topic is deleted, all associated messages are automatically deleted as well. The "down" migration removes this cascading behavior, reverting to a standard foreign key relationship where deleting a topic would fail if there are associated messages.

## Key Files
1. `up.sql`: This file contains the SQL commands to implement the cascading delete behavior.
   - It drops the existing foreign key constraint on the `messages` table.
   - It then adds a new foreign key constraint with `ON DELETE CASCADE` and `ON UPDATE CASCADE` clauses.

2. `down.sql`: This file contains the SQL commands to revert the changes made by the `up.sql` script.
   - It drops the cascading foreign key constraint created by the `up` migration.
   - It then adds back a standard foreign key constraint without cascading behavior.

## Configuration
The migration scripts use standard SQL syntax and do not require additional configuration. However, they assume the existence of `messages` and `topics` tables in the database schema.

Key points about the configuration:
- The foreign key constraint is named `messages_topic_id_fkey` in both scripts.
- The `messages` table has a `topic_id` column that references the `id` column in the `topics` table.

Here's an example of the key SQL commands used in these migrations:

```sql
-- In up.sql
ALTER TABLE messages
ADD CONSTRAINT messages_topic_id_fkey
FOREIGN KEY (topic_id)
REFERENCES topics(id)
ON UPDATE CASCADE
ON DELETE CASCADE;

-- In down.sql
ALTER TABLE messages
ADD CONSTRAINT messages_topic_id_fkey
FOREIGN KEY (topic_id)
REFERENCES topics(id);
```

These migrations provide a way to manage the relationship between messages and topics, allowing for flexible data management strategies depending on the application's requirements.