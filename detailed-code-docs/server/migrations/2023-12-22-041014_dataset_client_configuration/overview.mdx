---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for modifying the `datasets` table in a database. The migration introduces a new `client_configuration` column and renames the existing `configuration` column to `server_configuration`. These changes allow for separate storage of client-specific and server-specific configuration data for datasets.

## What does it do?
The migration scripts perform the following actions:

1. In the "up" migration:
   - Renames the existing `configuration` column to `server_configuration`.
   - Adds a new `client_configuration` column with a JSON data type.

2. In the "down" migration:
   - Removes the `client_configuration` column.
   - Renames the `server_configuration` column back to `configuration`.

These changes enable the application to store and manage separate configuration settings for clients and servers associated with each dataset. This separation allows for more granular control and organization of configuration data.

## Key Files
1. `up.sql`: This file contains the SQL commands to apply the migration, adding the new column and renaming the existing one.

2. `down.sql`: This file contains the SQL commands to revert the migration, removing the new column and restoring the original column name.

Both files use SQL ALTER TABLE statements to modify the `datasets` table structure.

## Configuration
The migration scripts use the following SQL commands and configurations:

1. In `up.sql`:
   ```sql
   ALTER TABLE datasets RENAME COLUMN configuration TO server_configuration;
   ALTER TABLE datasets ADD COLUMN client_configuration JSONB NOT NULL DEFAULT '{}';
   ```
   - The `JSONB` data type is used for the `client_configuration` column, allowing for flexible storage of JSON data.
   - The `NOT NULL` constraint ensures that the column always has a value.
   - The `DEFAULT '{}'` sets an empty JSON object as the default value for new or existing rows.

2. In `down.sql`:
   ```sql
   ALTER TABLE datasets DROP COLUMN IF EXISTS client_configuration;
   ALTER TABLE datasets RENAME COLUMN IF EXISTS server_configuration TO configuration;
   ```
   - The `IF EXISTS` clause is used in both statements to prevent errors if the columns don't exist or have already been modified.

These migration scripts are designed to be reversible, allowing for easy application and rollback of the database changes. The use of JSON data types for configuration storage provides flexibility in storing complex configuration objects without needing to define a rigid structure in advance.