---
title: "down.sql"
---

## High-level description
This SQL script is a migration file that recreates the `stripe_customers` table. It's designed to undo the changes made by the corresponding `up.sql` migration, effectively restoring the table structure that was previously dropped.

## Table of contents
- Table creation
- Column definitions
- Constraints and foreign key

## Symbols

### CREATE TABLE stripe_customers
#### Description
This SQL command creates a new table named `stripe_customers` with specific columns and constraints to store information about Stripe customers.

#### Internal Logic
1. Defines the table structure with six columns
2. Sets up primary key, unique constraints, and a foreign key
3. Specifies data types and constraints for each column

#### Columns
| Name | Type | Constraints | Description |
|:-----|:-----|:------------|:------------|
| id | UUID | NOT NULL, UNIQUE, PRIMARY KEY | Unique identifier for the stripe customer |
| stripe_id | TEXT | NOT NULL, UNIQUE | Stripe's own customer identifier |
| email | VARCHAR(100) | UNIQUE, DEFAULT NULL | Customer's email address |
| created_at | TIMESTAMP | NOT NULL | Timestamp of record creation |
| updated_at | TIMESTAMP | NOT NULL | Timestamp of last record update |

#### Constraints
- Primary Key: `id` column
- Unique Constraints: `id`, `stripe_id`, `email`
- Foreign Key: `email` references `users(email)`

## Dependencies
This migration script depends on the existence of a `users` table, specifically its `email` column, for the foreign key constraint.

## Future Improvements
- Consider adding indexes on frequently queried columns like `stripe_id` or `email` for improved performance.
- If the `users` table's primary key is not the `email` field, consider changing the foreign key reference to the actual primary key of the `users` table for better data integrity.
- Evaluate if `NOT NULL` constraint is appropriate for the `email` column, given it has a `DEFAULT NULL` clause.