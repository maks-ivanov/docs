---
title: "Overview"
---

## High-level description
This directory contains database migration scripts related to the `chunk_collisions` table. The scripts modify foreign key constraints to ensure referential integrity with the `chunk_metadata` table.

## What does it do?
The scripts in this directory manage changes to how the `chunk_collisions` table interacts with the `chunk_metadata` table when records are deleted or updated. 

The `up.sql` script enables cascading deletes and updates. This means:
- When a record in `chunk_metadata` is deleted, any related records in `chunk_collisions` are also automatically deleted.
- When the `id` or `qdrant_point_id` columns in `chunk_metadata` are updated, the corresponding values in related `chunk_collisions` records are also automatically updated.

The `down.sql` script reverts these changes, removing the cascading behavior and renaming the foreign key constraints.

Here is an example of the changes made to the `chunk_collisions` table:

**Before `up.sql`:**

```sql
-- Constraint before modification
ALTER TABLE chunk_collisions
    ADD CONSTRAINT card_collisions_card_id_fkey
    FOREIGN KEY (card_id)
    REFERENCES chunk_metadata(id);
```

**After `up.sql`:**

```sql
-- Constraint after modification
ALTER TABLE chunk_collisions
    ADD CONSTRAINT chunk_collisions_card_id_fkey
    FOREIGN KEY (chunk_id)
    REFERENCES chunk_metadata(id)
    ON DELETE CASCADE
    ON UPDATE CASCADE;
```

These changes ensure that the database maintains data integrity and consistency between the `chunk_collisions` and `chunk_metadata` tables. 
