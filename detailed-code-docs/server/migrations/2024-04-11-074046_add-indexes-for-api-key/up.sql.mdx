---
title: "up.sql"
---

## High-level description
This SQL migration file adds two indexes to the `user_api_key` table to improve query performance for API key-related operations. The indexes are created on the `api_key_hash` and `blake3_hash` columns.

## Table of contents
- Creation of index on `api_key_hash` column
- Creation of index on `blake3_hash` column

## Symbols

### CREATE INDEX IF NOT EXISTS user_api_key_api_key_hash_index
#### Description
This SQL statement creates an index named `user_api_key_api_key_hash_index` on the `api_key_hash` column of the `user_api_key` table if it doesn't already exist.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user_api_key | table | The table on which the index is created |
| api_key_hash | column | The column on which the index is created |

#### Internal Logic
The index is created using the `CREATE INDEX IF NOT EXISTS` syntax, which ensures that the index is only created if it doesn't already exist in the database. This prevents errors if the migration is run multiple times.

### CREATE INDEX IF NOT EXISTS user_api_key_blake3_hash_index
#### Description
This SQL statement creates an index named `user_api_key_blake3_hash_index` on the `blake3_hash` column of the `user_api_key` table if it doesn't already exist.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user_api_key | table | The table on which the index is created |
| blake3_hash | column | The column on which the index is created |

#### Internal Logic
Similar to the previous index, this one is created using the `CREATE INDEX IF NOT EXISTS` syntax to prevent errors on repeated migrations.

## Performance Considerations
The addition of these indexes is likely to improve query performance for operations that involve searching or filtering on the `api_key_hash` and `blake3_hash` columns of the `user_api_key` table. However, it's important to note that while indexes speed up read operations, they can slightly slow down write operations (inserts, updates, and deletes) due to the need to maintain the index structure.

## Future Improvements
- Monitor the usage of these indexes to ensure they are beneficial and not causing unnecessary overhead.
- Consider adding additional indexes if other columns in the `user_api_key` table are frequently used in WHERE clauses or JOIN conditions.
- If the table grows very large, evaluate the need for composite indexes or covering indexes for frequently used query patterns.