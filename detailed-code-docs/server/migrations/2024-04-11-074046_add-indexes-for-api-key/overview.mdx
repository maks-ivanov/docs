---
title: "Overview"
---

## High-level description
This directory contains SQL migration files for adding and removing indexes on the `user_api_key` table. These indexes are designed to optimize query performance for operations involving API keys.

## What does it do?
The migration files in this directory manage database schema changes related to API key indexing. The `up.sql` file adds indexes to the `api_key_hash` and `blake3_hash` columns of the `user_api_key` table. These indexes speed up searches and filtering operations on these columns. The `down.sql` file reverts these changes by dropping the created indexes. This ensures that the database schema can be easily rolled back if needed. 

The indexes are created using the `CREATE INDEX IF NOT EXISTS` statement, which prevents errors if the migration is run multiple times. Similarly, the `DROP INDEX IF EXISTS` statement is used for removal, ensuring safe execution even if the index doesn't exist.

```sql
-- up.sql
CREATE INDEX IF NOT EXISTS user_api_key_api_key_hash_index ON user_api_key (api_key_hash);
CREATE INDEX IF NOT EXISTS user_api_key_blake3_hash_index ON user_api_key (blake3_hash);

-- down.sql
DROP INDEX IF EXISTS user_api_key_api_key_hash_index;
DROP INDEX IF EXISTS user_api_key_blake3_hash_index;
```

These migrations highlight the trade-off between read and write performance in databases. While indexes improve the speed of read operations, they add minor overhead to write operations. The decision to add or remove indexes should be based on the specific usage patterns and performance requirements of the application. 
