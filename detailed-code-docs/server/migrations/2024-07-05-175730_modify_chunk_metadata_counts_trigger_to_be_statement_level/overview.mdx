---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for modifying the trigger mechanism that updates chunk metadata counts in a PostgreSQL database. The scripts transition the database between using a row-level trigger and statement-level triggers for improved efficiency in handling bulk operations on the `chunk_metadata` table.

## What does it do?
The scripts in this directory manage changes to how the database keeps track of the number of chunks associated with each dataset.  They modify database triggers, which are special functions that automatically execute when changes occur in a table. 

Initially, the database used a row-level trigger, meaning the trigger function was called for each individual row inserted or deleted from the `chunk_metadata` table. This approach can be inefficient for bulk operations.

The migration scripts introduce a change to statement-level triggers. With this approach, the trigger function is called only once per SQL statement, regardless of how many rows are affected. This significantly improves performance for bulk inserts or deletes of chunk metadata.

The `up.sql` script applies the migration, replacing the row-level trigger with statement-level triggers. Conversely, the `down.sql` script reverts the database to its previous state, restoring the original row-level trigger.

## Entry points
- `up.sql`: Applies the migration to use statement-level triggers.
- `down.sql`: Reverts the migration, restoring the row-level trigger.
