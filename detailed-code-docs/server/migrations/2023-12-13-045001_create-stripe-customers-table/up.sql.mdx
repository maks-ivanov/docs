---
title: "up.sql"
---

## High-level description
This SQL migration script creates a new table `stripe_customers` and adds a unique constraint to the `email` column in the existing `users` table. It establishes a relationship between Stripe customers and users in the application's database.

## Table of contents
- Add unique constraint to users table
- Create stripe_customers table

## Code Structure
The script consists of two main SQL operations:
1. Altering the `users` table
2. Creating the `stripe_customers` table

## Symbols

### ALTER TABLE users
#### Description
This statement adds a unique constraint to the `email` column in the `users` table.

#### Internal Logic
- Adds a unique constraint named `users_email_unique` to the `email` column
- Ensures that each email in the `users` table is unique

### CREATE TABLE stripe_customers
#### Description
This statement creates a new table named `stripe_customers` to store information about Stripe customers.

#### Internal Logic
- Creates a table with the following columns:
  - `id`: UUID, primary key
  - `stripe_id`: TEXT, unique identifier from Stripe
  - `email`: TEXT, unique, foreign key referencing `users.email`
  - `created_at`: TIMESTAMP
  - `updated_at`: TIMESTAMP
- Establishes a foreign key relationship with the `users` table using the `email` column

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| users table | The existing `users` table is referenced for the foreign key constraint |

## Future Improvements
- Consider adding indexes on frequently queried columns, such as `stripe_id` or `email`, to improve query performance.
- If the application needs to handle soft deletes, consider adding a `deleted_at` timestamp column to the `stripe_customers` table.
- Depending on the application's needs, additional columns like `subscription_status` or `last_payment_date` could be added to the `stripe_customers` table to store more Stripe-related information.