---
title: "down.sql"
---

## High-level description
This SQL migration script is designed to revert changes made in the corresponding `up.sql` file. It adds a constraint to the `card_metadata` table, ensuring that either the `private` column is true or the `qdrant_point_id` is not null.

## Table of contents
- ALTER TABLE statement
- ADD CONSTRAINT statement

## Symbols

### ALTER TABLE card_metadata
#### Description
This SQL command modifies the structure of the `card_metadata` table.

### ADD CONSTRAINT qdrant_point_nullable_constraint
#### Description
This clause adds a new constraint to the `card_metadata` table. The constraint is named `qdrant_point_nullable_constraint` and enforces a rule on the relationship between the `private` and `qdrant_point_id` columns.

#### Internal Logic
The constraint uses a CHECK condition to ensure that either:
1. The `private` column is set to true, OR
2. The `qdrant_point_id` column is not null.

This logic implies that public cards (where `private` is false) must have a non-null `qdrant_point_id`, while private cards can have a null `qdrant_point_id`.

## Dependencies
This script relies on the existence of the `card_metadata` table and its columns `private` and `qdrant_point_id`.

## Future Improvements
- Consider adding error handling or validation to ensure the table and columns exist before applying the constraint.
- If the constraint name is important for future operations, consider using a variable or constant to store the constraint name for consistency across related migration scripts.