---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for a database schema update. The migration is identified as "2023-09-15-061217_metadata_json_columns", suggesting it was created on September 15, 2023, and deals with adding JSON columns for metadata. The directory includes two SQL files: `up.sql` for applying the changes and `down.sql` for reverting them.

## What does it do?
These migration scripts modify the structure of two database tables: `card_metadata` and `files`. The changes include:

1. Renaming the `oc_file_path` column to `tag_set` in both tables.
2. Adding a new `metadata` column of type JSONB to the `card_metadata` table.

The `up.sql` script applies these changes, while the `down.sql` script reverts them, allowing for easy migration rollback if needed.

## Key Files

1. `up.sql`: This file contains the SQL statements to apply the database schema changes. It renames columns and adds a new JSONB column for metadata.

2. `down.sql`: This file contains the SQL statements to revert the changes made by `up.sql`. It renames columns back to their original names and drops the added metadata column.

## Configuration
The migration scripts use PostgreSQL-specific SQL syntax, particularly the JSONB data type for the new `metadata` column. This indicates that the application is using PostgreSQL as its database management system.

Key configuration details:

1. In `up.sql`:
   - The new `metadata` column in the `card_metadata` table is configured as follows:
     - Data type: JSONB
     - Allows NULL values
     - Default value: An empty JSON object (`'{}'::JSONB`)

2. Both scripts modify the `card_metadata` and `files` tables, suggesting these are key tables in the application's data model.

Here's a more detailed breakdown of the changes:

```sql
-- In up.sql
ALTER TABLE card_metadata RENAME COLUMN oc_file_path TO tag_set;
ALTER TABLE card_metadata ADD COLUMN metadata JSONB NULL DEFAULT '{}'::JSONB;
ALTER TABLE files RENAME COLUMN oc_file_path TO tag_set;

-- In down.sql
ALTER TABLE card_metadata RENAME COLUMN tag_set TO oc_file_path;
ALTER TABLE card_metadata DROP COLUMN metadata;
ALTER TABLE files RENAME COLUMN tag_set TO oc_file_path;
```

These changes suggest that the application is moving from a file-path based system to a tag-based system for organizing data, while also introducing a flexible metadata storage solution using JSON. This could indicate a shift towards a more dynamic and flexible data model, possibly to support more complex data structures or to allow for easier querying and filtering of data based on tags and metadata.