---
title: "Overview"
---

## High-level description
This directory contains SQL migration files for creating and dropping the `user_plans` table in a database. The migration is designed to manage user subscription data, including Stripe-related information, plan details, and subscription status.

## What does it do?
These migration files allow the application to:
1. Create a new table called `user_plans` to store user subscription information.
2. Add an index on the `stripe_customer_id` column for improved query performance.
3. Provide a way to undo these changes by dropping the table and index if needed.

The `up.sql` file sets up the new table structure, while the `down.sql` file provides a way to revert these changes, ensuring that the database can be rolled back to its previous state if necessary.

## Key Files

1. `up.sql`: This file contains the SQL commands to create the `user_plans` table and add an index on the `stripe_customer_id` column.

2. `down.sql`: This file contains the SQL commands to drop the `user_plans` table and its associated index, effectively undoing the changes made by `up.sql`.

## Configuration
The `user_plans` table is configured with the following columns:

1. `id`: UUID, primary key
2. `stripe_customer_id`: TEXT, unique, indexed
3. `stripe_subscription_id`: TEXT, unique
4. `plan`: TEXT
5. `status`: TEXT
6. `created_at`: TIMESTAMP
7. `updated_at`: TIMESTAMP

All columns are defined as NOT NULL, ensuring data integrity by requiring a value for each field.

## Code snippets

Here's the SQL code for creating the `user_plans` table in `up.sql`:

```sql
CREATE TABLE user_plans (
    id UUID PRIMARY KEY,
    stripe_customer_id TEXT NOT NULL UNIQUE,
    stripe_subscription_id TEXT NOT NULL UNIQUE,
    plan TEXT NOT NULL,
    status TEXT NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL
);

CREATE INDEX idx_user_plans_stripe_customer_id ON user_plans (stripe_customer_id);
```

And here's the code for dropping the table and index in `down.sql`:

```sql
DROP TABLE IF EXISTS user_plans;
DROP INDEX IF EXISTS idx_user_plans_stripe_customer_id;
```

These migration files provide a robust way to manage the database schema for user subscription plans, allowing for easy creation and removal of the necessary table and index.