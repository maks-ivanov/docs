---
title: "down.sql"
---

## High-level description
This SQL migration script is designed to revert changes made to the `chunk_metadata` table, specifically undoing the addition of a unique constraint on the combination of `tracking_id` and `dataset_id`, and reinstating a unique constraint on `tracking_id` alone.

## Table of contents
- Drop new unique constraint
- Recreate original unique constraint

## Symbols

### Drop new unique constraint
#### Description
This SQL command removes the unique constraint that was previously added to the `chunk_metadata` table for the combination of `tracking_id` and `dataset_id`.

#### Internal Logic
The `ALTER TABLE` statement is used with the `DROP CONSTRAINT` clause to remove the specified constraint named `chunk_metadata_tracking_id_dataset_id_key`.

### Recreate original unique constraint
#### Description
This SQL command adds back the original unique constraint on the `tracking_id` column of the `chunk_metadata` table.

#### Internal Logic
The `ALTER TABLE` statement is used with the `ADD CONSTRAINT` clause to create a new unique constraint named `card_metadata_tracking_id_key` on the `tracking_id` column.

## Side Effects
- The uniqueness of `tracking_id` and `dataset_id` combination is no longer enforced.
- The `tracking_id` column becomes unique across the entire table, regardless of `dataset_id`.

## Future Improvements
- Ensure that the constraint name `card_metadata_tracking_id_key` is correct, as it refers to "card" instead of "chunk". This might be a naming inconsistency that could be addressed in future migrations.
- Consider adding appropriate indexes to support the unique constraint efficiently, especially if the table is expected to grow large.