---
title: "up.sql"
---

## High-level description
This SQL migration script modifies the `chunk_metadata` table by replacing a unique constraint on the `tracking_id` column with a new composite unique constraint on both `tracking_id` and `dataset_id` columns.

## Table of contents
- Drop existing unique constraint
- Add new composite unique constraint

## Symbols

### Drop existing constraint
#### Description
Removes the existing unique constraint on the `tracking_id` column of the `chunk_metadata` table.

#### Internal Logic
The `ALTER TABLE` statement is used to modify the `chunk_metadata` table, and the `DROP CONSTRAINT` clause removes the constraint named `card_metadata_tracking_id_key`.

### Add new composite unique constraint
#### Description
Adds a new unique constraint that ensures the combination of `tracking_id` and `dataset_id` is unique within the `chunk_metadata` table.

#### Internal Logic
The `ALTER TABLE` statement is used again to modify the `chunk_metadata` table. The `ADD CONSTRAINT` clause creates a new constraint named `chunk_metadata_tracking_id_dataset_id_key`, which enforces uniqueness on the combination of `tracking_id` and `dataset_id` columns.

## Side Effects
- The uniqueness requirement for `tracking_id` alone is removed.
- Multiple rows can now have the same `tracking_id` as long as they have different `dataset_id` values.
- Attempts to insert or update rows with duplicate combinations of `tracking_id` and `dataset_id` will be prevented.

## Future Improvements
- Consider adding an index on (tracking_id, dataset_id) if frequent queries use this combination, as it could improve query performance.
- If the table name change from `card_metadata` to `chunk_metadata` was intentional, ensure all related code and queries are updated accordingly.