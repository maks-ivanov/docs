---
title: "down.sql"
---

## High-level description
This SQL script is designed to revert the changes made in the corresponding `up.sql` migration. It recreates the `chunk_files` table and its associated foreign key constraints, effectively undoing the deletion of this table.

## Table of contents
- Create `chunk_files` table
- Add foreign key constraint for `chunk_id`
- Add foreign key constraint for `file_id`

## Symbols

### `chunk_files` table
#### Description
Creates a table named `chunk_files` to store relationships between chunks and files.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| id | uuid | Primary key for the table |
| chunk_id | uuid | Foreign key referencing the `chunk_metadata` table |
| file_id | uuid | Foreign key referencing the `files` table |
| created_at | timestamp with time zone | Timestamp of record creation |
| updated_at | timestamp with time zone | Timestamp of last record update |

#### Internal Logic
- Sets `id` as the primary key
- Sets `chunk_id` and `file_id` as NOT NULL fields
- Sets default values for `created_at` and `updated_at` using the `now()` function

### Foreign Key Constraints
#### Description
Adds two foreign key constraints to the `chunk_files` table to maintain referential integrity.

#### Internal Logic
1. Adds a foreign key constraint `chunk_files_chunk_id_fkey` linking `chunk_id` to the `chunk_metadata` table
2. Adds a foreign key constraint `chunk_files_file_id_fkey` linking `file_id` to the `files` table
3. Both constraints are set to CASCADE on UPDATE and DELETE operations

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| chunk_metadata table | Referenced by the `chunk_id` foreign key |
| files table | Referenced by the `file_id` foreign key |

## Future Improvements
- Consider adding indexes on `chunk_id` and `file_id` columns to improve query performance if these columns are frequently used in WHERE clauses or JOIN operations.
- If the relationship between chunks and files is expected to be one-to-many, consider adding a unique constraint on the combination of `chunk_id` and `file_id` to prevent duplicate entries.