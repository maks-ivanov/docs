---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for adding an `organization_id` column to the `datasets` table. The `up.sql` script applies the migration, while the `down.sql` script reverts it.

## What does it do?
The migration scripts establish a relationship between datasets and organizations. 

1. **Adding the `organization_id` column:** A new column is added to the `datasets` table to store the ID of the organization that the dataset belongs to.
2. **Populating the `organization_id` column:**  The newly added column is populated with the ID of the 'DEFAULT' organization for all existing datasets.
3. **Enforcing data integrity:** The `organization_id` column is made mandatory (NOT NULL) and a foreign key constraint is added to ensure that every dataset is associated with a valid organization.

The `down.sql` script reverses these changes by simply dropping the `organization_id` column.

## Key Files
- **up.sql:** Applies the migration to add the `organization_id` column and establish the relationship with the `organizations` table.
- **down.sql:** Reverts the migration by removing the `organization_id` column.

```sql
-- up.sql
ALTER TABLE datasets ADD COLUMN organization_id UUID DEFAULT NULL;

UPDATE datasets
SET organization_id = (SELECT id FROM organizations WHERE name = 'DEFAULT');

ALTER TABLE datasets ALTER COLUMN organization_id SET NOT NULL;

ALTER TABLE datasets ADD CONSTRAINT datasets_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES organizations(id);
```

```sql
-- down.sql
ALTER TABLE datasets DROP COLUMN IF EXISTS organization_id;
```
