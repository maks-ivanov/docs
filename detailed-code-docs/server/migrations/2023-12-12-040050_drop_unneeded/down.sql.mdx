---
title: "down.sql"
---

## High-level description
This SQL script is designed to revert the changes made in the corresponding `up.sql` file. It recreates tables that were dropped, adds back columns that were removed, and restores functions and triggers that were potentially deleted.

## Table of contents
- Creation of `invitations` table
- Creation of `password_resets` table
- Alteration of `card_metadata` table
- Creation of `update_tsvector` function
- Creation of `update_tsvector_trigger` trigger

## Symbols

### `invitations` table
#### Description
Creates a table to store invitation data for users.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| id | UUID | Unique identifier for each invitation |
| email | VARCHAR(100) | Email address of the invited user |
| expires_at | TIMESTAMP | Expiration date and time of the invitation |
| created_at | TIMESTAMP | Creation date and time of the invitation |
| updated_at | TIMESTAMP | Last update date and time of the invitation |

### `password_resets` table
#### Description
Creates a table to store password reset requests.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| id | UUID | Unique identifier for each password reset request |
| email | VARCHAR(100) | Email address of the user requesting a password reset |
| expires_at | TIMESTAMP | Expiration date and time of the password reset request |
| created_at | TIMESTAMP | Creation date and time of the password reset request |
| updated_at | TIMESTAMP | Last update date and time of the password reset request |

### Alteration of `card_metadata` table
#### Description
Adds a `card_metadata_tsvector` column of type `tsvector` to the `card_metadata` table if it doesn't already exist.

### `update_tsvector()` function
#### Description
Creates a function that updates the `card_metadata_tsvector` column with the tsvector representation of the `content` column.

#### Internal Logic
1. Sets `NEW.card_metadata_tsvector` to the result of `to_tsvector(NEW.content)`.
2. Returns the modified `NEW` record.

### `update_tsvector_trigger` trigger
#### Description
Creates a trigger that calls the `update_tsvector()` function before each insert operation on the `card_metadata` table.

## Future Improvements
- Consider adding indexes on frequently queried columns in the `invitations` and `password_resets` tables to improve query performance.
- Evaluate the need for additional constraints (e.g., CHECK constraints) on the `expires_at` columns to ensure they are set to future dates.
- Consider adding a full-text search index on the `card_metadata_tsvector` column for improved search performance.