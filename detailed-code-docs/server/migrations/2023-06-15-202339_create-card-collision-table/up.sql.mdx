---
title: "up.sql"
---

## High-level description
This SQL migration script creates a new table `card_collisions` to track collisions between cards and adds a unique constraint to the `card_metadata` table. It also creates an index to optimize queries on the new table.

## Table of contents
- Alter `card_metadata` table
- Create `card_collisions` table
- Create index on `card_collisions` table

## Symbols

### ALTER TABLE card_metadata
#### Description
Adds a unique constraint to the `qdrant_point_id` column in the `card_metadata` table.

#### Internal Logic
- Ensures that each `qdrant_point_id` in the `card_metadata` table is unique.

### CREATE TABLE card_collisions
#### Description
Creates a new table to store information about card collisions.

#### Internal Logic
- Defines a new table with three columns: `id`, `card_id`, and `collision_qdrant_id`.
- Sets up foreign key relationships to the `card_metadata` table.

### CREATE INDEX idx_card_collisions_card_id
#### Description
Creates an index on the `card_id` column of the `card_collisions` table.

#### Internal Logic
- Improves query performance for lookups based on `card_id` in the `card_collisions` table.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| card_metadata table | Referenced by foreign keys in the new `card_collisions` table |

## Performance Considerations
The addition of the index on `card_id` in the `card_collisions` table will improve query performance for lookups based on this column. However, it may slightly impact insert and update operations on this table.

## Future Improvements
- Consider adding additional indexes on the `collision_qdrant_id` column if queries frequently filter or join on this column.
- Evaluate the need for a composite index on both `card_id` and `collision_qdrant_id` if these columns are often used together in queries.