---
title: "up.sql"
---

## High-level description
This SQL script creates two tables: `dataset_tags` and `chunk_metadata_tags`. These tables are designed to implement a tagging system for datasets and chunk metadata, establishing relationships between datasets, tags, and chunk metadata.

## Table of contents
- Creation of `dataset_tags` table
- Creation of `chunk_metadata_tags` table

## Symbols

### `dataset_tags` table
#### Description
This table stores tags associated with datasets. It establishes a many-to-one relationship between tags and datasets.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| id | UUID | Primary key, automatically generated |
| dataset_id | UUID | Foreign key referencing the datasets table |
| tag | TEXT | Unique tag text |

#### Constraints
- Primary Key: `id`
- Unique Constraint: `(id, dataset_id)`
- Foreign Key: `dataset_id` references `datasets(id)` with CASCADE update and delete

### `chunk_metadata_tags` table
#### Description
This table implements a many-to-many relationship between chunk metadata and tags, allowing multiple tags to be associated with multiple chunk metadata entries.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| id | UUID | Primary key, automatically generated |
| chunk_metadata_id | UUID | Foreign key referencing the chunk_metadata table |
| tag_id | UUID | Foreign key referencing the dataset_tags table |

#### Constraints
- Primary Key: `id`
- Unique Constraint: `(chunk_metadata_id, tag_id)`
- Foreign Key: `chunk_metadata_id` references `chunk_metadata(id)` with CASCADE update and delete
- Foreign Key: `tag_id` references `dataset_tags(id)` with CASCADE update and delete

## Dependencies
This migration script depends on the existence of the following tables:
| Dependency | Purpose |
|:-----------|:--------|
| datasets | Referenced by dataset_tags.dataset_id |
| chunk_metadata | Referenced by chunk_metadata_tags.chunk_metadata_id |

## Future Improvements
- Consider adding indexes on foreign key columns for improved query performance, especially if these tables are expected to grow large.
- Depending on the application's needs, consider adding a timestamp column to track when tags are added or modified.
- If tag hierarchies or categories are needed in the future, consider adding a parent_tag_id column to the dataset_tags table.