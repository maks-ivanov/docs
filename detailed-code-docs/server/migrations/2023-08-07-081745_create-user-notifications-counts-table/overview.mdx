---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for managing a table called `user_notification_counts` and its associated triggers and functions. The scripts handle the creation, initialization, and removal of database objects related to tracking user notification counts.

## What does it do?
These SQL scripts automate the process of creating and removing database objects needed for tracking how many notifications a user has. They ensure that when a new notification is added or removed for a user, a counter in the `user_notification_counts` table is automatically updated. This table allows the application to quickly retrieve and display the number of notifications a user has without manually calculating it each time. The scripts also handle the initialization of this table with existing notification data when the feature is first implemented.

## Key Files
### up.sql
This script creates the necessary database objects for the user notification count feature:

- **`user_notification_counts` table:** Stores the count of notifications for each user.
- **`update_notification_count()` function:** Updates the notification count in the `user_notification_counts` table whenever a notification is added or removed.
- **Triggers:** Two triggers, `update_verification_notification_count` and `update_file_upload_notification_count`, are set up on the `verification_notifications` and `file_upload_completed_notifications` tables, respectively. These triggers automatically call the `update_notification_count()` function whenever a new notification is added or removed.
- **Data initialization:** The script initializes the `user_notification_counts` table with existing notification data from the `verification_notifications` and `file_upload_completed_notifications` tables.

### down.sql
This script undoes the changes made by `up.sql`:

- **Drops triggers:** Removes the `update_verification_notification_count` and `update_file_upload_notification_count` triggers.
- **Drops function:** Removes the `update_notification_count()` function.
- **Drops table:** Removes the `user_notification_counts` table.
