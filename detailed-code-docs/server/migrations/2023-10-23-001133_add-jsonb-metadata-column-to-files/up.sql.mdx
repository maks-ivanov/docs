---
title: "up.sql"
---

## High-level description
This SQL migration script modifies the `files` table by adding a new JSONB column for metadata and removing an existing column for mime type.

## Table of contents
- Add JSONB metadata column
- Remove mime_type column

## Symbols

### ALTER TABLE files ADD COLUMN metadata
#### Description
This SQL command adds a new column named `metadata` to the `files` table. The column is of type JSONB, which allows for storing JSON-formatted data. It is nullable and has a default value of an empty JSON object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| metadata | JSONB | JSON-formatted metadata for files |

#### Internal Logic
- The column is added to the existing `files` table.
- It allows NULL values, meaning metadata is optional for each file entry.
- The default value is set to an empty JSON object (`'{}'::JSONB`), ensuring that even without explicit metadata, each row will have a valid JSON structure.

### ALTER TABLE files DROP COLUMN mime_type
#### Description
This SQL command removes the `mime_type` column from the `files` table.

#### Internal Logic
- The `mime_type` column is completely removed from the `files` table.
- Any data previously stored in this column will be lost after this migration.

## Side Effects
- The structure of the `files` table is permanently altered.
- Any existing queries or application code relying on the `mime_type` column will need to be updated.
- The new `metadata` column provides a more flexible way to store file-related information, potentially including mime type data if needed.

## Future Improvements
- Consider adding an index on the `metadata` column if frequent queries on its contents are expected, to improve query performance.
- If mime type information is still necessary, ensure it's incorporated into the new `metadata` JSON structure in the application layer.
- Validate that all application code and queries are updated to use the new `metadata` column instead of the removed `mime_type` column.