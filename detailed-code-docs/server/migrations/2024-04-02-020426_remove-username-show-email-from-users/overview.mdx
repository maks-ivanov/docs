---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for modifying the structure of the `users` table in a database. The migration involves removing three columns (`username`, `visible_email`, and `website`) from the `users` table and providing a way to revert these changes if needed.

## What does it do?
The migration scripts in this directory perform the following actions:

1. Up migration (2024-04-02-020426_remove-username-show-email-from-users/up.sql):
   - Removes the `username` column from the `users` table
   - Removes the `visible_email` column from the `users` table
   - Removes the `website` column from the `users` table

2. Down migration (2024-04-02-020426_remove-username-show-email-from-users/down.sql):
   - Adds back the `username` column as TEXT to the `users` table
   - Adds back the `visible_email` column as BOOLEAN with NOT NULL constraint and DEFAULT FALSE to the `users` table
   - Adds back the `website` column as TEXT to the `users` table

These migrations allow for simplifying the user data structure by removing potentially unnecessary fields, while also providing a way to revert these changes if needed in the future.

## Key Files
1. up.sql
   - Contains SQL commands to remove the specified columns from the `users` table
   - Uses `ALTER TABLE` statements with `DROP COLUMN` clauses

2. down.sql
   - Contains SQL commands to add back the previously removed columns to the `users` table
   - Uses `ALTER TABLE` statements with `ADD COLUMN` clauses

## Side Effects
Executing these migrations will have the following side effects:

- For the up migration:
  - The `users` table structure will be modified, removing `username`, `visible_email`, and `website` columns
  - Any data previously stored in these columns will be permanently lost
  - Applications or queries relying on these columns will need to be updated to avoid errors

- For the down migration:
  - The `users` table structure will be modified, adding back `username`, `visible_email`, and `website` columns
  - Existing rows will have NULL values for `username` and `website` columns (unless there's a default value constraint on the table level)
  - Existing rows will have FALSE values for the `visible_email` column due to the default value specified

## Performance Considerations
- Dropping columns is generally a quick operation, but the exact performance impact depends on the database system and the size of the `users` table
- For large tables, these operations might require a table rewrite, which could be time-consuming and resource-intensive

## Future Improvements
1. Consider adding appropriate indexes on the newly added columns in the down migration if they will be frequently queried
2. If `username` is intended to be unique, consider adding a UNIQUE constraint in the down migration
3. If `website` should follow a specific format, consider adding a CHECK constraint or handling validation at the application level
4. Ensure that all application code and database queries are updated to reflect the removal of these columns after applying the up migration
5. If any of the removed fields are still needed in the application, consider storing them in a separate table or a different format (e.g., JSON column) depending on the use case