---
title: "Overview"
---

## High-level description
This directory contains SQL migration files for creating and dropping tables related to card metadata and card votes in a database. The migration consists of two files: an "up" migration for creating the tables and an associated "down" migration for removing them.

## What does it do?
The migration creates two main tables:

1. `card_metadata`: This table stores information about cards, including their content, associated links, authors, and other metadata.
2. `card_votes`: This table keeps track of user votes on cards, allowing users to express their opinions on card content.

The "up" migration creates these tables with appropriate columns, constraints, and indexes to optimize performance. The "down" migration provides a way to revert these changes by dropping the tables if they exist.

## Key Files

1. `up.sql`: This file contains the SQL commands to create the `card_metadata` and `card_votes` tables, along with their respective indexes.

   The `card_metadata` table includes columns for:
   - `id` (UUID, primary key)
   - `content` (TEXT)
   - `link` (TEXT, optional)
   - `author_id` (UUID, referencing the users table)
   - `qdrant_point_id` (UUID)
   - `created_at` and `updated_at` timestamps

   The `card_votes` table includes columns for:
   - `id` (UUID, primary key)
   - `voted_user_id` (UUID, referencing the users table)
   - `card_metadata_id` (UUID, referencing the card_metadata table)
   - `vote` (BOOLEAN)
   - `created_at` and `updated_at` timestamps

   Indexes are created on foreign key columns to improve query performance.

2. `down.sql`: This file contains SQL commands to drop the `card_votes` and `card_metadata` tables if they exist, effectively reverting the changes made by the "up" migration.

## Dependencies
The migration assumes the existence of a `users` table, which is referenced by both new tables through foreign key relationships.

## Configuration
The migration files use standard SQL syntax and do not require any specific configuration. However, the database system should support UUID data types and the ability to set default values for timestamps.

Key points to consider:
- The use of UUIDs as primary keys allows for distributed systems to generate unique identifiers without conflicts.
- Timestamps are automatically set to the current time when records are created or updated.
- The `link` column in the `card_metadata` table is optional and can be NULL.

When applying these migrations, ensure that:
1. The database user has sufficient privileges to create and drop tables and indexes.
2. The `users` table exists in the database before applying the "up" migration.
3. There are no existing tables with the names `card_metadata` or `card_votes` to avoid conflicts.

By implementing these migrations, the database will be set up to store and manage card metadata and user votes, enabling features related to card content management and user interaction within the application.