---
title: "up.sql"
---

## High-level description
This SQL migration script adds a new column `tracking_id` to the `chunk_group` table and creates a unique constraint combining `tracking_id` and `dataset_id`.

## Table of contents
- Add `tracking_id` column to `chunk_group` table
- Create unique constraint on `tracking_id` and `dataset_id`

## Code Structure
The script consists of two SQL ALTER TABLE statements executed sequentially on the `chunk_group` table.

## Symbols

### ALTER TABLE chunk_group ADD COLUMN tracking_id TEXT UNIQUE
#### Description
This statement adds a new column named `tracking_id` to the `chunk_group` table with a UNIQUE constraint.

#### Internal Logic
1. Adds a new column `tracking_id` to the `chunk_group` table
2. Sets the data type of `tracking_id` to TEXT
3. Applies a UNIQUE constraint to ensure each `tracking_id` value is unique within the table

### ALTER TABLE chunk_group ADD CONSTRAINT chunk_group_tracking_id_dataset_id_key UNIQUE (tracking_id, dataset_id)
#### Description
This statement creates a new unique constraint on the `chunk_group` table, combining the `tracking_id` and `dataset_id` columns.

#### Internal Logic
1. Adds a new constraint named `chunk_group_tracking_id_dataset_id_key` to the `chunk_group` table
2. Ensures that the combination of `tracking_id` and `dataset_id` is unique across all rows in the table

## Side Effects
- Existing rows in the `chunk_group` table will have NULL values for the new `tracking_id` column
- Attempts to insert duplicate `tracking_id` values will fail due to the UNIQUE constraint
- Attempts to insert duplicate combinations of `tracking_id` and `dataset_id` will fail due to the new unique constraint

## Performance Considerations
- Adding a new column to an existing table with a UNIQUE constraint may impact performance on large tables
- The new unique constraint on `(tracking_id, dataset_id)` will create an index, which may slightly slow down INSERT and UPDATE operations but can speed up queries that filter or join on these columns

## Future Improvements
- Consider adding a NOT NULL constraint to the `tracking_id` column if all rows should have a value
- If `tracking_id` is meant to be a system-generated identifier, consider using a UUID or a sequence for automatic generation
- Depending on the application's needs, adding an index on `tracking_id` alone (in addition to the composite unique constraint) might improve query performance for lookups by `tracking_id`