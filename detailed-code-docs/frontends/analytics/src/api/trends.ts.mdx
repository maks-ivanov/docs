---
title: "trends.ts"
---

## High-level description
This code defines two asynchronous functions, `getTrendsBubbles` and `getQueriesForTopic`, that interact with the Trieve analytics API to retrieve and process trend data for a given dataset. 

## Table of contents
- `getTrendsBubbles`
- `getQueriesForTopic`

## References
- `apiHost` from `../utils/apiHost`
- Types: `SearchClusterResponse`, `SearchClusterTopics`, `SearchQueryEvent`, `SearchQueryResponse` from `shared/types`

## Symbols

### `getTrendsBubbles`
#### Description
This asynchronous function fetches "trend bubbles" data for a given dataset from the Trieve API. These bubbles likely represent clusters of semantically similar search queries. The function returns an array of `SearchClusterTopics` representing these clusters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| datasetId | string | The ID of the dataset for which to fetch trend data. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;SearchClusterTopics[]&gt; | Promise\&lt;SearchClusterTopics[]&gt; | A promise that resolves to an array of `SearchClusterTopics`, each representing a trend bubble with associated data like topic, density, and average score. |

#### Internal Logic
1. Constructs the API endpoint URL using `apiHost` and the `/analytics/search/clusters` path.
2. Sends a POST request to the endpoint with the `datasetId` in the headers and a JSON body specifying the request `type` as "cluster_topics".
3. Checks if the response is successful (status code 200-299). If not, throws an error with the response status text.
4. Parses the response JSON as a `SearchClusterResponse` object.
5. Returns the `clusters` array from the parsed response data.

### `getQueriesForTopic`
#### Description
This asynchronous function retrieves the individual search queries associated with a specific trend topic (cluster) within a given dataset.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| datasetId | string | The ID of the dataset. |
| clusterId | string | The ID of the specific trend cluster for which to fetch queries. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;SearchQueryEvent[]&gt; | Promise\&lt;SearchQueryEvent[]&gt; | A promise that resolves to an array of `SearchQueryEvent` objects, each representing a single search query event associated with the specified cluster. |

#### Internal Logic
1. Constructs the API endpoint URL using `apiHost` and the `/analytics/search/clusters` path.
2. Sends a POST request to the endpoint with the `datasetId` in the headers and a JSON body specifying the request `type` as "cluster_queries" and the `cluster_id`.
3. Checks if the response is successful. If not, throws an error.
4. Parses the response JSON as a `SearchQueryResponse` object.
5. Returns the `queries` array from the parsed response data.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| shared/types | Provides type definitions for `SearchClusterResponse`, `SearchClusterTopics`, `SearchQueryEvent`, and `SearchQueryResponse`. |
| ../utils/apiHost | Provides the base URL for the Trieve API. |

```
```