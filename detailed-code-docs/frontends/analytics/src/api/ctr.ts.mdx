---
title: "ctr.ts"
---

## High-level description
The code defines an asynchronous function `getSearchCTRSummary` that fetches search click-through rate (CTR) summary data for a given dataset from an API endpoint. It handles API requests and responses, and transforms data for consumption by the application.

## Table of contents
- `getSearchCTRSummary` function

## References
- `AnalyticsFilter` type from "shared/types"
- `apiHost` from "../utils/apiHost"
- `transformAnalyticsFilter` from "../utils/formatDate"

## Symbols

### `getSearchCTRSummary`
#### Description
This asynchronous function fetches search CTR summary data from the API. It constructs the API request, sends it, and processes the response. If successful, it returns the parsed CTR data; otherwise, it throws an error.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| datasetId | string | The ID of the dataset to fetch CTR data for. |
| filters | AnalyticsFilter (optional) | Filters to apply to the CTR data request. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | object | An object containing the search CTR summary data:  |
| | | - `searches_with_clicks`: The number of searches that resulted in a click. |
| | | - `percent_searches_with_clicks`: The percentage of searches that resulted in a click. |
| | | - `avg_position_of_click`: The average position of the clicked result. |

#### Internal Logic
1. Constructs the API endpoint URL using `apiHost` and the "/analytics/ctr" path.
2. Sends a POST request to the API endpoint with the following:
    - Credentials included ("include").
    - Request body containing:
        - `filter`: Transformed `filters` using `transformAnalyticsFilter` if provided, otherwise undefined.
        - `type`: Set to "search_ctr_metrics".
    - Headers:
        - `TR-Dataset`: Set to the provided `datasetId`.
        - `Content-Type`: Set to "application/json".
3. Checks the response status. If not ok (status code 200-299), throws an error with the response status text.
4. Parses the response JSON data into an object with the defined structure.
5. Returns the parsed CTR data object.

## Error Handling
- Throws an error if the API request fails (non-ok response status). The error message includes the response status text.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| shared/types | Provides the `AnalyticsFilter` type. |
| ../utils/apiHost | Provides the `apiHost` variable. |
| ../utils/formatDate | Provides the `transformAnalyticsFilter` function. |
