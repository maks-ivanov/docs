---
title: "LowConfidenceQueries.tsx"
---

## High-level description
This code defines a SolidJS component called `LowConfidenceQueries` that displays a list of search queries with the lowest top scores, allowing users to set a threshold for filtering these queries. It fetches query data from an API, handles pagination, and provides a detailed view of individual queries.

## Table of contents
- `parseThreshold` function
- `LowConfidenceQueries` component
- `QueryCard` component

## Code Structure
The `LowConfidenceQueries` component uses the `createQuery` hook to fetch data from the `getLowConfidenceQueries` API function. It also utilizes the `usePagination` hook to manage pagination. The `QueryCard` component is a child component of `LowConfidenceQueries` and displays details of a single query.

## References
- `getLowConfidenceQueries` (from `../../api/analytics`)
- `DatasetContext` (from `../../layouts/TopBarLayout`)
- `usePagination` (from `../../hooks/usePagination`)
- `PaginationButtons` (from `../PaginationButtons`)
- `FullScreenModal`, `Table`, `Td`, `Th`, `Tr` (from `shared/ui`)
- `SearchQueryEventModal` (from `../../pages/TrendExplorer`)
- `OrgContext` (from `../../contexts/OrgContext`)
- `ChartCard` (from `./ChartCard`)

## Symbols

### `parseThreshold`
#### Description
This function parses a string into a number, returning undefined if the parsing fails.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| text | string | The string to parse. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
|  | number \| undefined | The parsed number or undefined if parsing fails. |

### `LowConfidenceQueries`
#### Description
This component fetches and displays a list of low confidence queries based on a user-defined threshold. It handles pagination and displays query details in a modal when a query is clicked.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| params | AnalyticsParams | An object containing filter and granularity parameters for fetching analytics data. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| JSX.Element |  | A `ChartCard` component containing a table of low confidence queries. |

#### Internal Logic
1. Retrieves the current dataset from the `DatasetContext`.
2. Initializes pagination using the `usePagination` hook.
3. Creates a signal to store the user-defined threshold text.
4. Uses `createQuery` to fetch low confidence queries from the `getLowConfidenceQueries` API function based on the current page, threshold, and analytics parameters.
5. Renders a `ChartCard` component that displays:
    - A title and subtitle for the chart.
    - An input field for the user to enter the threshold.
    - A table of low confidence queries, with each row rendered as a `QueryCard` component.
    - Pagination buttons to navigate between pages of results.

### `QueryCard`
#### Description
This component displays details of a single low confidence query and provides a button to open a modal with more detailed information.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | SearchQueryEvent | The search query event object. |
| filters | AnalyticsFilter | (Optional) An object containing filter parameters for the search query. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| JSX.Element |  | A table row (`Tr`) representing a single query, with a button to open a modal with more details. |

#### Internal Logic
1. Retrieves the current dataset and organization from the `DatasetContext` and `OrgContext`, respectively.
2. Constructs a URL to open the search playground with the current query and filters.
3. Renders a table row (`Tr`) that displays:
    - The query text.
    - The top score of the query.
    - An expand icon that, when clicked, opens a `FullScreenModal` component.
4. The `FullScreenModal` component displays:
    - The query text as the title.
    - A button to open the search playground in a new tab.
    - A `SearchQueryEventModal` component that displays detailed information about the search query event.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @tanstack/solid-query | Used for data fetching and caching. |
| solid-js | The core SolidJS library. |
| shared/types | Provides shared types used across the application. |
| shared/ui | Provides shared UI components. |
| ../../api/analytics | Provides API functions for fetching analytics data. |
| ../../layouts/TopBarLayout | Provides the `DatasetContext`. |
| ../../hooks/usePagination | Provides the `usePagination` hook. |
| ../PaginationButtons | Provides the `PaginationButtons` component. |
| ../../pages/TrendExplorer | Provides the `SearchQueryEventModal` component. |
| ../../contexts/OrgContext | Provides the `OrgContext`. |
| ./ChartCard | Provides the `ChartCard` component. |
| solid-icons/io | Provides SolidJS icons from the Ionicons library. |
| solid-icons/bi | Provides SolidJS icons from the Bootstrap Icons library. |

## Future Improvements
- **Input validation:** Add validation to the threshold input field to ensure the user enters a valid number.
- **Loading state for modal:** Display a loading state while the `SearchQueryEventModal` data is being fetched.
- **Error handling:** Implement error handling for API requests and display user-friendly error messages.
- **Accessibility:** Improve accessibility by adding appropriate ARIA attributes and keyboard navigation.
