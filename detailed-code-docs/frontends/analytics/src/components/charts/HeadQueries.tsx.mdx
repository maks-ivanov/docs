---
title: "HeadQueries.tsx"
---

## High-level description
The `HeadQueries` component displays a table of the most frequent search queries and their counts, fetched from the backend API. It allows pagination through the results and preloads the next page for smoother user experience.

## Table of contents
- Imports
- `HeadQueries` component

## References
- `getHeadQueries` from `../../api/analytics`
- `DatasetContext` from `../../layouts/TopBarLayout`
- `usePagination` from `../../hooks/usePagination`
- `PaginationButtons` from `../PaginationButtons`
- `Table`, `Td`, `Th`, `Tr` from `shared/ui`

## Symbols

### `HeadQueries`
#### Description
This component fetches and displays a paginated table of the most frequent search queries. It leverages Solid Query for data fetching and caching, and utilizes context to access the selected dataset ID.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props | `HeadQueriesProps` | An object containing the following properties: |
| | | - `params`: An object containing a `filter` property of type `AnalyticsFilter` used to filter the head queries. |

#### Outputs
JSX Element representing a table of head queries.

#### Internal Logic
1. **Retrieves Context:** Accesses the selected dataset from the `DatasetContext`.
2. **Initializes Pagination:** Utilizes the `usePagination` hook to manage pagination state.
3. **Data Fetching (Main Query):**
   - Uses `createQuery` from `solid-query` to fetch head queries based on the provided filters and current page.
   - The query function `getHeadQueries` is called with the filter, dataset ID, and current page.
4. **Data Fetching (Prefetch Next Page):**
   - Employs `createEffect` to prefetch the next page of data when the component mounts and whenever the current page changes.
   - It uses `queryClient.prefetchQuery` to fetch data for the next page using the same query key structure as the main query but with an incremented page number.
   - If the fetched data for the next page is empty, it updates the `maxPageDiscovered` in the pagination state.
5. **Rendering:**
   - Uses a `Show` component to conditionally render content based on the query status.
   - While loading, displays a "Loading..." message.
   - When data is available, renders a `Table` component with the fetched head queries.
   - If no data is found, displays a "No Data" message.
   - Renders `PaginationButtons` to navigate through the paginated results.

#### Side Effects
- Fetches data from the backend API using `getHeadQueries`.
- Invalidates queries in the `queryClient` when the dataset ID changes.
- Prefetches the next page of data.

#### Performance Considerations
- Utilizes `solid-query` for efficient caching and data fetching.
- Prefetches the next page of data to improve perceived performance.
- Employs conditional rendering with `Show` to avoid unnecessary rendering.
