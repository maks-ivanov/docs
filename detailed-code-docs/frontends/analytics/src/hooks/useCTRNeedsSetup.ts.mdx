---
title: "useCTRNeedsSetup.ts"
---

## High-level description
The `useCTRNeedsSetup` function is a SolidJS hook that checks if click-through rate (CTR) analytics have been set up for a given dataset. It determines this by querying for CTR summary data and checking if key metrics are null.

## Table of contents
- `useCTRNeedsSetup`

## References
- `DatasetContext`
- `getSearchCTRSummary`

## Symbols

### `useCTRNeedsSetup`
#### Description
This hook determines if CTR analytics need to be set up for the current dataset. It fetches CTR summary data using the `getSearchCTRSummary` API and checks if key metrics like average click position, percentage of searches with clicks, and total searches with clicks are all null. If they are, it implies that CTR data hasn't been sent for this dataset yet.

#### Inputs
None

#### Outputs
Returns a SolidJS memo that resolves to a boolean value. `true` indicates that CTR needs setup, `false` otherwise.

#### Internal Logic
1. Retrieves the current dataset from the `DatasetContext`.
2. Defines a Solid Query (`searchSummaryQuery`) to fetch CTR summary data using `getSearchCTRSummary` API.
3. Creates a SolidJS memo (`ctrNeedsSetup`) that:
    - Depends on the `searchSummaryQuery` and dataset ID.
    - If the query is successful, checks if `avg_position_of_click`, `percent_searches_with_clicks`, and `searches_with_clicks` are all null in the response data.
    - Returns `true` if all metrics are null (indicating CTR setup is needed), otherwise returns `false`.
4. Returns the `ctrNeedsSetup` memo.

## Side Effects
- Fetches data from the `/analytics/ctr` endpoint using the `getSearchCTRSummary` function.

## References
- `DatasetContext` from `../layouts/TopBarLayout`
- `getSearchCTRSummary` from `../api/ctr`
