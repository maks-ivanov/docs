---
title: "UserAuthContext.tsx"
---

## High-level description
The `UserAuthContextProvider` component in `UserAuthContext.tsx` manages user authentication and authorization. It fetches user data on mount, redirects to the login page if unauthorized, and provides user and organization context to its children.

## Table of contents
- UserContext
- UserAuthContextProvider

## Code Structure
The `UserAuthContextProvider` component uses the `UserContext` to provide user data to its children. It fetches user data and updates the `UserContext` on mount. If the user is not authenticated, it redirects to the login page.

## References
- `UserContext`
- `OrgContextProvider`
- `TopBarLayout`
- `SlimUser` (from "shared/types")
- `apiHost` (from "../utils/apiHost")

## Symbols

### `UserContext`
#### Description
A SolidJS context that stores and provides the authenticated user's information.

#### Inputs
None

#### Outputs
`UserContextType` object containing:
| Name | Type | Description |
|:-----|:-----|:------------|
| user | Accessor&lt;SlimUser&gt; | A SolidJS accessor providing the `SlimUser` object representing the logged-in user. |

### `UserAuthContextProvider`
#### Description
A SolidJS component that manages user authentication and authorization. It attempts to log in the user on mount and provides user context to its children.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| children | JSX.Element | The child components to be rendered within the provider's context. |

#### Outputs
JSX.Element representing the rendered component tree.

#### Internal Logic
1. **State Initialization:**
   - `userInfo`: A SolidJS signal initialized to `null`, storing the fetched `SlimUser` data upon successful login.

2. **Login Function (`login`):**
   - Attempts to fetch user data from the `/auth/me` endpoint with credentials included.
   - If the response status is 401 (Unauthorized):
     - Redirects the browser to the login page with a redirect URI pointing back to the current origin.
   - If the response is successful:
     - Parses the response JSON as a `SlimUser` object.
     - Updates the `userInfo` signal with the fetched user data.

3. **Mount Effect:**
   - Calls the `login` function when the component mounts to attempt user authentication.

4. **Conditional Rendering:**
   - Uses a `Show` component to conditionally render its children.
   - If `userInfo` is truthy (user is logged in):
     - Renders a `UserContext.Provider` to provide the `user` accessor to its children.
     - Wraps the children with `OrgContextProvider` and `TopBarLayout` components, passing the `userInfo` to them.
   - If `userInfo` is falsy (user is not logged in):
     - Renders nothing, effectively hiding the content that requires authentication.

## Side Effects
- Redirects the browser to the login page if the user is not authenticated.
- Sets the user's information in the browser's local storage upon successful login.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| solid-js | Provides core SolidJS functionalities like signals, context, and lifecycle hooks. |
| @solidjs/router | Enables routing and redirection. |
| shared/types | Imports the `SlimUser` type definition. |
| ../utils/apiHost | Imports the `apiHost` variable, likely containing the base URL for API requests. |
| ./OrgContext | Imports the `OrgContextProvider` component, responsible for managing organization-related context. |
| ../layouts/TopBarLayout | Imports the `TopBarLayout` component, likely a layout component for the application. |

