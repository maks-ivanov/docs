---
title: "formatDate.ts"
---

## High-level description
This code provides a set of utility functions for formatting and parsing dates, primarily for use with the analytics API. It includes functions for converting dates to API-compatible strings, parsing custom date strings, and transforming date parameters for analytics filters.

## Table of contents
- `formatDateForApi`
- `parseCustomDateString`
- `transformAnalyticsFilter`
- `transformDateParams`
- `formatSensibleTimestamp`

## References
This code references the following types from the `shared/types` file:
- `AnalyticsFilter`
- `DateRangeFilter`

## Symbols

### `formatDateForApi`
#### Description
Formats a `Date` object into a string representation suitable for use with the analytics API. The format is `YYYY-MM-DD HH:mm:ss` in the UTC timezone.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| date | `Date` | The date object to format. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| formattedDate | `string` | The formatted date string. |

#### Internal Logic
1. Uses `toLocaleString` with the `en-CA` locale and specific options to format the date and time components.
2. Replaces any commas in the formatted string with an empty string.

### `parseCustomDateString`
#### Description
Parses a custom date string in the format `YYYY-MM-DD HH:mm:ss.SSS` into a `Date` object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| dateString | `string` | The date string to parse. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| date | `Date` | The parsed `Date` object. |

#### Internal Logic
1. Splits the input string into date and time parts.
2. Parses the year, month, day, hour, minute, second, and milliseconds from the respective parts.
3. Constructs an ISO 8601 date string in the format `YYYY-MM-DDTHH:mm:ss.SSSZ`.
4. Creates a new `Date` object from the ISO string.

### `transformAnalyticsFilter`
#### Description
Transforms an analytics filter object by formatting the `date_range` property using the `transformDateParams` function.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| filter | `HasDateRange` | The analytics filter object to transform. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| transformedFilter | `AnalyticsFilter` | The transformed analytics filter object with formatted date range. |

#### Internal Logic
1. Spreads the properties of the input filter object into a new object.
2. If the `date_range` property exists, it calls the `transformDateParams` function to format the date range.
3. Returns the new object with the potentially transformed `date_range` property.

### `transformDateParams`
#### Description
Transforms a `DateRangeFilter` object by formatting its date properties (`gt`, `lt`, `gte`, `lte`) using the `formatDateForApi` function.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| params | `DateRangeFilter` | The date range filter object to transform. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| transformedParams | `DateRangeFilter` | The transformed date range filter object with formatted date properties. |

#### Internal Logic
1. Iterates over each date property (`gt`, `lt`, `gte`, `lte`) of the input object.
2. If a property exists, it calls the `formatDateForApi` function to format the date.
3. Returns a new object with the potentially transformed date properties.

### `formatSensibleTimestamp`
#### Description
Formats a timestamp in a human-readable way based on the provided date range. If the range is within 24 hours, it shows only the time. If within 7 days, it shows the date. Otherwise, it shows the full date and time.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| date | `Date` | The date object to format. |
| range | `AnalyticsFilter["date_range"]` | The date range to consider for formatting. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| formattedTimestamp | `string` | The formatted timestamp string. |

#### Internal Logic
1. Determines the highest and lowest time boundaries from the provided date range.
2. Calculates the difference in hours between the highest and lowest times.
3. Applies different formatting based on the hour difference:
    - If less than or equal to 24 hours, format as `HH:mm:ss`.
    - If less than or equal to 7 days, format as `toLocaleDateString`.
    - Otherwise, format as `toLocaleDateString`.

## Dependencies
- `date-fns`: Used for date manipulation and formatting.

```
import { differenceInHours, format } from "date-fns";
```
