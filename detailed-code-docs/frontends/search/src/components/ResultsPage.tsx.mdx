---
title: "ResultsPage.tsx"
---

## High-level description
The `ResultsPage` component is responsible for displaying the results of a search query. It handles loading and displaying search results, pagination, and interactions with individual result chunks, including bookmarking, deleting, and expanding. It also provides functionality for chatting with selected results using a chat popup.

## Table of contents
- Imports
- Component Definition (`ResultsPage`)
  - State variables
  - Data fetching functions (`fetchChunkCollections`, `rateQuery`, `handleDownloadFile`, `fetchBookmarks`)
  - Effects for data fetching and UI updates
  - Rendering Logic

## Code Structure
The `ResultsPage` component is structured around several key state variables that hold the search results, user information, and UI state. It uses SolidJS's reactive primitives (`createEffect`, `createSignal`, `createMemo`) to manage data flow and UI updates. The component fetches data from the API based on the search parameters and updates the state variables accordingly. The rendering logic uses conditional rendering (`Show`, `Switch`, `Match`) to display different UI elements based on the state.

## References
- `ScoreChunk` component (used to display individual search results)
- `FullScreenModal` component (used for modals)
- `PaginationController` component (used for pagination)
- `ConfirmModal` component (used for delete confirmation)
- `ChatPopup` component (used for chatting with results)
- `DatasetAndUserContext` (provides access to dataset and user information)
- `useSearch` hook (provides search parameters and state management)

## Symbols

### `ResultsPage`
#### Description
This component is responsible for fetching and displaying search results, handling user interactions, and managing the UI state related to search results.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| search | SearchStore | An object containing the search parameters and state management functions from the `useSearch` hook. |
| rateQuery | Accessor&lt;boolean&gt; | A signal indicating whether the rate query modal should be open. |
| setRatingQuery | Setter&lt;boolean&gt; | A function to set the value of the `rateQuery` signal. |

#### Outputs
This component renders the search results page, including the results themselves, pagination controls, and a chat popup.

#### Internal Logic
1. **Data Fetching:**
   - Fetches chunk collections using `fetchChunkCollections`.
   - Fetches bookmarks using `fetchBookmarks`.
   - Fetches search results based on search parameters using `fetch` and updates the state variables `resultChunks` and `groupResultChunks` accordingly.
2. **UI Updates:**
   - Uses `createEffect` to update the UI based on changes to search parameters, dataset, and page number.
   - Uses `Show`, `Switch`, and `Match` to conditionally render UI elements based on loading state, search results, and user interactions.
3. **User Interactions:**
   - Handles pagination using the `PaginationController` component.
   - Handles chunk deletion using the `ConfirmModal` component.
   - Handles chunk expansion/collapse using the `expanded` state variable.
   - Handles opening the chat popup using the `openChat` state variable.
   - Handles selecting chunks for chat using the `selectedIds` state variable.
4. **Chat Functionality:**
   - Uses the `ChatPopup` component to display the chat interface.
   - Passes the selected chunk IDs to the `ChatPopup` component.

#### Side Effects
- Modifies the URL search parameters based on the search state.
- Updates local storage with previous messages for the chat.
- Makes API requests to fetch data and perform actions.

#### Performance Considerations
- Uses `createMemo` to memoize the `dataset` and `useExpand` values, preventing unnecessary recalculations.
- Limits the number of selected chunks for chat to 10 to improve performance.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| solid-js | Provides the core reactive programming primitives and UI components. |
| solid-icons/* | Provides various icons used in the component. |
| @solidjs/router | Provides routing functionality for navigating between pages. |
| sanitize-html | Provides HTML sanitization to prevent XSS vulnerabilities. |
| shared/ui | Provides shared UI components, including the `Tooltip` component. |
| ../utils/apiTypes | Provides TypeScript types for API requests and responses. |
| ../hooks/useSearch | Provides the `useSearch` hook for managing search parameters and state. |
| ../utils/downloadFile | Provides the `downloadFile` function for downloading files. |
| ./Atoms/FullScreenModal | Provides the `FullScreenModal` component for displaying modals. |
| ./Atoms/PaginationController | Provides the `PaginationController` component for pagination. |
| ./Atoms/ConfirmModal | Provides the `ConfirmModal` component for delete confirmation. |
| ./Contexts/DatasetAndUserContext | Provides the `DatasetAndUserContext` for accessing dataset and user information. |
| ./ScoreChunk | Provides the `ScoreChunk` component for displaying individual search results. |
| ./ChatPopup | Provides the `ChatPopup` component for chatting with results. |
| ./BookmarkPopover | Provides the `BookmarkPopover` component for managing bookmarks. |
| ./ShowToasts | Provides the `createToast` function for displaying toast notifications. |

## Error Handling
- Uses `try...catch` blocks to handle errors during API requests.
- Displays error messages to the user using the `createToast` function.

## Logging
- Logs the value of the `props.rateQuery` signal to the console.
