---
title: "CreateNewDocChunkForm.tsx"
---

## High-level description
The `CreateNewDocChunkForm` component provides a form for users to create new document chunks within a selected dataset. It handles user input for various chunk attributes, including content, metadata, and optional parameters like location and weight. The component interacts with the backend API to submit the new chunk data.

## Table of contents
- Imports
- Component Logic
    - State variables
    - `submitDocChunk` function
    - JSX Structure

## Code Structure
The `CreateNewDocChunkForm` component is structured to manage the state of the form and handle the submission of new document chunks. It utilizes several state variables to track user input and component status. The `submitDocChunk` function is responsible for constructing the request payload and interacting with the backend API. The JSX structure renders the form elements and dynamically displays content based on user interaction.

## References
- `FullScreenModal` from `./Atoms/FullScreenModal`
- `CreateChunkDTO`, `isActixApiDefaultError` from `../utils/apiTypes`
- `JsonInput`, `Tooltip` from `shared/ui`
- `DatasetAndUserContext` from `./Contexts/DatasetAndUserContext`
- `TinyEditor` from `./TinyEditor`

## Symbols

### `CreateNewDocChunkForm`
#### Description
This component renders a form for creating new document chunks. It allows users to input various attributes for the chunk, including content, metadata, and optional parameters like location and weight. The component handles form submission, validation, and interaction with the backend API.

#### Inputs
This is a React component, it doesn't have traditional function inputs.

#### Outputs
This is a React component, its output is the JSX code representing the form.

#### Internal Logic
1. **Initialization:** The component initializes several state variables using `createSignal` to manage the form data, error messages, submission status, and visibility of modals.
2. **Form Rendering:** The component renders a form with input fields for various chunk attributes. It dynamically shows/hides advanced options based on the `showAdvanced` state.
3. **Input Handling:** Each input field is bound to a corresponding state variable, updating the state on user input.
4. **Form Submission (`submitDocChunk`):**
   - Prevents default form submission behavior.
   - Retrieves the selected dataset from context.
   - Validates if chunk content is provided.
   - Constructs the request body with chunk data, including optional parameters.
   - Makes a POST request to the `/chunk` API endpoint with the request body.
   - Handles the API response:
     - If successful, navigates to the newly created chunk page.
     - If unauthorized (401), shows the login modal.
     - If other errors occur, displays the error message.
5. **Login Modal:**
   - Conditionally renders a full-screen modal prompting the user to log in if they are not authenticated.

#### Side Effects
- Modifies the browser's local storage to store the selected dataset and organization.
- Navigates to different routes based on user interaction and API response.
- Makes API requests to `/chunk` and `/auth/me`.

#### Performance Considerations
- The component uses `createEffect` to optimize state updates and API calls, ensuring they are triggered only when necessary.
- The `TinyEditor` component, responsible for the rich text editor, might have performance implications for large content. Consider using a more lightweight editor if performance becomes an issue.

## Dependencies
- solid-js
- solid-icons/bi
- shared/ui
- @solidjs/router

### Configuration
- `VITE_API_HOST`: The base URL of the backend API.

## Error Handling
- The component handles API errors by displaying error messages to the user.
- It specifically checks for 401 Unauthorized errors and displays a login modal.
- Input validation is performed for required fields, and errors are displayed accordingly.

## Logging
The code does not implement any specific logging mechanisms.

## Future Improvements
- Implement more robust input validation, potentially using a schema validation library.
- Add error handling for the API request in `login` function within the `createEffect`.
- Consider adding a loading indicator during API requests.
- Explore using a more lightweight rich text editor if performance becomes a concern.
