---
title: "BookmarkPopover.tsx"
---

## High-level description
The `BookmarkPopover` component is a SolidJS component that displays a popover allowing users to manage chunk group memberships for a specific chunk. It provides functionality to view existing groups, add the current chunk to groups, create new groups, and paginate through the list of available groups.

## Table of contents
- Component: `BookmarkPopover`

## Code Structure
The `BookmarkPopover` component uses several SolidJS primitives like `createSignal`, `createEffect`, `Show`, and `For` to manage its state and rendering logic. It fetches data for chunk groups and bookmarks from the backend API and updates the UI accordingly. The component also utilizes the `DatasetAndUserContext` to access information about the current dataset and user.

## References
- `DatasetAndUserContext`
- `InputRowsForm`
- `Tooltip`

## Symbols

### Symbol Name: `BookmarkPopover`
#### Description
This component renders a popover that allows users to manage which groups a chunk belongs to. It displays a list of groups, a checkbox for adding/removing the chunk from each group, and buttons for creating new groups and navigating pages of groups.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| chunkMetadata | `ChunkMetadata` | Metadata of the chunk for which to manage group memberships. |
| chunkGroups | `ChunkGroupDTO[]` | Array of chunk groups to display. |
| totalGroupPages | `number` | Total number of pages for the chunk groups. |
| setLoginModal | `Setter&lt;boolean&gt;` | Setter function to control the visibility of a login modal. |
| bookmarks | `ChunkBookmarksDTO[]` | Array of chunk bookmarks. |
| setChunkGroups | `Setter&lt;ChunkGroupDTO[]&gt;` | Setter function to update the list of chunk groups. |

#### Outputs
This component doesn't have a direct output. It updates the UI and interacts with the backend API to manage chunk group memberships.

#### Internal Logic
1. **Initialization:**
   - Retrieves the API host from environment variables.
   - Accesses the `DatasetAndUserContext` to get the current user and dataset.
   - Initializes several signals to manage component state, including:
     - `refetchingChunkGroups`: Indicates if chunk groups are being fetched.
     - `refetchingBookmarks`: Indicates if bookmarks are being fetched.
     - `showGroupForm`: Controls the visibility of the group creation form.
     - `notLoggedIn`: Indicates if the user is not logged in.
     - `groupFormTitle`: Stores the title of the new group being created.
     - `usingPanel`: Tracks if the user is interacting with the popover panel.
     - `bookmarks`: Stores the list of chunk bookmarks.
     - `localGroupPage`: Tracks the current page of chunk groups.
     - `localChunkGroups`: Stores the list of chunk groups to display.

2. **Data Fetching and Synchronization:**
   - Uses `createEffect` hooks to:
     - Populate `bookmarks` and `localChunkGroups` based on props.
     - Fetch chunk groups from the API when `localGroupPage` changes.
     - Refetch chunk groups when `refetchingChunkGroups` is true.
     - Refetch bookmarks when `refetchingBookmarks` is true.

3. **Group Management:**
   - Provides checkboxes for each group, allowing users to add or remove the current chunk from the group.
   - Updates the backend API when the checkbox state changes.
   - Implements a group creation form, allowing users to create new groups.
   - Refetches chunk groups after creating a new group.

4. **UI Rendering:**
   - Uses `Show` components to conditionally render elements based on state.
   - Uses `For` components to iterate and render lists of groups and bookmarks.
   - Provides pagination controls to navigate through pages of chunk groups.

#### Side Effects
- Fetches data from the backend API.
- Updates the backend API when chunk group memberships change.
- Updates the URL search parameters and local storage based on the selected dataset and organization.

## Dependencies
- `solid-js`: Core SolidJS library.
- `solid-headless`: Headless UI components for SolidJS.
- `solid-icons/ri`: Icon library for SolidJS.
- `solid-icons/bi`: Icon library for SolidJS.
- `shared/ui`: Shared UI components.

## Error Handling
- The component checks the response status code from API calls and displays an error toast if the request fails.
- It handles the case where the user is not logged in by setting the `notLoggedIn` signal to true and prompting the user to log in.

## Future Improvements
- Implement error handling for API requests and display user-friendly messages.
- Add loading indicators while fetching data from the API.
- Consider using a more robust pagination solution for large numbers of groups.
- Implement functionality to edit existing group details.
- Add search functionality to filter the list of groups.
