---
title: "actix-api.ts"
---

## High-level description
This TypeScript file defines interfaces and utility functions for handling API responses, user plans, and referral tokens in a chat application. It includes type definitions for API errors, Stripe checkout sessions, and user subscription plans, along with type guards and localStorage management for referral tokens.

## Table of contents
- Interface definitions (ActixApiDefaultError, StripeCheckoutSessionResponse, UserPlan)
- Referral token management functions (detectReferralToken, getReferralTokenArray)
- Type guard functions (isStripeCheckoutSessionResponse, isUserPlan)

## Code Structure
The code defines several interfaces and functions that are related to API responses and user management. The `detectReferralToken` and `getReferralTokenArray` functions work together to manage referral tokens in localStorage. The type guard functions (`isStripeCheckoutSessionResponse` and `isUserPlan`) are used to validate the structure of API responses.

## Symbols

### `ActixApiDefaultError`
#### Description
An interface representing the default error structure for the Actix API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| message | string | The error message |

### `StripeCheckoutSessionResponse`
#### Description
An interface representing the response structure for a Stripe checkout session.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| checkout_session_url | string | The URL for the Stripe checkout session |

### `detectReferralToken`
#### Description
A function that detects and stores referral tokens in localStorage.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| queryParamT | string \| undefined | The referral token from query parameters |

#### Internal Logic
1. Check if a referral token is provided
2. Retrieve existing tokens from localStorage
3. Add the new token if it doesn't exist
4. Update localStorage with the new token array

### `getReferralTokenArray`
#### Description
A function that retrieves the array of referral tokens from localStorage.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| referralTokens | string[] | An array of stored referral tokens |

### `isStripeCheckoutSessionResponse`
#### Description
A type guard function to check if a given object is a valid StripeCheckoutSessionResponse.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | unknown | The object to be checked |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| isValid | boolean | True if the object is a valid StripeCheckoutSessionResponse, false otherwise |

### `UserPlan`
#### Description
An interface representing a user's subscription plan.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| id | string | The plan ID |
| stripe_customer_id | string | The Stripe customer ID |
| stripe_subscription_id | string | The Stripe subscription ID |
| plan | "silver" \| "gold" | The plan type |
| status | string | The subscription status |
| created_at | string | The creation timestamp |
| updated_at | string | The last update timestamp |

### `isUserPlan`
#### Description
A type guard function to check if a given object is a valid UserPlan.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | unknown | The object to be checked |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| isValid | boolean | True if the object is a valid UserPlan, false otherwise |

## Dependencies
The code relies on the browser's `localStorage` API for storing and retrieving referral tokens.

## Future Improvements
1. Consider adding error handling for localStorage operations in case of quota exceeded or other storage-related issues.
2. Implement a mechanism to expire or remove old referral tokens to prevent unlimited growth of the token array.
3. Add validation for the referral token format in the `detectReferralToken` function.
4. Consider using a more secure storage mechanism for sensitive data like referral tokens, such as encrypted localStorage or session storage.