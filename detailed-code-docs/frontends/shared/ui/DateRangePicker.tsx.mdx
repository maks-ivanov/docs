---
title: "DateRangePicker.tsx"
---

## High-level description
The code defines a `DateRangePicker` component that allows users to select a date range using a calendar interface. It provides preset options for common timeframes and integrates with analytics parameters for granularity suggestions.

## Table of contents
- Imports
- `getGranularitySuggestion` function
- `transformOurTypeToTheirs` function
- `transformTheirTypeToOurs` function
- `getLabelFromRange` function
- `unitIsToday` function
- `DateRangePicker` component
- `CustomInput` component
- `DatePreset` type
- `defaultDatePresets` array
- `Presets` component

## Code Structure
The `DateRangePicker` component utilizes several helper functions to manage date transformations, label generation, and granularity suggestions. It also includes nested components, `CustomInput` and `Presets`, for rendering the input field and preset options respectively.

## References
- `AnalyticsParams` and `DateRangeFilter` types from `../types`

## Symbols

### `getGranularitySuggestion`
#### Description
Determines a suggested granularity for analytics based on the selected date range.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| range | `DateRangeFilter` | The selected date range. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| granularity | `AnalyticsParams["granularity"]` | The suggested granularity ("second", "minute", "hour", or "day"). |

#### Internal Logic
- Calculates the difference in minutes between the start and end dates.
- Suggests "second" granularity for differences less than 3 minutes.
- Calculates the difference in hours.
- Suggests "minute" for differences less than 3 hours, "hour" for differences up to 24 hours, and "day" otherwise.

### `transformOurTypeToTheirs`
#### Description
Converts a `DateRangeFilter` object to a `PickerAloneValue` object used by the `@rnwonder/solid-date-picker` library.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| value | `DateRangeFilter` | The date range filter to convert. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| PickerAloneValue | `PickerAloneValue` | The converted date range value. |

#### Internal Logic
- Extracts start and end dates from the `DateRangeFilter`.
- Uses the `utils().convertDateToDateObject` function from the date picker library to convert the dates.

### `transformTheirTypeToOurs`
#### Description
Converts a date range value from the `@rnwonder/solid-date-picker` library (`DateObjectUnits`) to a `DateRangeFilter` object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| startDate | `DateObjectUnits` | The start date object. |
| endDate | `DateObjectUnits` | The end date object. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| DateRangeFilter | `DateRangeFilter` | The converted date range filter. |

#### Internal Logic
- Uses the `utils().convertDateObjectToDate` function from the date picker library to convert the date objects.
- Sets the end date to the current date if `unitIsToday` returns true for the end date.

### `getLabelFromRange`
#### Description
Generates a label string based on the selected date range.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| value | `DateRangeFilter` | The selected date range. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| label | `string` | The generated label string. |

#### Internal Logic
- If the end date is within 4 minutes of the current time, it generates a label like "Last 15 minutes".
- Otherwise, it returns "NO LABEL" (this part seems incomplete).

### `unitIsToday`
#### Description
Checks if a given `DateObjectUnits` object represents the current day.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| unit | `DateObjectUnits` | The date object to check. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| isToday | `boolean` | True if the date object represents the current day, false otherwise. |

### `DateRangePicker`
#### Description
The main component that renders the date range picker.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| label | `string` (optional) | The label for the date range picker. |
| value | `DateRangeFilter` | The currently selected date range. |
| onChange | `(value: DateRangeFilter) =&gt; void` | Callback function triggered when the selected date range changes. |
| onGranularitySuggestion | `(granularity: AnalyticsParams["granularity"]) =&gt; void` (optional) | Callback function triggered when a granularity suggestion is available. |
| initialSelectedPresetId | `number` (optional) | The ID of the preset to select initially. |
| presets | `DatePreset[]` (optional) | An array of custom date presets. |

#### Outputs
JSX rendering the date range picker component.

#### Internal Logic
- Uses `createMemo` to transform the `value` prop to the format required by the date picker library.
- Handles date range changes, triggers the `onChange` callback, and provides granularity suggestions.
- Renders the `DatePicker` component from `@rnwonder/solid-date-picker`.
- Uses `CustomInput` to render the input field.
- Uses `Presets` to render the preset options.

### `CustomInput`
#### Description
Renders a custom input field for the date range picker.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| label | `string` (optional) | The label for the input field. |
| value | `Accessor&lt;PickerValue&gt;` | The current value of the date range picker. |
| showDate | `() =&gt; void` | Function to show the date picker dropdown. |

#### Outputs
JSX rendering the custom input field.

### `DatePreset`
#### Description
Defines the structure of a date preset object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| id | `number` (optional) | The ID of the preset. |
| label | `string` | The label for the preset. |
| range | `DateRangeFilter` | The date range for the preset. |
| granularity | `AnalyticsParams["granularity"]` | The suggested granularity for the preset. |

### `defaultDatePresets`
#### Description
An array of default date presets.

### `Presets`
#### Description
Renders a list of date presets.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| value | `DateRangeFilter` | The currently selected date range. |
| presets | `DatePreset[]` (optional) | An array of custom date presets. |
| onChange | `(value: DateRangeFilter) =&gt; void` | Callback function triggered when a preset is selected. |
| selectedPresetId | `number` | The ID of the currently selected preset. |
| setSelectedPresetId | `(id: number) =&gt; void` | Function to set the selected preset ID. |
| onGranularitySuggestion | `(granularity: AnalyticsParams["granularity"]) =&gt; void` (optional) | Callback function triggered when a granularity suggestion is available. |

#### Outputs
JSX rendering the list of date presets.

## Dependencies
- `@rnwonder/solid-date-picker`: A date picker library for SolidJS.
- `solid-js`: The core SolidJS library.
- `solid-icons/tb`: A library for SolidJS icons.
- `date-fns`: A library for date manipulation.

## Future Improvements
- The `getLabelFromRange` function could be enhanced to provide more descriptive labels for a wider range of date ranges.
- Consider adding functionality to handle custom date ranges beyond the provided presets.
- Implement more robust error handling, especially for cases where the start date is missing in the `DateRangeFilter` object.
