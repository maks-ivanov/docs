---
title: "useDatasetPages.ts"
---

## High-level description
This code defines a custom SolidJS hook called `useDatasetPages` that manages pagination, searching, and data fetching for datasets associated with a specific organization. It fetches datasets in batches, handles search queries, and provides access to paginated dataset data.

## Table of contents
- `getDatasets` function
- `useDatasetPages` function

## Symbols

### `getDatasets`
#### Description
This asynchronous function fetches datasets for a given organization ID from the API. It fetches data in batches until all datasets are retrieved.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgId | string | The ID of the organization for which to fetch datasets. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise&lt;DatasetAndUsage[]&gt; | Promise | A promise that resolves to an array of `DatasetAndUsage` objects representing the fetched datasets. |

#### Internal Logic
1. Initializes variables for pagination and result storage.
2. Enters a `while` loop that continues until all datasets are fetched.
3. Constructs the API endpoint URL with pagination parameters.
4. Fetches data from the API using the `fetch` function.
5. Handles API response errors.
6. Parses the response JSON and appends fetched datasets to the results array.
7. Updates pagination variables.
8. Returns the array of fetched datasets.

### `useDatasetPages`
#### Description
This custom SolidJS hook manages pagination, searching, and data fetching for datasets associated with an organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props | object | An object containing the following properties:
| | org | Accessor&lt;Organization \| undefined&gt; | An accessor function returning the selected organization.
| | page | Accessor&lt;number&gt; | An accessor function returning the current page number.
| | searchQuery | Accessor&lt;string&gt; | An accessor function returning the current search query.
| | setPage | (page: number) =&gt; void | A function to update the current page number.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| object | object | An object containing the following properties:
| | datasets | Accessor&lt;DatasetAndUsage[]&gt; | An accessor function returning the paginated and filtered datasets.
| | maxPageDiscovered | Accessor&lt;number&gt; | An accessor function returning the highest page number reached.
| | maxDatasets | Accessor&lt;number&gt; | An accessor function returning the total number of datasets.
| | removeDataset | (datasetId: string) =&gt; void | A function to remove a dataset from the local state.
| | hasLoaded | Accessor&lt;boolean&gt; | An accessor function indicating whether the datasets have finished loading.

#### Internal Logic
1. Initializes signals for loading state and dataset storage.
2. Uses `createEffect` to fetch datasets when the organization or search query changes.
3. Defines a `removeDataset` function to remove a dataset from the local state.
4. Uses `createMemo` to derive the following:
    - `currDatasets`: Filters and paginates the datasets based on the search query and current page.
    - `maxPageDiscovered`: Calculates the maximum page number based on the total number of datasets.
    - `maxDatasets`: Returns the total number of datasets.
5. Returns an object containing the derived values and functions.

## Side Effects
- Fetches data from the API.
- Updates local component state based on API responses and user interactions.

## Dependencies
- `solid-js`: Used for creating signals, effects, and memos.
- `@nozbe/microfuzz`: Used for fuzzy search functionality.
- `shared/types`: Imports type definitions for `DatasetAndUsage` and `Organization`.

## Error Handling
- The `getDatasets` function includes a `try...catch` block to handle errors during the API request.
- If the API request fails, the `canFetchAgain` flag is set to `false` to stop further requests.

## Future Improvements
- Implement error handling for the `clearDataset` and `reloadChunkCount` functions.
- Consider adding a loading indicator while fetching dataset usage data.
- Explore caching mechanisms to optimize dataset fetching and reduce API calls.
- Add functionality to update the dataset name locally after editing it in the settings.
