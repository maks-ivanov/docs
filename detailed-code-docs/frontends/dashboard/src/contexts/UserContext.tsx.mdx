---
title: "UserContext.tsx"
---

## High-level description
The `UserContextWrapper` component provides a SolidJS context for managing user-related data and actions within the dashboard application. It handles user login, organization selection, and provides access to user information and actions.

## Table of contents
- `UserContext`
- `UserContextWrapper`

## Code Structure
The `UserContextWrapper` component defines a SolidJS context (`UserContext`) and a wrapper component (`UserContextWrapper`) that provides the context to its children. The wrapper component handles user login, organization selection, and data loading, while the context provides access to user data and actions.

## References
- `SlimUser` type from "shared/types"
- `createToast` function from "../components/ShowToasts"

## Symbols

### `UserContext`
#### Description
A SolidJS context that provides access to user-related data and actions.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user | Accessor&lt;SlimUser \| null&gt; \| null | An accessor for the current user object or null if not logged in |
| setUser | (user: SlimUser \| null) =&gt; void | A function to set the current user object |
| selectedOrganizationId | Accessor&lt;string \| null&gt; \| null | An accessor for the currently selected organization ID or null if none selected |
| setSelectedOrganizationId | (id: string \| null) =&gt; void | A function to set the currently selected organization ID |
| login | () =&gt; void | A function to trigger user login |
| logout | () =&gt; void | A function to trigger user logout |
| loading | Accessor&lt;boolean&gt; \| null | An accessor for the loading state (true if loading, false otherwise) |

### `UserContextWrapper`
#### Description
A wrapper component that provides the `UserContext` to its children. It handles user login, organization selection, and data loading.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| children | JSX.Element | The child components to render within the context |

#### Outputs
JSX.Element - The rendered child components wrapped in the `UserContext.Provider`.

#### Internal Logic
1. **Initialization:**
    - Defines the API host URL from environment variables.
    - Creates signals for user data, selected organization ID, and loading state.
    - Defines the `login` function, which fetches user data from the API and handles redirection for authentication.
2. **Automatic Login:**
    - Uses a `createEffect` to automatically trigger the `login` function on component mount.
3. **Organization Selection:**
    - Uses a `createEffect` to manage the selected organization ID.
    - If no organization is explicitly selected, it attempts to determine the organization ID from the URL or user's organizations.
    - If the selected organization ID is not valid for the current user, it triggers the `login` function to refresh user data.
4. **Context Provider:**
    - Creates a `UserStore` object containing the user data, actions, and loading state.
    - Renders the child components wrapped in a `UserContext.Provider` with the `userStore` as the value.
    - Displays a loading spinner while the user data is being fetched.

## Side Effects
- Modifies the browser's local storage to store the `showSubMenu` state.
- Redirects the user to the login page if authentication fails.
- Displays toast notifications for errors and success messages.

## Dependencies
- "solid-js"
- "shared/types"
- "../components/ShowToasts"

## Configuration
- `VITE_API_HOST`: The base URL of the API server.

## Error Handling
- Catches errors during API requests and displays error toast notifications.
- Handles 401 Unauthorized responses by redirecting the user to the login page.

## Logging
- Logs errors to the console.
