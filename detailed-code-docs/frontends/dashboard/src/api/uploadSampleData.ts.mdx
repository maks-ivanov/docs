---
title: "uploadSampleData.ts"
---

## High-level description
The code defines a function `uploadSampleData` that fetches sample data from a hardcoded CSV file, processes it, and uploads it to the `/chunk` endpoint of a Trieve server. This function is used to populate newly created datasets with example data.

## Table of contents
- Type Definitions
- Constant Definitions
- Function: `sendDataToTrieve`
- Function: `transformRow`
- Function: `uploadSampleData`

## References
- `Papa.parse`: This code utilizes the `Papa.parse` function from the `papaparse` library for parsing CSV data.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| papaparse | Used for parsing CSV data. |

## Symbols

### Symbol Name: `ChunkData`
#### Description
A TypeScript type defining the structure of each data row as parsed from the CSV file.

#### Inputs
N/A - This is a type definition, not a function.

#### Outputs
N/A - This is a type definition, not a function.

### Symbol Name: `Data`
#### Description
A TypeScript type defining the structure of a single data entry after being transformed from `ChunkData`.

#### Inputs
N/A - This is a type definition, not a function.

#### Outputs
N/A - This is a type definition, not a function.

### Symbol Name: `UploadDataArray`
#### Description
A TypeScript type defining an array of arrays of `Data` objects. This structure is used to batch data for upload.

#### Inputs
N/A - This is a type definition, not a function.

#### Outputs
N/A - This is a type definition, not a function.

### Symbol Name: `api_host`
#### Description
A constant storing the base URL of the Trieve API, retrieved from the `VITE_API_HOST` environment variable.

#### Inputs
N/A - This is a constant, not a function.

#### Outputs
N/A - This is a constant, not a function.

### Symbol Name: `sendDataToTrieve`
#### Description
This asynchronous function sends an array of data to the Trieve `/chunk` endpoint in batches.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | `UploadDataArray` | An array of arrays of `Data` objects to be uploaded. |
| datasetId | `string` | The ID of the dataset to which the data belongs. |
| reportProgress | `(progress: number) =&gt; void` | An optional callback function to report upload progress. |

#### Outputs
This function does not explicitly return a value, but it resolves the promise when all data has been sent.

#### Internal Logic
1. Iterates through the `data` array, sending each sub-array as a JSON payload to the `/chunk` endpoint.
2. Includes the `datasetId` in the request headers.
3. Optionally calls the `reportProgress` callback after each batch upload.

### Symbol Name: `transformRow`
#### Description
This function transforms a single row of parsed CSV data (`ChunkData`) into the `Data` format expected by the Trieve API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| row | `{ data: ChunkData }` | An object containing the parsed CSV row data. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| transformed data | `Data \| undefined` | The transformed data object, or `undefined` if an error occurs or the row is invalid. |

#### Internal Logic
1. Checks for empty or invalid data in the row.
2. Splits the "Tag Set" string into an array.
3. Parses the "Metadata" string as JSON.
4. Returns the transformed `Data` object.

### Symbol Name: `uploadSampleData`
#### Description
This asynchronous function orchestrates the process of fetching, parsing, transforming, and uploading sample data to the Trieve server.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| datasetId | `string` | The ID of the dataset to which the data belongs. |
| reportProgress | `(progress: number) =&gt; void` | An optional callback function to report upload progress. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| promise resolution | `Promise&lt;boolean&gt;` | A promise that resolves to `true` if the upload is successful, and `false` otherwise. |

#### Internal Logic
1. Fetches the CSV data from the hardcoded URL using `Papa.parse`.
2. Uses the `transformRow` function to process each row of data.
3. Batches the transformed data into arrays of 120 items.
4. Calls `sendDataToTrieve` to upload the data in batches.
5. Resolves the promise with `true` on successful upload, and rejects with `false` on error.

## Error Handling
The `uploadSampleData` function uses a promise to handle errors during the CSV parsing and data upload process. If an error occurs during either process, the promise is rejected. The `transformRow` function handles potential JSON parsing errors by returning `undefined` for invalid "Metadata" values.

## Future Improvements
- **Dynamic Data Source:** Instead of hardcoding the CSV URL, allow the user to provide a URL or upload a file.
- **Error Reporting:** Provide more informative error messages to the user in case of upload failures or data processing errors.
- **Dataset Configuration:** Allow the user to configure dataset parameters (e.g., embedding model, distance metric) when uploading sample data.
- **Progress Granularity:** Improve the progress reporting to provide more granular updates, especially for large datasets.
- **Cancellation:** Implement a mechanism to allow the user to cancel the upload process.
