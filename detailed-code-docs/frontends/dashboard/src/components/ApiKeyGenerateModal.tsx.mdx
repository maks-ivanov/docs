---
title: "ApiKeyGenerateModal.tsx"
---

## High-level description
This code defines a modal component, `ApiKeyGenerateModal`, used for generating API keys within a dashboard application. It provides a form for specifying key details like name, permissions, and scope, and displays the generated key upon successful creation.

## Table of contents
- Imports
- `ApiKeyGenerateModal` component

## Symbols
### `ApiKeyGenerateModal`
#### Description
This component renders a modal dialog that allows users to generate API keys. It handles form input for key details, makes an API call to generate the key, and displays the generated key to the user.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| openModal | Accessor&lt;boolean&gt; |  A signal indicating whether the modal is open. |
| closeModal | () =&gt; void | A function to close the modal. |
| refetch | (info?: unknown) =&gt; ApiKeyRespBody[] \| Promise&lt;ApiKeyRespBody[]&gt; \| null \| undefined | A function to refetch API keys, likely used to update the list of keys after a new one is generated. |

#### Outputs
This component doesn't have a direct output. It renders UI elements and updates the application state.

#### Internal Logic
1. **Initialization:**
   - Retrieves the API host from environment variables.
   - Accesses user context to get organization and role information.
   - Initializes signals for managing form input (API key, name, role, selected organizations, datasets, and routes) and tracking the generation status.
   - Creates a resource to fetch datasets and usages based on selected organizations.
2. **Form Rendering:**
   - Displays a form with input fields for the API key name, permission level, and an expandable section for specifying the scope (organizations, datasets, routes).
   - Uses `MultiSelect` components to allow selecting multiple organizations, datasets, and routes.
   - Disables dataset selection if no organizations are selected.
3. **API Key Generation:**
   - When the form is submitted:
     - Prevents default form submission.
     - Makes a POST request to the `/user/api_key` endpoint with the provided key details.
     - If the request is successful, updates the `apiKey` signal with the generated key and sets `generated` to true.
     - If the request fails, displays an error toast.
4. **Generated Key Display:**
   - Once the key is generated:
     - Displays a success message and the generated API key.
     - Provides a button to copy the key to the clipboard.
5. **Modal State Management:**
   - Resets the form and generated state when the modal is closed.

#### Side Effects
- Makes API requests to generate the API key and fetch datasets.
- Updates the application state by calling `refetch` after a successful key generation.
- Interacts with the browser's clipboard API to copy the generated key.
- Displays toasts using the `createToast` function.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| solid-js | Core library for building the user interface and managing reactivity. |
| terracotta | UI component library used for elements like Dialog, Disclosure, Listbox. |
| shared/types | Provides TypeScript types for API responses and other data structures. |
| ../contexts/UserContext | Provides access to user-related information and functions. |
| ./ShowToasts | Provides the `createToast` function for displaying toast notifications. |
| solid-icons/fa | Provides Font Awesome icons. |
| ./MultiSelect | Custom component for selecting multiple items from a list. |
| shared/ui | Provides the `Tooltip` component. |
| ./Routes | Provides API route definitions. |

### Configuration
This component relies on the following environment variable:
| Option |  Description |
|:-------|:------------|
| VITE_API_HOST | The base URL of the API server. |
