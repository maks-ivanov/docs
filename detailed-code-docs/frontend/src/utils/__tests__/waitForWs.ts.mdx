---
title: "waitForWs.ts"
---

## High-level description
The target file contains unit tests for the `waitForWs` function, which is designed to establish a WebSocket connection with a specified URL. The tests verify that the function correctly resolves when a connection is successful and rejects when a connection fails. The tests use the `vitest` testing framework to mock the WebSocket behavior and validate the function's response.

## Code Structure
The main symbols in the code are interconnected as follows:
- The `describe` block groups the tests related to the `waitForWs` function.
- The `beforeAll` and `afterAll` hooks are used to save and restore the original `WebSocket` object, ensuring that the tests do not affect the global state.
- The `it` blocks contain individual test cases that mock the `WebSocket` object and test the behavior of the `waitForWs` function under different conditions.

## References
- `waitForWs`: This function is imported from `../waitForWs` and is the primary subject of the tests in this file.

## Symbols

### `describe("waitForWs", () =&gt; { ... })`
#### Description
This block groups all the test cases related to the `waitForWs` function. It sets up the environment for testing and contains individual test cases.

### `beforeAll(() =&gt; { ... })`
#### Description
Saves the original `WebSocket` object before any tests are run to ensure it can be restored later.

#### Side Effects
- Modifies the global `WebSocket` object.

### `afterAll(() =&gt; { ... })`
#### Description
Restores the original `WebSocket` object after all tests have been executed.

#### Side Effects
- Restores the global `WebSocket` object to its original state.

### `it("should resolve when the WebSocket connection is successful", async () =&gt; { ... })`
#### Description
Tests that the `waitForWs` function resolves successfully when a WebSocket connection is established.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| url | string | The WebSocket URL to connect to. |

#### Outputs
- The test expects the `waitForWs` function to resolve with the URL when the connection is successful.

#### Internal Logic
- Mocks the `WebSocket` object to simulate a successful connection.
- Calls `waitForWs` with a test URL and verifies that it resolves with the correct URL.
- Checks that the `WebSocket` constructor was called with the correct URL.

### `it("should reject when the WebSocket connection fails", async () =&gt; { ... })`
#### Description
Tests that the `waitForWs` function rejects with an error when a WebSocket connection fails.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| url | string | The WebSocket URL to connect to. |

#### Outputs
- The test expects the `waitForWs` function to reject with an error message indicating the connection failure.

#### Internal Logic
- Mocks the `WebSocket` object to simulate a connection error.
- Calls `waitForWs` with a test URL and verifies that it rejects with an appropriate error message.
- Checks that the `WebSocket` constructor was called with the correct URL.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| `vitest` | Used for setting up and running the unit tests, including mocking and assertions. |

## Error Handling
The tests simulate error conditions by mocking the `WebSocket` object to trigger the `onerror` event, allowing the `waitForWs` function to be tested for its error handling capabilities.

## Logging
No explicit logging is implemented in the test code. The focus is on assertions and mocking to verify behavior.

## TODOs
No TODOs or notes are present in the code.