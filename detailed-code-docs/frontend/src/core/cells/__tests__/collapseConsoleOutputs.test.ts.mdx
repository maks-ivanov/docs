---
title: "collapseConsoleOutputs.test.ts"
---

## High-level description

The target file contains a suite of unit tests for the `collapseConsoleOutputs` function, which is designed to process and potentially merge console output messages. The tests verify that the function correctly collapses consecutive text outputs on the same channel, handles special characters like carriage returns, and respects different channels and mimetypes. Additionally, the tests check that the function can truncate output when a limit is specified.

## Code Structure

The main symbol in this file is the `collapseConsoleOutputs` function, which is imported from another module. The tests are organized using the `describe` and `it` functions from the `vitest` testing framework. Each test case is designed to validate a specific behavior of the `collapseConsoleOutputs` function, such as handling of newlines, different channels, and truncation.

## References

- `collapseConsoleOutputs`: This function is the primary focus of the tests and is imported from the `collapseConsoleOutputs` module.
- `OutputMessage`: A type imported from the `messages` module, representing the structure of console output messages.

## Symbols

### `describe`
#### Description
The `describe` function is used to group related test cases together. In this file, it groups all tests related to the `collapseConsoleOutputs` function.

### `it`
#### Description
The `it` function defines individual test cases within the `describe` block. Each test case checks a specific aspect of the `collapseConsoleOutputs` function's behavior.

### `collapseConsoleOutputs`
#### Description
The `collapseConsoleOutputs` function processes an array of `OutputMessage` objects, potentially merging consecutive messages with the same mimetype and channel, handling special characters, and truncating output if a limit is specified.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| consoleOutputs | OutputMessage[] | An array of console output messages to be processed. |
| limit | number (optional) | A limit on the number of lines to retain in the output. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | OutputMessage[] | An array of processed output messages, potentially merged or truncated. |

#### Internal Logic
The function likely iterates over the `consoleOutputs` array, checking for consecutive messages with the same mimetype and channel to merge them. It handles special characters like carriage returns by processing the `data` field of each message. If a `limit` is provided, it truncates the output to retain only the specified number of lines, adding a warning message if truncation occurs.

## Side Effects
There are no side effects mentioned in the tests, and the function is expected not to mutate the input array, as verified by one of the test cases.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `vitest` | Provides the testing framework used to define and run the test cases. |

## Error Handling
The tests do not explicitly cover error handling, suggesting that the `collapseConsoleOutputs` function is expected to handle typical input without raising exceptions.

## Logging
There is no logging implemented in the test file.

## TODOs
There are no TODOs or notes left in the code.