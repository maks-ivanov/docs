---
title: "extension.ts"
---

## High-level description

The target file, `extension.ts`, is part of a CodeMirror-based text editor's find-and-replace functionality. It defines a function `findReplaceBundle` that integrates keybindings and search-related extensions into the editor, allowing users to open and close the find-and-replace panel, select occurrences, and highlight search matches.

## Code Structure

The main symbol in this file is the `findReplaceBundle` function. It utilizes several imported functions and objects to configure the editor's behavior related to find-and-replace operations. The function returns an array of extensions that include key mappings and search-related features.

## References

- `HotkeyProvider` from `@/core/hotkeys/hotkeys`: Provides hotkey configurations.
- `highlightSelectionMatches`, `selectNextOccurrence` from `@codemirror/search`: Used for search and selection functionalities.
- `keymap` from `@codemirror/view`: Used to define key mappings.
- `closeFindReplacePanel`, `openFindReplacePanel` from `./state`: Functions to control the visibility of the find-and-replace panel.
- `highlightTheme`, `searchHighlighter`, `searchState` from `./search-highlight`: Used for search highlighting and state management.

## Symbols

### `findReplaceBundle`
#### Description
The `findReplaceBundle` function configures the find-and-replace functionality in a CodeMirror editor instance. It sets up keybindings for opening and closing the find-and-replace panel, selecting the next occurrence of a search term, and integrates search highlighting features.

#### Inputs
| Name   | Type           | Description                  |
|:-------|:---------------|:-----------------------------|
| hotkeys | HotkeyProvider | Provides hotkey configurations for the editor. |

#### Outputs
| Name   | Type           | Description                  |
|:-------|:---------------|:-----------------------------|
| output | Array          | An array of CodeMirror extensions for find-and-replace functionality. |

#### Internal Logic
1. **Keymap Configuration**: 
   - Binds the `Escape` key to close the find-and-replace panel.
   - Binds a hotkey for selecting the next occurrence of a search term.
   - Binds a hotkey for opening the find-and-replace panel.
2. **Search Highlighting**: 
   - Integrates `highlightSelectionMatches` to visually highlight search matches.
   - Includes `searchHighlighter` and `searchState` for managing search state and highlighting.
   - Applies `highlightTheme` for consistent styling of search matches.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `@codemirror/search` | Provides search and selection functionalities. |
| `@codemirror/view` | Used for key mapping and editor view configurations. |
| `@/core/hotkeys/hotkeys` | Supplies hotkey configurations. |

## Error Handling
The code does not explicitly handle errors within the `findReplaceBundle` function. It assumes that the provided hotkeys and imported functions work as expected.

## Logging
There is no logging implemented in this code.

## TODOs
There are no TODOs or notes left in the code.