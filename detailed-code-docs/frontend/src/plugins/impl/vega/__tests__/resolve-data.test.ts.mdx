---
title: "resolve-data.test.ts"
---

## High-level description

The target file contains unit tests for the `resolveVegaSpecData` function, which is responsible for resolving data URLs in a Vega-Lite specification. The tests ensure that the function correctly handles various scenarios, such as when the specification is empty, when it contains data without URLs, and when it needs to resolve data from valid URLs, including nested data structures.

## Code Structure

The main symbols in the code are the `resolveVegaSpecData` function and the `vegaLoader` object. The `resolveVegaSpecData` function is the primary focus of the tests, and it relies on the `vegaLoader` to load data from URLs. The tests use the `vitest` testing framework to define test cases and assertions.

## References

- `resolveVegaSpecData`: The function being tested, which is defined in `resolve-data.ts`.
- `vegaLoader`: An object used to load data from URLs, defined in `loader.ts`.
- `VegaLiteSpec`: A type representing a Vega-Lite specification, imported from `types.ts`.

## Symbols

### `asSpec`
#### Description
The `asSpec` function is a utility that casts an unknown input to a `VegaLiteSpec` type. It is used in the tests to ensure that the input specifications conform to the expected type.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| spec | unknown | The input specification to be cast. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| output | VegaLiteSpec | The input cast to a `VegaLiteSpec` type. |

___

### `resolveVegaSpecData` (Test Suite)
#### Description
This test suite contains multiple test cases for the `resolveVegaSpecData` function. It verifies the function's behavior under different conditions, such as when the input spec is falsy, when it lacks data, when data URLs are invalid, and when data URLs need to be resolved.

#### Internal Logic
- **Falsy Input Spec**: Tests that the function returns the input spec if it is `null` or `undefined`.
- **No Data in Spec**: Tests that the function returns the input spec if it has no data.
- **Data Without URL**: Tests that the function returns the input spec if the data does not contain a URL.
- **Invalid URL**: Tests that the function throws an error if the URL in the data is invalid.
- **Resolve URL Data**: Tests that the function resolves the URL data and returns a new spec with the resolved data.
- **Nested URL Data in Layers**: Tests that the function correctly resolves nested URL data in layers.
- **Nested URL Data in hconcat and vconcat**: Tests that the function correctly resolves nested URL data in `hconcat` and `vconcat` structures.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `vitest` | Used for defining and running the test cases. |

## Error Handling

The tests check for error handling in the `resolveVegaSpecData` function by verifying that it throws an error when an invalid URL is encountered.

## Logging

No logging mechanisms are implemented in the code.

## TODOs

There are no TODOs or notes left in the code.