---
title: "Overview"
---

## High-level description

The directory `tests/_output/formatters` contains test modules designed to verify the functionality of various formatters within the Marimo framework. These tests ensure that different data types and objects are correctly formatted into specific MIME types, such as HTML and JSON, and that third-party libraries like Altair, pandas, polars, matplotlib, and numpy are properly integrated with the Marimo framework. The tests also check the robustness of the formatter registration system and handle special cases, such as when dependencies are missing.

## What does it do?

The tests in this directory are responsible for validating the formatting capabilities of the Marimo framework. They simulate different scenarios to ensure that data visualization libraries and other data types are correctly formatted for display in environments like Jupyter notebooks. For instance, the tests check if Altair charts are converted to HTML, if pandas and polars DataFrames are formatted correctly, and if matplotlib plots are processed as images. The tests also handle cases where dependencies are not installed, ensuring that the framework gracefully skips tests that cannot be executed.

## Entry points

The main files in this directory are:

- `test_altair.py`: Tests the Altair formatter, ensuring that Altair charts are correctly converted to HTML.
- `test_formatter_utils.py`: Tests utility functions related to formatting, such as determining whether to use `src` or `srcdoc` attributes for iframes.
- `test_formatters.py`: Contains comprehensive tests for the formatter system, including integration with pandas and polars, and handling of broken formatters.
- `test_structures.py`: Tests the integration of matplotlib and numpy with the Marimo framework, ensuring that matplotlib plots are correctly formatted.

## Key Files

- **`test_altair.py`**: Focuses on testing the Altair formatter. It checks if Altair charts are correctly formatted into HTML when executed within the Marimo kernel.
  
- **`test_formatter_utils.py`**: Tests the `src_or_src_doc` utility function, which determines whether to return HTML content as a `src` or `srcdoc` attribute for an iframe, based on the execution context.

- **`test_formatters.py`**: Contains a variety of tests for the formatter system, including:
  - Testing the registration and retrieval of formatters.
  - Ensuring that different data types, such as lists and DataFrames, are formatted correctly.
  - Handling exceptions raised by formatters and verifying that errors are reported correctly.

- **`test_structures.py`**: Tests the special case handling of matplotlib objects, ensuring that when matplotlib and numpy are available, the appropriate formatters are registered and can process matplotlib plot lines correctly.

## Dependencies

The tests in this directory rely on several external libraries and frameworks:

- **`pytest`**: Used for running the test cases and handling test execution.
- **`unittest.mock`**: Used for mocking functions and objects during testing.
- **`marimo`**: The main framework being tested, specifically its formatting capabilities.
- **`html`**: Used to escape HTML content in the utility tests.
- **`matplotlib` and `numpy`**: Used in the `test_structures.py` to test the integration of these libraries with the Marimo framework.
- **`pandas` and `polars`**: Used in `test_formatters.py` to test the formatting of DataFrames.

These dependencies are chosen to ensure that the tests can simulate real-world scenarios where data visualization and manipulation libraries are used in conjunction with the Marimo framework.