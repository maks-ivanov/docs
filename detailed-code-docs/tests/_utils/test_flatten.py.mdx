---
title: "test_flatten.py"
---

## High-level description

The target file `tests/_utils/test_flatten.py` contains a suite of unit tests for the `flatten` and `contains_instance` functions from the `marimo._utils.flatten` module. These tests verify the functionality of flattening nested data structures (lists, tuples, and dictionaries) into a flat list and then reconstructing the original structure. Additionally, the tests check for cyclic structures and the presence of specific instances within nested structures.

## Code Structure

The main symbols in the code are the test functions, each of which tests a specific aspect of the `flatten` and `contains_instance` functions. These test functions are independent of each other and use the `pytest` framework to assert expected outcomes.

## References

- `flatten`: A function from `marimo._utils.flatten` that flattens nested structures and provides a function to reconstruct the original structure.
- `contains_instance`: A function from `marimo._utils.flatten` that checks if a nested structure contains an instance of a specified class.
- `CyclicStructureError`: An exception from `marimo._utils.flatten` raised when a cyclic structure is detected.

## Symbols

### `test_flat_list`
#### Description
Tests the `flatten` function with a simple list to ensure it flattens correctly and can be reconstructed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | List[int] | A simple list of integers. |

#### Outputs
None (asserts are used for validation).

### `test_flat_tuple`
#### Description
Tests the `flatten` function with a simple tuple to ensure it flattens correctly and can be reconstructed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | Tuple[int, ...] | A simple tuple of integers. |

#### Outputs
None (asserts are used for validation).

### `test_flat_dict`
#### Description
Tests the `flatten` function with a simple dictionary to ensure it flattens correctly and can be reconstructed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | Dict[int, int] | A simple dictionary with integer keys and values. |

#### Outputs
None (asserts are used for validation).

### `test_flat_empty_list`
#### Description
Tests the `flatten` function with an empty list to ensure it handles empty structures correctly.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | List[Any] | An empty list. |

#### Outputs
None (asserts are used for validation).

### `test_flat_empty_tuple`
#### Description
Tests the `flatten` function with an empty tuple to ensure it handles empty structures correctly.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | Tuple[Any, ...] | An empty tuple. |

#### Outputs
None (asserts are used for validation).

### `test_flat_empty_dict`
#### Description
Tests the `flatten` function with an empty dictionary to ensure it handles empty structures correctly.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | Dict[Any, Any] | An empty dictionary. |

#### Outputs
None (asserts are used for validation).

### `test_flat_singleton_list`
#### Description
Tests the `flatten` function with a singleton list to ensure it flattens correctly and can be reconstructed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | List[int] | A list with a single integer. |

#### Outputs
None (asserts are used for validation).

### `test_flat_singleton_tuple`
#### Description
Tests the `flatten` function with a singleton tuple to ensure it flattens correctly and can be reconstructed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | Tuple[int, ...] | A tuple with a single integer. |

#### Outputs
None (asserts are used for validation).

### `test_flat_singleton_dict`
#### Description
Tests the `flatten` function with a singleton dictionary to ensure it flattens correctly and can be reconstructed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | Dict[int, int] | A dictionary with a single key-value pair. |

#### Outputs
None (asserts are used for validation).

### `test_nested_list`
#### Description
Tests the `flatten` function with a nested list to ensure it flattens correctly and can be reconstructed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | List[Any] | A nested list with various levels of nesting. |

#### Outputs
None (asserts are used for validation).

### `test_nested_tuple`
#### Description
Tests the `flatten` function with a nested tuple to ensure it flattens correctly and can be reconstructed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | Tuple[Any, ...] | A nested tuple with various levels of nesting. |

#### Outputs
None (asserts are used for validation).

### `test_nested_dict`
#### Description
Tests the `flatten` function with a nested dictionary to ensure it flattens correctly and can be reconstructed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | Dict[str, Any] | A nested dictionary with various levels of nesting. |

#### Outputs
None (asserts are used for validation).

### `test_nested_mix`
#### Description
Tests the `flatten` function with a mixed nested structure of lists, tuples, and dictionaries to ensure it flattens correctly and can be reconstructed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | List[Any] | A mixed nested structure. |

#### Outputs
None (asserts are used for validation).

### `test_nested_mix_repack_objects`
#### Description
Tests the `flatten` function with a mixed nested structure and verifies the repacking of different object types.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | List[Any] | A mixed nested structure. |

#### Outputs
None (asserts are used for validation).

### `test_flatten_cyclic_structure_raises`
#### Description
Tests that the `flatten` function raises a `CyclicStructureError` when a cyclic structure is encountered.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | List[Any] | A list containing itself. |
| d | Dict[Any, Any] | A dictionary containing itself. |

#### Outputs
None (asserts are used for validation).

### `test_flatten_repeated_structure_does_not_raise`
#### Description
Tests that the `flatten` function does not raise an error for repeated structures that are not cyclic.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| x | List[Any] | An empty list. |
| y | List[List[Any]] | A list containing multiple references to `x`. |

#### Outputs
None (asserts are used for validation).

### `test_flatten_custom_list`
#### Description
Tests the `flatten` function with a custom list subclass to ensure it flattens correctly and can be reconstructed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| custom_list | CustomList | An instance of a custom list subclass. |

#### Outputs
None (asserts are used for validation).

### `test_contains_instance`
#### Description
Tests the `contains_instance` function to check if a list contains an instance of a specified class.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| A | Class | A class to check for instances of. |
| B | Class | Another class for testing. |

#### Outputs
None (asserts are used for validation).

### `test_contains_instance_nested`
#### Description
Tests the `contains_instance` function with nested structures to check for instances of a specified class.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| A | Class | A class to check for instances of. |
| B | Class | Another class for testing. |

#### Outputs
None (asserts are used for validation).

### `test_contains_instance_recursive`
#### Description
Tests the `contains_instance` function with recursive structures to check for instances of a specified class.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| A | Class | A class to check for instances of. |
| value | Any | A recursive structure containing instances of `A`. |

#### Outputs
None (asserts are used for validation).

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `pytest` | Used for running the test suite and asserting expected outcomes. |

## Error Handling

The tests expect the `flatten` function to raise a `CyclicStructureError` when a cyclic structure is detected, ensuring that the function correctly identifies and handles such cases.

## Logging

No logging mechanisms are implemented in the test code.