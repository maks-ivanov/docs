---
title: "test_altair_chart.py"
---

## High-level description

The target file `test_altair_chart.py` contains unit tests for the `altair_chart` functionality within the Marimo library. These tests verify the behavior of Altair chart integration, specifically focusing on data filtering, chart operations, and configuration settings. The tests ensure that the Altair charts can be manipulated and queried correctly, and that they interact properly with the Marimo framework.

## Code Structure

The main symbols in the code are organized as follows:

- **Test Class `TestAltairChart`**: Contains methods to test various functionalities of the Altair chart integration.
- **Functions**: Standalone test functions outside the class to test specific operations on Altair charts.

## References

- **`DependencyManager`**: Used to check if the necessary dependencies (`pandas` and `altair`) are installed.
- **`altair_chart`**: The main functionality being tested, imported from `marimo._plugins.ui._impl.altair_chart`.
- **`Kernel`**: Used in asynchronous tests to simulate execution contexts.
- **`ExecReqProvider`**: A utility from `tests.conftest` to create execution requests for testing.
- **`snapshotter`**: A utility from `tests.mocks` to manage test snapshots.

## Symbols

### `TestAltairChart`
#### Description
A test class that contains methods to test the filtering and configuration of Altair charts within the Marimo framework.

#### Methods

- **`test_filter_dataframe`**: Tests the `_filter_dataframe` function to ensure it correctly filters data based on various selection criteria.
- **`test_filter_dataframe_with_dates`**: Similar to `test_filter_dataframe`, but specifically tests filtering with date fields.
- **`test_altair_settings_when_set`**: Asynchronously tests the configuration of Altair settings within a simulated kernel execution context.

#### Inputs
- **`k`**: An instance of `Kernel` used to simulate execution contexts.
- **`exec_req`**: An instance of `ExecReqProvider` to create execution requests.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

### `test_can_add_altair_chart`
#### Description
Tests the ability to add two Altair charts together and verifies that the operation does not result in errors.

#### Inputs
- None directly, but uses Altair chart objects.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

### `test_can_or_altair_chart`
#### Description
Tests the logical OR operation between two Altair charts to ensure it functions correctly.

#### Inputs
- None directly, but uses Altair chart objects.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

### `test_can_and_altair_chart`
#### Description
Tests the logical AND operation between two Altair charts to ensure it functions correctly.

#### Inputs
- None directly, but uses Altair chart objects.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

### `test_does_not_modify_original`
#### Description
Ensures that combining Altair charts does not modify the original charts.

#### Inputs
- None directly, but uses Altair chart objects.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

### `test_get_dataframe`
#### Description
Tests the retrieval of the underlying data from an Altair chart.

#### Inputs
- None directly, but uses Altair chart objects.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

### `test_get_dataframe_csv`
#### Description
Tests the retrieval of data from an Altair chart that uses a CSV data source.

#### Inputs
- None directly, but uses Altair chart objects.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

### `test_get_dataframe_json`
#### Description
Tests the retrieval of data from an Altair chart that uses a JSON data source.

#### Inputs
- None directly, but uses Altair chart objects.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

### `test_parse_spec_url`
#### Description
Tests the parsing of a Vega specification from an Altair chart using a URL data source.

#### Inputs
- None directly, but uses Altair chart objects.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

### `test_parse_spec_pandas`
#### Description
Tests the parsing of a Vega specification from an Altair chart using a Pandas DataFrame.

#### Inputs
- None directly, but uses Altair chart objects.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

### `test_parse_spec_narwhal`
#### Description
Tests the parsing of a Vega specification from an Altair chart using a Narwhal data source.

#### Inputs
- None directly, but uses Altair chart objects.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

### `test_parse_spec_geopandas`
#### Description
Tests the parsing of a Vega specification from an Altair chart using a GeoPandas data source.

#### Inputs
- None directly, but uses Altair chart objects.

#### Outputs
- None directly, but assertions are used to validate expected outcomes.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `pytest` | Used for writing and executing test cases. |
| `pandas` | Used for creating DataFrames in tests. |
| `altair` | Used for creating and manipulating charts in tests. |

## Error Handling

The tests use assertions to validate expected outcomes. If an assertion fails, it indicates a discrepancy between the expected and actual behavior of the code being tested.

## Logging

The `snapshotter` utility is used to manage test snapshots, which helps in verifying that the output of certain operations remains consistent over time. If the output changes, the snapshot is updated, and the test will fail, indicating a potential issue.