---
title: "test_file_router.py"
---

## High-level description

The `test_file_router.py` file contains unit tests for the `AppFileRouter` and its subclasses, which are part of a file routing system in the Marimo application. These tests verify the functionality of routing files and directories to appropriate file router classes, handling new files, and managing file lists with options for lazy loading and markdown inclusion.

## Code Structure

The main symbols in the code are the test class `TestAppFileRouter` and its methods. The test class uses the `unittest` framework to set up a temporary environment for testing various functionalities of the `AppFileRouter` and its subclasses. The tests cover different scenarios such as inferring file types, creating routers from files, handling new files, and managing file lists with lazy loading and markdown options.

## References

- `AppFileRouter`: The main class being tested, which provides methods for routing files and directories.
- `LazyListOfFilesAppFileRouter`, `ListOfFilesAppFileRouter`, `NewFileAppFileRouter`: Subclasses of `AppFileRouter` that implement specific routing strategies.
- `MarimoFile`: A data model representing a file, used in the tests to create file lists.

## Symbols

### `TestAppFileRouter`
#### Description
This class contains unit tests for the `AppFileRouter` and its subclasses. It uses the `unittest` framework to verify the correct behavior of file routing functionalities.

#### Inputs
- None directly, but it uses temporary files and directories created in the `setUp` method.

#### Outputs
- None directly, but it asserts the expected behavior of the `AppFileRouter` methods.

#### Internal Logic
- **setUp**: Creates a temporary directory and files for testing.
- **tearDown**: Cleans up the temporary files and directory after tests.
- **test_infer_file**: Tests the `infer` method with a file path, expecting a `ListOfFilesAppFileRouter`.
- **test_infer_directory**: Tests the `infer` method with a directory path, expecting a `LazyListOfFilesAppFileRouter`.
- **test_from_files**: Tests creating a router from a list of `MarimoFile` objects.
- **test_new_file_router**: Tests the creation of a `NewFileAppFileRouter`.
- **test_lazy_list_of_files**: Tests lazy loading of files in a directory without markdown.
- **test_lazy_list_with_broken_symlinks**: Tests lazy loading with broken symlinks in the directory.
- **test_lazy_list_with_markdown**: Tests lazy loading with markdown files included.
- **test_lazy_list_of_get_app_file_manager**: Tests retrieving a file manager for a specific file.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `unittest` | Provides the testing framework for writing and running tests. |
| `tempfile` | Used to create temporary files and directories for testing. |
| `os` | Used for file and directory operations. |
| `shutil` | Used for cleaning up temporary directories. |
| `marimo._server.file_router` | Contains the `AppFileRouter` and its subclasses being tested. |
| `marimo._server.models.home` | Provides the `MarimoFile` class used in tests. |

## Error Handling

The tests rely on assertions to verify expected outcomes. If an assertion fails, it indicates a discrepancy between the expected and actual behavior of the code being tested.

## Logging

The related `file_router.py` file uses logging to debug routing decisions, but the test file itself does not implement logging.

## TODOs

No TODOs or notes are present in the code.