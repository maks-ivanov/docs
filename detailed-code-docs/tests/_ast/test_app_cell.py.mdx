---
title: "test_app_cell.py"
---

## High-level description

The target file `tests/_ast/test_app_cell.py` contains unit tests for the `App` class from the `marimo._ast.app` module. These tests focus on the functionality of the `cell` decorator method within the `App` class, which is used to register functions as cells in a dataflow graph. The tests verify that the decorator correctly registers functions, handles arguments, and executes both synchronous and asynchronous functions as expected.

## Code Structure

The main symbols in the code are the test functions, each of which tests a specific aspect of the `cell` decorator functionality. These functions create an instance of the `App` class, use the `cell` decorator to register a function, and then assert various properties of the resulting cell object.

## References

- `App`: The class from `marimo._ast.app` that is being tested. It provides the `cell` decorator method.
- `Cell`: A class that represents a unit of computation in the `App` dataflow graph.
- `Awaitable`: Used in the asynchronous test to verify that the result of an async cell is an awaitable object.

## Symbols

### `test_decorator_called`
#### Description
Tests the `cell` decorator when it is called with a function. It verifies that the function is registered as a cell and that the cell's properties and execution results are as expected.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | None | This function does not take any inputs. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | None | This function does not return any outputs. |

#### Internal Logic
- Defines a mock function `mock_func1`.
- Creates an `App` instance and registers `mock_func1` using the `cell` decorator.
- Asserts that the cell is not `None`, checks the cell's code, configuration, name, and execution result.

### `test_decorator_uncalled`
#### Description
Tests the `cell` decorator when it is used without being called (i.e., without parentheses). It checks that the function is registered correctly and that the cell's properties and execution results are correct.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | None | This function does not take any inputs. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | None | This function does not return any outputs. |

#### Internal Logic
- Defines a mock function `__`.
- Creates an `App` instance and registers `__` using the `cell` decorator without calling it.
- Asserts that the cell is not `None`, checks the cell's code, configuration, name, and execution result.

### `test_decorator_with_args`
#### Description
Tests the `cell` decorator with additional arguments, specifically the `disabled` argument. It verifies that the cell is registered with the correct configuration and that it executes correctly.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | None | This function does not take any inputs. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | None | This function does not return any outputs. |

#### Internal Logic
- Defines a mock function `mock_func3` that takes an argument.
- Creates an `App` instance and registers `mock_func3` using the `cell` decorator with the `disabled` argument set to `True`.
- Asserts that the cell is not `None`, checks the cell's code, configuration, name, and execution result with an argument.

### `test_decorator_with_unknown_args`
#### Description
Tests the `cell` decorator with unknown arguments to ensure that it handles them gracefully without affecting the cell registration and execution.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | None | This function does not take any inputs. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | None | This function does not return any outputs. |

#### Internal Logic
- Defines a mock function `__`.
- Creates an `App` instance and registers `__` using the `cell` decorator with an unknown argument `foo`.
- Asserts that the cell is not `None`, checks the cell's code, configuration, name, and execution result.

### `test_decorator_async`
#### Description
Tests the `cell` decorator with an asynchronous function to ensure that it registers and executes correctly, returning an awaitable result.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | None | This function does not take any inputs. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | None | This function does not return any outputs. |

#### Internal Logic
- Defines an asynchronous mock function `__`.
- Creates an `App` instance and registers `__` using the `cell` decorator.
- Asserts that the cell is not `None`, checks if the cell is a coroutine, verifies the cell's configuration, name, and execution result using `await`.

## Side Effects

- The tests modify the state of the `App` instance by registering cells.

## TODOs

- There is a TODO comment indicating the need to test `cell.run()` with multiple cells in a graph and outputs.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `marimo._ast.app` | Provides the `App` class that is being tested. |
| `collections.abc.Awaitable` | Used to verify that the result of an async cell is an awaitable object. |

## Error Handling

- The tests assume that the `App` class and its methods handle errors internally, as there is no explicit error handling in the test functions.

## Logging

- There is no logging implemented in the test functions.