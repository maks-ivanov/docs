---
title: "runner_test.go"
---

## High-level description
This file contains unit tests for a GPTScript runner implementation. It tests various aspects of the runner, including chat functionality, tool calls, error handling, and runtime environments.

## Code Structure
The file consists of multiple test functions, each testing different aspects of the GPTScript runner. These tests use the `tester.NewRunner` to create a test runner and simulate various scenarios.

## Symbols

### `TestAsterick`
#### Description
Tests the loading and parsing of GPTScript files, particularly focusing on the asterisk wildcard in tool references.

#### Internal Logic
1. Loads a GPTScript file
2. Checks the parsed structure against an expected JSON output
3. Simulates a run and checks for errors

### `TestDualSubChat`
#### Description
Tests the behavior of the chat system when dealing with multiple sub-chats.

#### Internal Logic
1. Simulates multiple chat interactions
2. Checks the responses and state at each step
3. Verifies the chat completion behavior

### `TestContextSubChat`
#### Description
Tests the behavior of context-aware sub-chats within the main chat flow.

#### Internal Logic
1. Simulates a series of chat interactions with context switches
2. Verifies the responses and state changes at each step

### `TestSubChat`
#### Description
Tests the basic functionality of sub-chats within the main chat flow.

#### Internal Logic
1. Simulates a chat interaction with a sub-chat
2. Verifies the response content and state

### `TestChat`
#### Description
Tests the basic chat functionality of the GPTScript runner.

#### Internal Logic
1. Simulates a simple chat interaction
2. Verifies the response content and state

### `TestChatRunNoError`
#### Description
Tests that a basic chat run completes without errors.

### `TestExportContext`
#### Description
Tests the context exporting functionality of the runner.

### `TestContext`
#### Description
Tests the context handling of the runner.

### `TestCase` and `TestCase2`
#### Description
Basic test cases for the runner's functionality.

### `TestGlobalErr`
#### Description
Tests error handling for global model name and tool declarations.

### `TestContextArg`
#### Description
Tests the runner's handling of context arguments.

### `TestToolAs`
#### Description
Tests the "as" functionality for tool references.

### `TestCwd`
#### Description
Tests the current working directory handling in the runner.

### `TestExport`
#### Description
Tests the export functionality of the runner.

### `TestAgentOnly`
#### Description
Tests the behavior when only an agent is present in the script.

### `TestAgents`
#### Description
Tests the handling of multiple agents in the script.

### `TestMissingTool`
#### Description
Tests the runner's behavior when a referenced tool is missing.

### `TestToolRefAll`
#### Description
Tests the "all" keyword in tool references.

### `TestRuntimes`
#### Description
Tests the runner's handling of different runtime environments (Python, Node.js, Bash).

### `TestRuntimesLocalDev`
#### Description
Tests the runner's handling of local development environments for different runtimes.

## Dependencies
- `github.com/gptscript-ai/gptscript/pkg/engine`
- `github.com/gptscript-ai/gptscript/pkg/tests/tester`
- `github.com/gptscript-ai/gptscript/pkg/types`
- `github.com/hexops/autogold/v2`
- `github.com/stretchr/testify/assert`
- `github.com/stretchr/testify/require`

## Error Handling
The tests use `require.NoError` to ensure that no unexpected errors occur during test execution. Some tests specifically check for expected error conditions.

## Logging
The tests use the `autogold` library to compare test outputs against expected results, which serves as a form of logging and verification.