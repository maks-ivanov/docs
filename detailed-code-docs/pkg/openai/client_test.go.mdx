---
title: "client_test.go"
---

## High-level description
This file contains a unit test for the `appendMessage` function in the `openai` package. The test verifies that the function correctly appends tool calls from an OpenAI chat completion stream response to a completion message.

## Symbols

### `Test_appendMessage`
#### Description
This function is a unit test for the `appendMessage` function. It uses the `autogold` library to compare the expected output with the actual output of the `appendMessage` function.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| t | *testing.T | The testing object provided by Go's testing framework |

#### Internal Logic
1. Define the expected output using `autogold.Expect()`.
2. Call the `appendMessage()` function with an empty `types.CompletionMessage` and a sample `openai.ChatCompletionStreamResponse`.
3. Compare the result with the expected output using `Equal()`.

The test checks if the `appendMessage` function correctly converts the `openai.ChatCompletionStreamResponse` to a `types.CompletionMessage` with the appropriate tool calls.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| testing | Go's standard testing framework |
| github.com/gptscript-ai/chat-completion-client | Provides OpenAI chat completion client types |
| github.com/gptscript-ai/gptscript/pkg/types | Provides custom types for the gptscript project |
| github.com/hexops/autogold/v2 | Used for creating and comparing test expectations |
| github.com/hexops/valast | Used for creating pointers to values in the test |

## References
The test references the following symbols that are not defined in this file:
- `appendMessage`: The function being tested, which is likely defined in another file in the `openai` package.
- `types.CompletionMessage`: A custom type used for representing completion messages.
- `types.ContentPart`: A custom type used for representing parts of a completion message's content.
- `types.CompletionToolCall`: A custom type used for representing tool calls in a completion message.
- `types.CompletionFunctionCall`: A custom type used for representing function calls within tool calls.
- `openai.ChatCompletionStreamResponse`: A type from the OpenAI client library representing a stream response.
- `openai.ChatCompletionStreamChoice`: A type from the OpenAI client library representing a choice in a stream response.
- `openai.ChatCompletionStreamChoiceDelta`: A type from the OpenAI client library representing a delta in a stream choice.
- `openai.ToolCall`: A type from the OpenAI client library representing a tool call.
- `openai.FunctionCall`: A type from the OpenAI client library representing a function call.

This test file focuses on ensuring that the `appendMessage` function correctly translates the OpenAI client library types into the custom types used in the gptscript project, particularly for tool calls and function calls within those tool calls.