---
title: "rust-tests.yml"
---

## High-level description
This GitHub Actions workflow defines a series of jobs to run the Rust test suite, perform code formatting checks with `cargo fmt`, run static analysis with `clippy`, and generate and lint OpenAPI documentation using `redoc`. It leverages caching for faster build times and runs on the `blacksmith` runner.

## Table of contents
- cargo-fmt
- clippy_check
- redoc

## References
This workflow references the following external actions:
- `actions/checkout@v4`
- `useblacksmith/cache@v5`
- `clechasseur/rs-clippy-check@v3`

## Symbols
### `cargo-fmt`
#### Description
This job ensures code formatting consistency by running `cargo fmt` in check mode. It only runs when files within the `server` directory are modified.

#### Inputs
None

#### Outputs
None

#### Internal Logic
1. Checks out the repository using `actions/checkout@v4`.
2. Updates the Rust toolchain to the latest stable version.
3. Executes `cargo fmt` with the `--check` flag to validate code formatting against the project's style guidelines.

### `clippy_check`
#### Description
This job performs static analysis on the Rust codebase using `clippy`. It utilizes caching to speed up dependency resolution and runs on a more powerful runner with 8 vCPUs.

#### Inputs
None

#### Outputs
None

#### Internal Logic
1. Checks out the repository using `actions/checkout@v4`.
2. Restores the Cargo cache using `useblacksmith/cache@v5` based on the OS and a hash of the `Cargo.lock` file.
3. Installs the `clippy` component for Rust.
4. Updates the Rust toolchain to the latest stable version.
5. Runs `clippy` using the `clechasseur/rs-clippy-check@v3` action with specific arguments to enable runtime environment features, specify the manifest path, and configure output and warning settings.
6. Caches the Cargo registry and target directory using `useblacksmith/cache@v5`.

### `redoc`
#### Description
This job generates an OpenAPI specification from the code and then lints it using `vacuum`. It also utilizes caching for faster dependency resolution and runs on a more powerful runner with 8 vCPUs.

#### Inputs
None

#### Outputs
None

#### Internal Logic
1. Checks out the repository using `actions/checkout@v4`.
2. Restores the Cargo cache using `useblacksmith/cache@v5` based on the OS and a hash of the `Cargo.lock` file.
3. Updates the Rust toolchain to the latest stable version.
4. Installs the `vacuum` package globally using `npm`.
5. Executes `cargo run` to generate the OpenAPI specification in JSON format and redirects the output to `openapi.json`.
6. Runs `vacuum lint` to check the generated `openapi.json` file against the rules defined in `.github/rules.yaml`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| actions/checkout@v4 | Checks out the repository |
| useblacksmith/cache@v5 | Caches dependencies to speed up builds |
| clechasseur/rs-clippy-check@v3 | Runs `clippy` for static analysis |
| @quobix/vacuum | Lints OpenAPI specifications |
