---
title: "SimpleFitSubcloneSimulator.py"
---

## High-level description

The `SimpleFitSubcloneSimulator` class in the `SimpleFitSubcloneSimulator.py` file is a specialized simulator for generating phylogenetic trees that model the evolution of a clonal population with a single fit subclone. This simulator extends the `TreeSimulator` abstract class and provides functionality to simulate both deterministic and stochastic phylogenies by controlling the branch lengths of neutrally evolving populations and fit subpopulations. The simulation is characterized by a neutral phase followed by the emergence of a fit subclone, allowing for the study of evolutionary dynamics in a controlled setting.

## Code Structure

- The `SimpleFitSubcloneSimulator` class inherits from the `TreeSimulator` abstract class.
- It uses the `networkx` library to construct and manipulate the phylogenetic tree as a directed graph.
- The class relies on the `CassiopeiaTree` class from the `cassiopeia.data` module to represent the resulting tree structure.

## References

- `TreeSimulator`: The abstract base class that `SimpleFitSubcloneSimulator` extends.
- `CassiopeiaTree`: A class used to represent the tree structure generated by the simulator.

## Symbols

### `SimpleFitSubcloneSimulator`
#### Description
The `SimpleFitSubcloneSimulator` class simulates a clonal population that evolves neutrally until a specified generation, at which point a fit subclone emerges and expands with a different branch length. This class allows for the simulation of both deterministic and stochastic phylogenies by accepting either constant values or callables for branch lengths.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| branch_length_neutral | Union[float, Callable[[], float]] | Branch length for neutrally evolving individuals. Can be a constant or a callable for stochastic simulations. |
| branch_length_fit | Union[float, Callable[[], float]] | Branch length for the fit subclone. Can be a constant or a callable for stochastic simulations. |
| experiment_duration | float | Total duration of the experiment. |
| generations_until_fit_subclone | int | Generation at which the fit subclone emerges. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| output | CassiopeiaTree | A tree representing the simulated clonal population with a fit subclone. |

#### Internal Logic
1. **Initialization**: Converts the branch length inputs into callables if they are not already, ensuring consistent handling of both constant and stochastic branch lengths.
2. **Tree Simulation**: 
   - Initializes a directed graph to represent the tree.
   - Uses a queue to manage nodes during the simulation, starting with a root node.
   - Iteratively processes each node, determining the time until division based on its fitness status and the corresponding branch length.
   - Adds child nodes to the tree, updating their fitness status and generation count.
   - Stops adding new nodes when the experiment duration is reached.
3. **Result Construction**: Constructs a `CassiopeiaTree` from the graph and sets the node times based on the simulation.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| `networkx` | Used to create and manipulate the tree as a directed graph. |
| `queue.Queue` | Utilized for managing nodes during the simulation process. |

## Error Handling

The class does not explicitly handle errors beyond basic type checking and assumes valid input parameters. It relies on the underlying libraries (`networkx`, `queue`) to manage any exceptions related to graph operations or queue management.

## Logging

The code does not implement any logging mechanisms. It is designed to be used in a controlled environment where the user can directly observe the output or use additional tools for debugging and analysis.

## TODOs

There are no TODOs or notes left in the code.