---
title: "BrownianSpatialDataSimulator.py"
---

## High-level description

The `BrownianSpatialDataSimulator` class is a specialized simulator that extends the `SpatialDataSimulator` class to simulate spatial coordinates for cells in a `CassiopeiaTree` using a Brownian motion process. This involves traversing the tree from the root to the leaves and assigning spatial coordinates to each cell based on a diffusion model, which is influenced by a diffusion coefficient and the time since the last cell division.

## Code Structure

The `BrownianSpatialDataSimulator` class inherits from the `SpatialDataSimulator` class, which in turn is a subclass of `DataSimulator`. The main functionality of the `BrownianSpatialDataSimulator` is implemented in its `overlay_data` method, which overlays spatial data onto a `CassiopeiaTree` by simulating Brownian motion. The class also includes an initializer to set up simulation parameters such as the number of dimensions, diffusion coefficient, and whether to scale the spatial coordinates to a unit area.

## References

- `CassiopeiaTree`: Used to represent the tree structure on which spatial data is overlaid.
- `DataSimulatorError`: An exception class used to handle errors specific to data simulation.
- `SpatialDataSimulator`: The abstract base class that `BrownianSpatialDataSimulator` extends.

## Symbols

### `BrownianSpatialDataSimulator`
#### Description
The `BrownianSpatialDataSimulator` class simulates spatial data for a `CassiopeiaTree` using a Brownian motion model. It calculates spatial coordinates for each cell by traversing the tree and applying a diffusion process, which is parameterized by the number of dimensions, diffusion coefficient, and other optional settings.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| dim | int | Number of spatial dimensions for the simulation. |
| diffusion_coefficient | float | Coefficient that determines the variance of the Brownian motion. |
| scale_unit_area | bool | Whether to scale the spatial coordinates to a unit area. Defaults to `True`. |
| random_seed | Optional[int] | Seed for random number generation to ensure reproducibility. |

#### Outputs
The class does not return outputs directly but modifies the `CassiopeiaTree` by setting spatial attributes.

#### Internal Logic
- **Initialization**: Validates input parameters and initializes instance variables.
- **overlay_data**: 
  - Sets the random seed if provided.
  - Initializes the root node at the origin.
  - Traverses the tree using depth-first traversal to calculate new spatial coordinates for each child node based on the parent's coordinates and a normally distributed random vector.
  - Optionally scales the coordinates to fit within a unit area.
  - Updates the `CassiopeiaTree` with the calculated spatial coordinates, both as node attributes and in the `cell_meta` DataFrame.

## Side Effects
- Modifies the `CassiopeiaTree` by setting spatial attributes for each node and updating the `cell_meta` DataFrame with the new spatial coordinates.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| numpy | Used for numerical operations and random number generation. |
| pandas | Used for handling the `cell_meta` DataFrame in the `CassiopeiaTree`. |

## Error Handling
- Raises `DataSimulatorError` if the number of dimensions is less than or equal to zero or if the diffusion coefficient is negative.

## Logging
No explicit logging is implemented in the code.

## TODOs
No TODOs are present in the code.