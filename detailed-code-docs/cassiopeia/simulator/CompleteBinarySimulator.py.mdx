---
title: "CompleteBinarySimulator.py"
---

## High-level description

The `CompleteBinarySimulator` class in the `CompleteBinarySimulator.py` file is a specialized tree simulator that generates complete binary trees. It inherits from the abstract `TreeSimulator` class and provides functionality to simulate a perfectly balanced binary tree with a specified number of cells or depth. The simulator ensures that the tree is balanced and that all branches have equal length, normalized by the height of the tree.

## Code Structure

The `CompleteBinarySimulator` class is the main symbol in this file, inheriting from the `TreeSimulator` abstract class. It uses the `networkx` library to generate the tree structure and the `CassiopeiaTree` class to represent the tree. The class relies on the `TreeSimulatorError` for error handling.

## References

- `TreeSimulator`: The abstract base class from which `CompleteBinarySimulator` inherits.
- `CassiopeiaTree`: A class used to represent the tree structure.
- `TreeSimulatorError`: An exception class used for error handling.

## Symbols

### `CompleteBinarySimulator`
#### Description
The `CompleteBinarySimulator` class simulates a complete binary tree. It uses the `networkx` library to create a balanced binary tree and the `CassiopeiaTree` class to represent the tree. The class ensures that the tree is perfectly balanced, with all branches having equal length normalized by the tree's height.

#### Inputs
| Name      | Type   | Description                                                                 |
|:----------|:-------|:----------------------------------------------------------------------------|
| num_cells | int    | Number of cells to simulate. Must be a power of 2.                          |
| depth     | int    | Depth of the tree. The number of cells will be `2^depth`.                   |

#### Outputs
| Name | Type            | Description                                      |
|:-----|:----------------|:-------------------------------------------------|
| tree | CassiopeiaTree  | A tree with the simulated complete binary topology. |

#### Internal Logic
- **Initialization**: Validates inputs to ensure either `num_cells` or `depth` is provided, and that `num_cells` is a power of 2 if specified. It calculates the depth if `num_cells` is provided.
- **Tree Simulation**: Uses `networkx.balanced_tree` to generate a balanced binary tree. It assigns unique node names using a generator and initializes branch lengths to ensure the tree has a height of 1.

## Side Effects
- Modifies the internal state of the `CassiopeiaTree` by setting node times and branch lengths.

## Dependencies
| Dependency | Purpose                                                                 |
|:-----------|:------------------------------------------------------------------------|
| networkx   | Used to generate the balanced binary tree structure.                    |
| numpy      | Used for mathematical operations, such as calculating logarithms.       |

## Error Handling
The class raises `TreeSimulatorError` in the following cases:
- If neither or both `num_cells` and `depth` are provided.
- If `num_cells` is not a power of 2.
- If the calculated depth is not greater than 0.

## Logging
No explicit logging mechanisms are implemented in this code.

## TODOs
No TODOs are present in the code.