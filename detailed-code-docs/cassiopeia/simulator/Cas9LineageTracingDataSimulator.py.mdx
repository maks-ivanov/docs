---
title: "Cas9LineageTracingDataSimulator.py"
---

## High-level description

The `Cas9LineageTracingDataSimulator` class is a specialized simulator for generating lineage tracing data based on Cas9 technology. It extends the `LineageTracingDataSimulator` class and is designed to simulate the mutations and silencing events that occur in Cas9-based lineage tracing experiments. The simulator overlays these events onto a `CassiopeiaTree`, modifying the character states of the tree's nodes to reflect the simulated lineage tracing data.

## Code Structure

The main class in this file is `Cas9LineageTracingDataSimulator`, which inherits from `LineageTracingDataSimulator`. This class is responsible for simulating the Cas9-based lineage tracing data and overlaying it onto a `CassiopeiaTree`. The class uses several parameters to control the simulation, such as the number of cassettes, size of each cassette, mutation rates, and silencing rates. The `overlay_data` method is the primary function that applies the simulation to a given tree.

## References

- `CassiopeiaTree`: A data structure used to represent the tree onto which the lineage tracing data is overlaid.
- `DataSimulatorError`: An exception class used to handle errors specific to data simulation.
- `LineageTracingDataSimulator`: The abstract base class from which `Cas9LineageTracingDataSimulator` inherits.

## Symbols

### `Cas9LineageTracingDataSimulator`
#### Description
The `Cas9LineageTracingDataSimulator` class simulates Cas9-based lineage tracing data by overlaying mutations and silencing events onto a `CassiopeiaTree`. It models the cutting process of Cas9 as an exponential process and allows for the configuration of various parameters such as mutation rates, cassette architecture, and silencing rates.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| number_of_cassettes | int | Number of cassettes in the simulation. |
| size_of_cassette | int | Number of editable target sites per cassette. |
| mutation_rate | Union[float, List[float]] | Exponential parameter for the Cas9 cutting rate. |
| state_generating_distribution | Callable | Distribution function for simulating state likelihoods. |
| number_of_states | int | Number of states to simulate. |
| state_priors | Optional[Dict[int, float]] | Prior probabilities for states. |
| heritable_silencing_rate | float | Rate of heritable silencing events. |
| stochastic_silencing_rate | float | Rate of stochastic dropout events. |
| heritable_missing_data_state | int | Indicator for heritable missing data. |
| stochastic_missing_data_state | int | Indicator for stochastic missing data. |
| random_seed | Optional[int] | Seed for random number generation. |
| collapse_sites_on_cassette | bool | Whether to collapse cuts on the same cassette. |

#### Outputs
None. The class modifies the input `CassiopeiaTree` in place.

#### Internal Logic
- **Initialization**: Validates input parameters and sets up internal state variables.
- **overlay_data**: Applies the simulation to a `CassiopeiaTree`, modifying its character states based on the configured parameters.
- **collapse_sites**: Collapses cuts that occur within the same cassette.
- **introduce_states**: Introduces new states at cut sites based on mutation priors.
- **silence_cassettes**: Silences cassettes based on the specified silencing rate.
- **get_cassettes**: Returns the indices of individual cassettes.

## Side Effects
- Modifies the character states of nodes in the `CassiopeiaTree` passed to the `overlay_data` method.

## Dependencies

| Dependency | Purpose |
|:-----------|:--------|
| numpy | Used for numerical operations and random number generation. |

## Error Handling
- The class raises `DataSimulatorError` for various invalid input conditions, such as non-positive numbers of cassettes or invalid mutation rates.

## Logging
No explicit logging is implemented in this code.

## TODOs
None.