---
title: "__init__.py"
---

## High-level description

The `cassiopeia/data/__init__.py` file serves as the top-level module for the data-related components of the Cassiopeia library. It primarily imports and exposes key classes and utility functions that are used for handling phylogenetic trees and related data structures. The main class imported is `CassiopeiaTree`, which is a core data structure for representing and manipulating phylogenetic trees. Additionally, several utility functions are imported to perform operations such as computing dissimilarity maps, phylogenetic weight matrices, and converting tree structures to Newick format.

## Code Structure

The code structure in this file is straightforward, consisting of import statements that bring in classes and functions from other modules within the `cassiopeia.data` package. The `CassiopeiaTree` class is imported from the `CassiopeiaTree.py` file, while various utility functions are imported from the `utilities.py` file. These imports make the functionalities available at the package level, allowing users to access them directly when they import the `cassiopeia.data` package.

## References

The `cassiopeia/data/__init__.py` file references the following symbols from other parts of the codebase:

- `CassiopeiaTree`: A class from `CassiopeiaTree.py` that represents a phylogenetic tree and provides methods for tree manipulation and analysis.
- Utility functions from `utilities.py`:
  - `compute_dissimilarity_map`
  - `compute_inter_cluster_distances`
  - `compute_phylogenetic_weight_matrix`
  - `get_lca_characters`
  - `net_relatedness_index`
  - `sample_bootstrap_allele_tables`
  - `sample_bootstrap_character_matrices`
  - `to_newick`

## Symbols

### `CassiopeiaTree`
#### Description
The `CassiopeiaTree` class is a fundamental data structure for representing phylogenetic trees in the Cassiopeia library. It stores information about the tree topology, character matrices, and metadata associated with lineage tracing experiments. The class provides methods for tree manipulation, such as adding or removing nodes, setting character states, and computing distances between nodes.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| character_matrix | Optional[pd.DataFrame] | The character matrix for the lineage. |
| missing_state_indicator | int | An indicator for missing states in the character matrix. |
| cell_meta | Optional[pd.DataFrame] | Per-cell metadata. |
| character_meta | Optional[pd.DataFrame] | Per-character metadata. |
| priors | Optional[Dict[int, Dict[int, float]]] | A dictionary storing the probability of each character mutating to a particular state. |
| tree | Optional[Union[str, ete3.Tree, nx.DiGraph]] | A tree for the lineage. |
| dissimilarity_map | Optional[pd.DataFrame] | An NxN dataframe storing the pairwise dissimilarities between samples. |
| root_sample_name | Optional[str] | The name of the sample to treat as the root. |

#### Outputs
The class itself does not have direct outputs but provides methods that return various data related to the tree, such as node lists, distances, and character states.

#### Internal Logic
The `CassiopeiaTree` class uses a combination of internal attributes and methods to manage the tree structure and associated data. It leverages libraries like `networkx` for graph representation and `pandas` for data manipulation. The class includes methods for initializing the tree, setting and retrieving character states, computing distances, and converting the tree to different formats.

## Dependencies

The `cassiopeia/data/__init__.py` file relies on the following external libraries:

| Dependency | Purpose |
|:-----------|:--------|
| ete3 | Used for tree manipulation and conversion between formats. |
| networkx | Provides graph data structures and algorithms for tree representation. |
| numpy | Used for numerical operations and data manipulation. |
| pandas | Utilized for handling data frames and tabular data. |
| scipy | Provides scientific computing functions, including distance calculations. |

## Error Handling

The `CassiopeiaTree` class and utility functions include error handling mechanisms to manage invalid inputs and operations. For example, the class raises `CassiopeiaTreeError` if the tree is not initialized or if operations are attempted on non-existent nodes. The utility functions also include checks for input validity and raise warnings or errors as needed.

## Logging

The code does not explicitly implement logging mechanisms. However, it uses warnings to notify users of potential issues, such as when failing to numbaize a function or when input data does not match expected formats.

## TODOs

The `CassiopeiaTree` class includes several TODO comments indicating planned enhancements, such as adding checks for valid tree structures upon initialization, incorporating experimental metadata, and implementing additional utility methods for tree analysis.