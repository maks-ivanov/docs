---
title: "Layers.py"
---

## High-level description

The `Layers.py` file defines a `Layers` class, which is a specialized data structure used within the `CassiopeiaTree` object to manage multiple versions of character matrices. These matrices represent different states of mutation data for cells, which can be useful in simulations or experiments involving imputation of missing data. The `Layers` class behaves like a dictionary, allowing users to store, retrieve, and delete character matrices using standard dictionary operations.

## Code Structure

The `Layers` class is designed to be used within the `CassiopeiaTree` class, as seen in the related `CassiopeiaTree.py` file. The `Layers` class is initialized with a reference to a `CassiopeiaTree` object, ensuring that the character matrices stored in the layers are consistent with the tree's structure. The `Layers` class provides methods for managing these matrices, including validation to ensure that the matrices have the correct shape.

## Symbols

### `Layers`
#### Description
The `Layers` class is a dictionary-like data structure that manages multiple character matrices for a `CassiopeiaTree` object. It allows for storing different versions of mutation data, which can be useful for simulations and experiments. The class ensures that each matrix has the correct number of samples, matching the number of cells in the associated `CassiopeiaTree`.

#### Inputs
| Name   | Type            | Description                                                                 |
|:-------|:----------------|:----------------------------------------------------------------------------|
| parent | CassiopeiaTree  | The `CassiopeiaTree` object to which the layers belong.                     |
| layers | Optional[Mapping] | An optional initial mapping of layer names to character matrices.         |

#### Outputs
The `Layers` class does not have a direct output, but it manages a collection of character matrices that can be accessed, modified, or deleted using dictionary-like operations.

#### Internal Logic
- **Initialization**: The constructor initializes the `Layers` object with a reference to a `CassiopeiaTree` and an optional initial set of layers. It sets up an internal dictionary to store the character matrices.
- **Validation**: The `_validate_value` method ensures that any matrix added to the layers has the correct number of rows, matching the number of cells in the `CassiopeiaTree`.
- **Dictionary Operations**: The class overrides standard dictionary methods (`__getitem__`, `__setitem__`, `__delitem__`, etc.) to manage the internal storage of character matrices.

## References

- **CassiopeiaTree**: The `Layers` class is tightly integrated with the `CassiopeiaTree` class, as it requires a reference to a `CassiopeiaTree` object to ensure that the character matrices are consistent with the tree's structure.

## Dependencies

| Dependency | Purpose                                                                 |
|:-----------|:------------------------------------------------------------------------|
| pandas     | Used for handling character matrices, which are stored as `pandas.DataFrame` objects. |

## Error Handling

The `Layers` class includes error handling to ensure that character matrices have the correct shape. If a matrix does not have the same number of rows as the number of cells in the `CassiopeiaTree`, a `ValueError` is raised with a descriptive message.

## Logging

The `Layers` class does not implement any logging mechanisms.

## TODOs

There are no TODOs or notes left in the `Layers.py` file.