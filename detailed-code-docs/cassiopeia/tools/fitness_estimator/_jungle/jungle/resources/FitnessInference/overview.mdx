---
title: "Overview"
---

## High-level description

The `FitnessInference` directory is part of a larger project focused on predicting evolutionary fitness from the shape of genealogical trees. It contains scripts and modules that implement algorithms for fitness inference, sequence ranking, and analysis of phylogenetic data. The main components include:

- **Fitness Inference Scripts**: These scripts perform fitness inference and sequence ranking using phylogenetic trees and sequence alignments.
- **Prediction Source Code**: A collection of modules that provide the core functionality for fitness estimation, ancestral sequence reconstruction, and phylogenetic tree manipulation.
- **Data Analysis and Simulation**: Directories and scripts for analyzing historical influenza data and simulating adapting populations.

## What does it do?

The code in this directory is designed to analyze evolutionary data and make predictions about the fitness of different sequences or nodes within a phylogenetic tree. Here's a simplified explanation of the processes:

1. **Fitness Inference**: The scripts infer the fitness of nodes in a phylogenetic tree by propagating fitness values up and down the tree. This involves calculating the posterior fitness distribution, mean fitness, and variance for each node, helping to understand how fitness changes over evolutionary time.

2. **Sequence Ranking**: Nodes and sequences are ranked based on various fitness-related metrics, such as mean posterior fitness and branch length. This ranking helps identify the most evolutionarily significant nodes or sequences.

3. **Ancestral Sequence Estimation**: Given a phylogenetic tree and sequence alignment, the code estimates the most likely sequences of ancestral nodes. This involves calculating the probabilities of different character states at each node and determining the most likely ancestral sequences.

4. **Data Analysis and Simulation**: The directory includes tools for analyzing historical influenza data and simulating adapting populations, providing insights into evolutionary dynamics and fitness landscapes.

Overall, the directory provides a comprehensive toolkit for analyzing evolutionary data, estimating ancestral sequences, inferring fitness, and ranking nodes or sequences based on evolutionary significance.

## Entry points

The main entry points in this directory are the scripts `rank_sequences.py` and `infer_fitness.py`. These scripts are designed to be run from the command line and perform specific tasks related to fitness inference and sequence ranking.

- **`rank_sequences.py`**: This script ranks sequences in a multiple sequence alignment using the local branching index (LBI). It takes an alignment file and an outgroup sequence as input and outputs a ranking of sequences, inferred ancestral sequences, and a reconstructed tree.

- **`infer_fitness.py`**: This script performs full fitness inference on sequences within a multiple sequence alignment. It calculates the mean posterior and variance of the posterior for each sequence, providing a more detailed analysis of fitness distribution.

Both scripts use command-line arguments to specify input files and parameters, and they output results to a directory named with the current date and time.

## Key Files

- **`prediction_src`**: This directory contains the core modules for fitness estimation, ancestral sequence reconstruction, and phylogenetic tree manipulation. It includes tools for estimating ancestral sequences, inferring fitness values, ranking nodes and sequences, and visualizing phylogenetic trees.

- **`flu`**: This directory contains code specific to the analysis of historical influenza data, including scripts for generating figures, analyzing sequences, and producing results.

- **`toy_data`**: This directory includes code for simulating adapting populations using the FFPopSim library, as well as scripts for analyzing simulated data and generating figures.

## Dependencies

The directory relies on several external libraries and frameworks to perform its functions:

- **`argparse`**: Used for parsing command-line arguments in the scripts.
- **`matplotlib`**: Utilized for plotting graphs and visualizing phylogenetic trees.
- **`numpy`**: Employed for numerical operations, such as calculating square roots and handling arrays.
- **`Bio` (from Biopython)**: Provides tools for handling sequence alignments and phylogenetic trees.
- **`tree_utils`**: Contains utility functions for plotting prediction trees.
- **`sequence_ranking`**: A module used for performing fitness prediction and ranking of sequences.

These dependencies are chosen for their ability to handle complex biological data and perform computationally intensive tasks efficiently.