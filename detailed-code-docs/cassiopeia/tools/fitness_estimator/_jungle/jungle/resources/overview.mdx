---
title: "Overview"
---

## High-level description

The `FitnessInference` and `betatree` directories are part of a larger project focused on evolutionary biology, specifically in predicting evolutionary fitness and simulating genetic diversity through phylogenetic and coalescent models. The `FitnessInference` directory is dedicated to predicting evolutionary fitness from genealogical trees, while the `betatree` directory focuses on simulating beta coalescent trees and calculating their Site Frequency Spectrum (SFS). Together, these directories provide tools for fitness inference, sequence ranking, ancestral sequence reconstruction, and the simulation of genetic diversity.

## What does it do?

The code in these directories is designed to analyze evolutionary data and simulate genetic processes:

1. **Fitness Inference and Sequence Ranking**: The `FitnessInference` directory contains scripts that infer the fitness of nodes in a phylogenetic tree by calculating the posterior fitness distribution, mean fitness, and variance for each node. It ranks nodes and sequences based on fitness-related metrics, helping identify evolutionarily significant nodes or sequences. Additionally, it estimates the most likely sequences of ancestral nodes given a phylogenetic tree and sequence alignment.

2. **Data Analysis and Simulation**: The `FitnessInference` directory also includes tools for analyzing historical influenza data and simulating adapting populations, providing insights into evolutionary dynamics and fitness landscapes.

3. **Beta Coalescent Tree Simulation**: The `betatree` directory simulates the ancestry of a sample of individuals using beta coalescent trees, which model how lineages merge over time. This simulation is controlled by a parameter called `alpha`, which influences the coalescent process.

4. **Site Frequency Spectrum Calculation**: After generating the beta coalescent trees, the code calculates the Site Frequency Spectrum (SFS), summarizing the genetic variation within the sample. The SFS provides insights into the evolutionary history and demographic events that have shaped the genetic diversity of the population.

5. **Visualization**: Both directories include functionality to visualize phylogenetic trees, coalescent trees, and the SFS, allowing users to see the results of the simulations and analyses.

## Entry points

The main entry points in the `FitnessInference` directory are the scripts `rank_sequences.py` and `infer_fitness.py`:

- **`rank_sequences.py`**: This script ranks sequences in a multiple sequence alignment using the local branching index (LBI). It takes an alignment file and an outgroup sequence as input and outputs a ranking of sequences, inferred ancestral sequences, and a reconstructed tree.

- **`infer_fitness.py`**: This script performs full fitness inference on sequences within a multiple sequence alignment. It calculates the mean posterior and variance of the posterior for each sequence, providing a detailed analysis of fitness distribution.

In the `betatree` directory, the main files are:

- **`betatree.py`**: Contains the `betatree` class, responsible for simulating beta coalescent trees, including methods for initializing the tree, simulating coalescence events, and constructing the final tree structure.

- **`sfs.py` and `sfs_py3.py`**: Define the `SFS` class, which extends the `betatree` class to include SFS calculation and data management. These files provide methods for generating multiple trees, calculating the SFS, and managing the SFS data.

## Key Files

- **`prediction_src`**: Contains core modules for fitness estimation, ancestral sequence reconstruction, and phylogenetic tree manipulation.

- **`flu`**: Contains code specific to the analysis of historical influenza data.

- **`toy_data`**: Includes code for simulating adapting populations using the FFPopSim library.

## Dependencies

The directories rely on several external libraries:

- **`argparse`**: For parsing command-line arguments.
- **`matplotlib`**: For plotting graphs and visualizing data.
- **`numpy`**: For numerical operations and random number generation.
- **`scipy`**: For special mathematical functions.
- **`Bio` (BioPython)**: For handling sequence alignments and phylogenetic trees.
- **`tree_utils`**: For plotting prediction trees.
- **`sequence_ranking`**: For fitness prediction and ranking of sequences.

These dependencies are chosen for their ability to handle complex biological data and perform computationally intensive tasks efficiently.