---
title: "IIDExponentialMLE.py"
---

## High-level description

The `IIDExponentialMLE` class is a specialized branch length estimator that assumes CRISPR/Cas9 mutations occur independently and identically across sites, with an exponential waiting time. It uses maximum likelihood estimation (MLE) to determine mutation rates and branch lengths in a phylogenetic tree, leveraging convex optimization techniques to solve the problem efficiently.

## Code Structure

The `IIDExponentialMLE` class inherits from the abstract `BranchLengthEstimator` class, which requires implementing the `estimate_branch_lengths` method. This class uses the `CassiopeiaTree` data structure to represent phylogenetic trees and relies on the `cvxpy` library for solving the optimization problem. The class also handles specific errors using the `IIDExponentialMLEError` exception.

## References

- `CassiopeiaTree`: Used to represent the phylogenetic tree and manage character states.
- `IIDExponentialMLEError`: Custom error class for handling specific exceptions related to the MLE process.
- `cvxpy`: A library for convex optimization, used to solve the exponential cone program.

## Symbols

### `IIDExponentialMLE`
#### Description
The `IIDExponentialMLE` class estimates branch lengths and mutation rates for a phylogenetic tree under the assumption of independent and identically distributed (IID) exponential mutations. It uses convex optimization to solve the MLE problem, ensuring that branch lengths are non-negative and adhere to a minimum length constraint.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| `minimum_branch_length` | `float` | Minimum allowed branch length to prevent collapse to zero. Default is 0.01. |
| `relative_mutation_rates` | `Optional[List[float]]` | Relative mutation rates for each character site. If `None`, all sites are assumed to evolve at the same rate. |
| `verbose` | `bool` | If `True`, enables verbose output from the solver. Default is `False`. |
| `solver` | `str` | The solver to use for optimization. Options are "SCS", "ECOS", or "MOSEK". Default is "SCS". |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| `mutation_rate` | `float` or `tuple` | Estimated mutation rate(s) for the tree. |
| `log_likelihood` | `float` | Log-likelihood of the data under the estimated model. |

#### Internal Logic
1. **Initialization**: Sets up the estimator with user-defined parameters, including minimum branch length, relative mutation rates, verbosity, and solver choice.
2. **Data Validation**: Checks the character matrix for mutations and ensures the relative mutation rates are valid.
3. **Optimization Setup**: Constructs the optimization problem using `cvxpy`, defining variables and constraints for branch lengths.
4. **Log-Likelihood Calculation**: Computes the log-likelihood of the observed data given the current model parameters.
5. **Problem Solving**: Solves the optimization problem using the specified solver, handling any solver errors.
6. **Result Extraction**: Extracts the estimated mutation rates and log-likelihood, updating the tree with the calculated branch lengths.

## Side Effects
- Modifies the `CassiopeiaTree` object by setting branch lengths and node times based on the estimated parameters.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| `cvxpy` | Used for formulating and solving the convex optimization problem. |
| `numpy` | Utilized for numerical operations and handling arrays. |

## Error Handling
- Raises `IIDExponentialMLEError` if the optimization solver fails.
- Raises `ValueError` for invalid input data, such as a degenerate character matrix or incorrect relative mutation rates.

## Logging
- The class supports verbose output from the solver if the `verbose` parameter is set to `True`.

## TODOs
- No TODOs are present in the code.